/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Query, ItemService } from "@geoplatform/client";
import ServiceProxy from './base';
const ɵ0 = function (svc, req) {
    return svc.search(req.query);
}, ɵ1 = function (svc, req) {
    return svc.get(req.params.id);
}, ɵ2 = function (svc, req) {
    return svc.save(req.body);
}, ɵ3 = function (svc, req) {
    return svc.save(req.body);
}, ɵ4 = function (svc, req) {
    return svc.remove(req.params.id);
}, ɵ5 = function (
// @ts-ignore
// @ts-ignore
result, res) {
    res.status(204).end();
}, ɵ6 = function (svc, req) {
    return svc.patch(req.params.id, req.body);
}, ɵ7 = function (svc, req) { return svc.clone(req.params.id, req.body); }, ɵ8 = function (svc, req) {
    return svc.export(req.params.id, req.query.format);
}, ɵ9 = function (result, res) {
    /** @type {?} */
    let mimeType = result.headers['content-type'];
    /** @type {?} */
    let disposition = result.headers['content-disposition'];
    res.set("Content-Type", mimeType);
    res.setHeader('Content-disposition', disposition);
    res.send(result.body);
}, ɵ10 = function (svc, req) {
    return svc.getUri(req.body);
}, ɵ11 = function (result, res) {
    res.json({ uri: result });
}, ɵ12 = function (svc, req) {
    return svc.getUri(req.body)
        .then(uri => {
        /** @type {?} */
        let fields = ['serviceType', 'services', 'scheme', 'themes', 'publishers', 'keywords'];
        /** @type {?} */
        let query = new Query().uri(uri).fields(fields);
        return svc.search(query);
    });
}, ɵ13 = function (svc, req) {
    /** @type {?} */
    let input = req.body.url || req.files.file;
    return svc.import(input, req.query.format);
}, ɵ14 = function (svc, req) {
    return svc.associations(req.params.id, req.query);
}, ɵ15 = function (svc, req) {
    return svc.versions(req.params.id);
}, ɵ16 = function (svc, req) {
    return svc.get(req.params.id, { version: req.params.version });
};
/** @type {?} */
const Routes = [
    {
        key: 'search',
        method: 'get',
        path: 'items',
        auth: false,
        execFn: ɵ0
    },
    {
        key: 'get',
        method: 'get',
        path: 'items/:id',
        auth: false,
        execFn: ɵ1
    },
    {
        key: 'create',
        method: 'post',
        path: 'items',
        auth: true,
        execFn: ɵ2
    },
    {
        key: 'update',
        method: 'put',
        path: 'items/:id',
        auth: true,
        execFn: ɵ3
    },
    {
        key: 'delete',
        method: 'delete',
        path: 'items/:id',
        auth: true,
        execFn: ɵ4,
        respFn: ɵ5
    },
    {
        key: 'patch',
        method: 'patch',
        path: 'items/:id',
        auth: true,
        execFn: ɵ6
    },
    {
        key: 'clone',
        method: 'post',
        path: 'items/:id/clone',
        auth: true,
        execFn: ɵ7
    },
    {
        key: 'export',
        method: 'get',
        path: 'items/:id/export',
        auth: false,
        execFn: ɵ8,
        respFn: ɵ9
    },
    {
        key: 'uri',
        method: 'post',
        path: 'items/uri',
        auth: false,
        execFn: ɵ10,
        respFn: ɵ11
    },
    {
        key: 'exists',
        method: 'post',
        path: 'items/exists',
        auth: false,
        execFn: ɵ12
    },
    {
        key: 'import',
        method: 'post',
        path: 'items/import',
        auth: true,
        execFn: ɵ13
    },
    {
        key: 'associations',
        method: 'get',
        path: 'items/:id/associations',
        auth: false,
        execFn: ɵ14
    },
    {
        key: 'versions',
        method: 'get',
        path: 'items/:id/versions',
        auth: false,
        execFn: ɵ15
    },
    {
        key: 'getVersion',
        method: 'get',
        path: 'items/:id/versions/:version',
        auth: false,
        execFn: ɵ16
    }
];
/**
 *
 * @param {?} router
 * @param {?=} options
 * @return {?}
 */
function bindRoutes(router, options) {
    //bind common endpoints
    options.pathBaseDefault = "items";
    options.serviceClass = ItemService;
    ServiceProxy.bindRoutes(router, Routes, options);
}
/**
 * ItemServiceProxy
 *
 * see examples/node/item-proxy for an in-depth example
 * @param {?=} options
 * @return {?}
 */
function ItemServiceProxy(options) {
    if (typeof (options) === 'undefined') {
        options = {};
    }
    ;
    /** @type {?} */
    let router = options.router;
    if (!options.router) {
        /** @type {?} */
        let express = require('express');
        if (!express) {
            throw new Error("ItemServiceProxy() - Must provide" +
                "'options.router' or include express as a dependency");
        }
        router = express.Router();
    }
    if (!router)
        throw new Error("ItemServiceProxy() - " +
            "Unable to create proxy route, missing router");
    bindRoutes(router, options);
    return router;
}
export default ItemServiceProxy;
export { ɵ0, ɵ1, ɵ2, ɵ3, ɵ4, ɵ5, ɵ6, ɵ7, ɵ8, ɵ9, ɵ10, ɵ11, ɵ12, ɵ13, ɵ14, ɵ15, ɵ16 };

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXRlbS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BnZW9wbGF0Zm9ybS9jbGllbnQvbm9kZS8iLCJzb3VyY2VzIjpbInNlcnZpY2VzL3Byb3hpZXMvaXRlbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN6RCxPQUFPLFlBQVksTUFBTSxRQUFRLENBQUM7V0FRbEIsVUFBUyxHQUFpQixFQUFFLEdBQVM7SUFDekMsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztDQUNoQyxPQU9PLFVBQVMsR0FBaUIsRUFBRSxHQUFTO0lBQ3pDLE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0NBQ2pDLE9BT08sVUFBUyxHQUFpQixFQUFFLEdBQVM7SUFDekMsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztDQUM3QixPQU9PLFVBQVMsR0FBaUIsRUFBRSxHQUFTO0lBQ3pDLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7Q0FDN0IsT0FPTyxVQUFTLEdBQWlCLEVBQUUsR0FBUztJQUN6QyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztDQUNwQyxPQUNPOztBQUVKLEFBREEsYUFBYTtBQUNiLE1BQVksRUFDWixHQUFTO0lBQ1QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztDQUN6QixPQU9PLFVBQVMsR0FBaUIsRUFBRSxHQUFTO0lBQ3pDLE9BQU8sR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7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QU8sR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDakMsSUFBRyxDQUFDLE9BQU8sRUFBRTtZQUNULE1BQU0sSUFBSSxLQUFLLENBQUMsbUNBQW1DO2dCQUMvQyxxREFBcUQsQ0FBQyxDQUFDO1NBQzlEO1FBQ0QsTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztLQUM3QjtJQUVELElBQUcsQ0FBQyxNQUFNO1FBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUI7WUFDL0MsOENBQThDLENBQUMsQ0FBQztJQUVwRCxVQUFVLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBRTVCLE9BQU8sTUFBTSxDQUFDO0NBQ2pCO0FBRUQsZUFBZSxnQkFBZ0IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IHsgUXVlcnksIEl0ZW1TZXJ2aWNlIH0gZnJvbSBcIkBnZW9wbGF0Zm9ybS9jbGllbnRcIjtcbmltcG9ydCBTZXJ2aWNlUHJveHkgZnJvbSAnLi9iYXNlJztcblxuY29uc3QgUm91dGVzID0gW1xuICAgIHtcbiAgICAgICAga2V5OiAnc2VhcmNoJyxcbiAgICAgICAgbWV0aG9kOiAnZ2V0JyxcbiAgICAgICAgcGF0aDogJ2l0ZW1zJyxcbiAgICAgICAgYXV0aDogZmFsc2UsXG4gICAgICAgIGV4ZWNGbjogZnVuY3Rpb24oc3ZjIDogSXRlbVNlcnZpY2UsIHJlcSA6IGFueSkge1xuICAgICAgICAgICAgcmV0dXJuIHN2Yy5zZWFyY2gocmVxLnF1ZXJ5KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBrZXk6ICdnZXQnLFxuICAgICAgICBtZXRob2Q6ICdnZXQnLFxuICAgICAgICBwYXRoOiAnaXRlbXMvOmlkJyxcbiAgICAgICAgYXV0aDogZmFsc2UsXG4gICAgICAgIGV4ZWNGbjogZnVuY3Rpb24oc3ZjIDogSXRlbVNlcnZpY2UsIHJlcSA6IGFueSkge1xuICAgICAgICAgICAgcmV0dXJuIHN2Yy5nZXQocmVxLnBhcmFtcy5pZCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5OiAnY3JlYXRlJyxcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIHBhdGg6ICdpdGVtcycsXG4gICAgICAgIGF1dGg6IHRydWUsXG4gICAgICAgIGV4ZWNGbjogZnVuY3Rpb24oc3ZjIDogSXRlbVNlcnZpY2UsIHJlcSA6IGFueSkge1xuICAgICAgICAgICAgcmV0dXJuIHN2Yy5zYXZlKHJlcS5ib2R5KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBrZXk6ICd1cGRhdGUnLFxuICAgICAgICBtZXRob2Q6ICdwdXQnLFxuICAgICAgICBwYXRoOiAnaXRlbXMvOmlkJyxcbiAgICAgICAgYXV0aDogdHJ1ZSxcbiAgICAgICAgZXhlY0ZuOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLnNhdmUocmVxLmJvZHkpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleTogJ2RlbGV0ZScsXG4gICAgICAgIG1ldGhvZDogJ2RlbGV0ZScsXG4gICAgICAgIHBhdGg6ICdpdGVtcy86aWQnLFxuICAgICAgICBhdXRoOiB0cnVlLFxuICAgICAgICBleGVjRm46IGZ1bmN0aW9uKHN2YyA6IEl0ZW1TZXJ2aWNlLCByZXEgOiBhbnkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdmMucmVtb3ZlKHJlcS5wYXJhbXMuaWQpO1xuICAgICAgICB9LFxuICAgICAgICByZXNwRm46IGZ1bmN0aW9uKFxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgcmVzdWx0IDogYW55LFxuICAgICAgICAgICAgcmVzIDogYW55KSB7XG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwNCkuZW5kKCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5OiAncGF0Y2gnLFxuICAgICAgICBtZXRob2Q6ICdwYXRjaCcsXG4gICAgICAgIHBhdGg6ICdpdGVtcy86aWQnLFxuICAgICAgICBhdXRoOiB0cnVlLFxuICAgICAgICBleGVjRm46IGZ1bmN0aW9uKHN2YyA6IEl0ZW1TZXJ2aWNlLCByZXEgOiBhbnkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdmMucGF0Y2gocmVxLnBhcmFtcy5pZCwgcmVxLmJvZHkpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleTogJ2Nsb25lJyxcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIHBhdGg6ICdpdGVtcy86aWQvY2xvbmUnLFxuICAgICAgICBhdXRoOiB0cnVlLFxuICAgICAgICBleGVjRm46IGZ1bmN0aW9uKHN2YywgcmVxKSB7IHJldHVybiBzdmMuY2xvbmUocmVxLnBhcmFtcy5pZCwgcmVxLmJvZHkpOyB9XG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleTogJ2V4cG9ydCcsXG4gICAgICAgIG1ldGhvZDogJ2dldCcsXG4gICAgICAgIHBhdGg6ICdpdGVtcy86aWQvZXhwb3J0JyxcbiAgICAgICAgYXV0aDogZmFsc2UsXG4gICAgICAgIGV4ZWNGbjogZnVuY3Rpb24oc3ZjIDogSXRlbVNlcnZpY2UsIHJlcSA6IGFueSkge1xuICAgICAgICAgICAgcmV0dXJuIHN2Yy5leHBvcnQocmVxLnBhcmFtcy5pZCwgcmVxLnF1ZXJ5LmZvcm1hdCk7IH0sXG4gICAgICAgIHJlc3BGbjogZnVuY3Rpb24ocmVzdWx0IDogYW55LCByZXMgOiBhbnkpIHtcbiAgICAgICAgICAgIGxldCBtaW1lVHlwZSA9IHJlc3VsdC5oZWFkZXJzWydjb250ZW50LXR5cGUnXTtcbiAgICAgICAgICAgIGxldCBkaXNwb3NpdGlvbiA9IHJlc3VsdC5oZWFkZXJzWydjb250ZW50LWRpc3Bvc2l0aW9uJ107XG4gICAgICAgICAgICByZXMuc2V0KFwiQ29udGVudC1UeXBlXCIsIG1pbWVUeXBlKTtcbiAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtZGlzcG9zaXRpb24nLCBkaXNwb3NpdGlvbik7XG4gICAgICAgICAgICByZXMuc2VuZChyZXN1bHQuYm9keSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5OiAndXJpJyxcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIHBhdGg6ICdpdGVtcy91cmknLFxuICAgICAgICBhdXRoOiBmYWxzZSxcbiAgICAgICAgZXhlY0ZuOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLmdldFVyaShyZXEuYm9keSk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlc3BGbjogZnVuY3Rpb24ocmVzdWx0IDogYW55LCByZXMgOiBhbnkpIHtcbiAgICAgICAgICAgIHJlcy5qc29uKHsgdXJpOiByZXN1bHQgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5OiAnZXhpc3RzJyxcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIHBhdGg6ICdpdGVtcy9leGlzdHMnLFxuICAgICAgICBhdXRoOiBmYWxzZSxcbiAgICAgICAgZXhlY0ZuOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLmdldFVyaShyZXEuYm9keSlcbiAgICAgICAgICAgIC50aGVuKCB1cmkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBmaWVsZHMgPSBbJ3NlcnZpY2VUeXBlJywnc2VydmljZXMnLCdzY2hlbWUnLCd0aGVtZXMnLCdwdWJsaXNoZXJzJywna2V5d29yZHMnXTtcbiAgICAgICAgICAgICAgICBsZXQgcXVlcnkgOiBRdWVyeSA9IG5ldyBRdWVyeSgpLnVyaSh1cmkpLmZpZWxkcyhmaWVsZHMpO1xuICAgICAgICAgICAgICAgIHJldHVybiBzdmMuc2VhcmNoKHF1ZXJ5KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleTogJ2ltcG9ydCcsXG4gICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICBwYXRoOiAnaXRlbXMvaW1wb3J0JyxcbiAgICAgICAgYXV0aDogdHJ1ZSxcbiAgICAgICAgZXhlY0ZuOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICBsZXQgaW5wdXQgPSByZXEuYm9keS51cmwgfHwgcmVxLmZpbGVzLmZpbGU7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLmltcG9ydChpbnB1dCwgcmVxLnF1ZXJ5LmZvcm1hdCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5OiAnYXNzb2NpYXRpb25zJyxcbiAgICAgICAgbWV0aG9kOiAnZ2V0JyxcbiAgICAgICAgcGF0aDogJ2l0ZW1zLzppZC9hc3NvY2lhdGlvbnMnLFxuICAgICAgICBhdXRoOiBmYWxzZSxcbiAgICAgICAgZXhlY0ZuOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLmFzc29jaWF0aW9ucyhyZXEucGFyYW1zLmlkLCByZXEucXVlcnkpOyB9XG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleTogJ3ZlcnNpb25zJyxcbiAgICAgICAgbWV0aG9kOiAnZ2V0JyxcbiAgICAgICAgcGF0aDogJ2l0ZW1zLzppZC92ZXJzaW9ucycsXG4gICAgICAgIGF1dGg6IGZhbHNlLFxuICAgICAgICBleGVjRm46IGZ1bmN0aW9uKHN2YyA6IEl0ZW1TZXJ2aWNlLCByZXEgOiBhbnkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdmMudmVyc2lvbnMocmVxLnBhcmFtcy5pZCk7IH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5OiAnZ2V0VmVyc2lvbicsXG4gICAgICAgIG1ldGhvZDogJ2dldCcsXG4gICAgICAgIHBhdGg6ICdpdGVtcy86aWQvdmVyc2lvbnMvOnZlcnNpb24nLFxuICAgICAgICBhdXRoOiBmYWxzZSxcbiAgICAgICAgZXhlY0ZuOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLmdldChyZXEucGFyYW1zLmlkLCB7IHZlcnNpb246IHJlcS5wYXJhbXMudmVyc2lvbiB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIFRPRE8gZmluZE11bHRpcGxlXG5dO1xuXG4vKipcbiAqXG4gKi9cbmZ1bmN0aW9uIGJpbmRSb3V0ZXMocm91dGVyIDogYW55LCBvcHRpb25zID86IGFueSkge1xuICAgIC8vYmluZCBjb21tb24gZW5kcG9pbnRzXG4gICAgb3B0aW9ucy5wYXRoQmFzZURlZmF1bHQgPSBcIml0ZW1zXCI7XG4gICAgb3B0aW9ucy5zZXJ2aWNlQ2xhc3MgPSBJdGVtU2VydmljZTtcbiAgICBTZXJ2aWNlUHJveHkuYmluZFJvdXRlcyhyb3V0ZXIsIFJvdXRlcywgb3B0aW9ucyk7XG59XG5cblxuXG5cbi8qKlxuICogSXRlbVNlcnZpY2VQcm94eVxuICpcbiAqIHNlZSBleGFtcGxlcy9ub2RlL2l0ZW0tcHJveHkgZm9yIGFuIGluLWRlcHRoIGV4YW1wbGVcbiAqL1xuZnVuY3Rpb24gSXRlbVNlcnZpY2VQcm94eSggb3B0aW9ucyA/OiBhbnkgKSB7XG5cbiAgICBpZih0eXBlb2Yob3B0aW9ucykgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICB9O1xuXG4gICAgbGV0IHJvdXRlciA9IG9wdGlvbnMucm91dGVyO1xuICAgIGlmKCFvcHRpb25zLnJvdXRlcikge1xuICAgICAgICBsZXQgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbiAgICAgICAgaWYoIWV4cHJlc3MpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkl0ZW1TZXJ2aWNlUHJveHkoKSAtIE11c3QgcHJvdmlkZVwiICtcbiAgICAgICAgICAgICAgICBcIidvcHRpb25zLnJvdXRlcicgb3IgaW5jbHVkZSBleHByZXNzIGFzIGEgZGVwZW5kZW5jeVwiKTtcbiAgICAgICAgfVxuICAgICAgICByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuICAgIH1cblxuICAgIGlmKCFyb3V0ZXIpIHRocm93IG5ldyBFcnJvcihcIkl0ZW1TZXJ2aWNlUHJveHkoKSAtIFwiICtcbiAgICAgICAgXCJVbmFibGUgdG8gY3JlYXRlIHByb3h5IHJvdXRlLCBtaXNzaW5nIHJvdXRlclwiKTtcblxuICAgIGJpbmRSb3V0ZXMocm91dGVyLCBvcHRpb25zKTtcblxuICAgIHJldHVybiByb3V0ZXI7XG59XG5cbmV4cG9ydCBkZWZhdWx0IEl0ZW1TZXJ2aWNlUHJveHk7XG4iXX0=