"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"function"==typeof define&&define.amd?define([],function(){return e.ItemTypes=t()}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.ItemTypes=t():GeoPlatform.ItemTypes=t()}(window,function(){return{DATASET:"dcat:Dataset",SERVICE:"regp:Service",LAYER:"Layer",MAP:"Map",GALLERY:"Gallery",CONCEPT:"skos:Concept",CONCEPT_SCHEME:"skos:ConceptScheme",STANDARD:"dct:Standard"}}),function(e,t){"function"==typeof define&&define.amd?define([],function(){return e.QueryParameters=t()}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.QueryParameters=t():GeoPlatform.QueryParameters=t()}(window,function(){return{TYPES:"type",QUERY:"q",KEYWORDS:"keyword",CREATED_BY:"createdBy",CONTRIBUTED_BY:"contributedBy",CREATOR:"creator.id",SVC_TYPES:"serviceType.id",THEMES_ID:"theme.id",THEMES_LABEL:"theme.label",THEMES_URI:"theme.uri",PUBLISHERS:"publisher.id",PUBLISHERS_LABEL:"publisher.label",PUBLISHERS_URI:"publisher.uri",SCHEMES_ID:"scheme.id",SCHEMES_LABEL:"scheme.label",SCHEMES_URI:"scheme.uri",VISIBILITY:"visibility",EXTENT:"extent",MODIFIED_BEFORE:"modified.max",MODIFIED_AFTER:"modified.min",BEGINS:"startDate.min",ENDS:"endDate.max",RESOURCE_TYPE:"resourceType"}}),function(e,t){"function"==typeof define&&define.amd?define(["QueryParameters"],function(r){return e.Query=t(r)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.Query=t(require("./parameters")):GeoPlatform.Query=t(GeoPlatform.QueryParameters)}(window,function(e){var t=["created","modified","createdBy","publishers","themes","description"],r=["types","themes","publishers","serviceTypes","schemes","visibility","createdBy"],n=[{value:"label,asc",label:"Name (A-Z)"},{value:"label,desc",label:"Name (Z-A)"},{value:"type,asc",label:"Type (A-Z)"},{value:"type,desc",label:"Type (Z-A)"},{value:"modified,desc",label:"Most recently modified"},{value:"modified,asc",label:"Least recently modified"},{value:"_score,desc",label:"Relevance"}];return function(){function i(){_classCallCheck(this,i),this.defaultQuery={start:0,size:10,total:0,sort:"modified,desc",fields:t.slice(0),includeFacets:r.slice(0)},this.query={start:0,size:10,total:0,sort:"modified,desc",fields:t.slice(0),includeFacets:r.slice(0)}}return _createClass(i,[{key:"getQuery",value:function(){var e={};for(var t in this.query){var r=this.query[t];null!==r&&void 0!==r.push&&(r=r.join(",")),e[t]=r}return e}},{key:"parameter",value:function(e,t){return this.setParameter(e,t),this}},{key:"setParameter",value:function(e,t){this.query[e]=t}},{key:"getParameter",value:function(e){return this.getParameter(ke)}},{key:"applyParameters",value:function(e){for(var t in e)e.hasOwnProperty(t)&&this.setParameter(t,e[t])}},{key:"q",value:function(e){return this.setQ(e),this}},{key:"setQ",value:function(t){this.setParameter(e.QUERY,t)}},{key:"getQ",value:function(){return this.getParameter(e.QUERY)}},{key:"keywords",value:function(e){return this.setQ(e),this}},{key:"setKeywords",value:function(t){t&&void 0!==t.push&&(t=t.join(",")),this.setParameter(e.KEYWORDS,t)}},{key:"getKeywords",value:function(){return this.getParameter(e.KEYWORDS)}},{key:"types",value:function(e){return this.setTypes(e),this}},{key:"setTypes",value:function(t){t&&"undefined"===t.push&&(t=[t]),this.setParameter(e.TYPES,t)}},{key:"getTypes",value:function(){return this.getParameter(e.TYPES)}},{key:"createdBy",value:function(e){return this.setCreatedBy(e),this}},{key:"setCreatedBy",value:function(t){this.setParameter(e.CREATED_BY,t)}},{key:"getCreatedBy",value:function(){return this.getParameter(e.CREATED_BY)}},{key:"themes",value:function(e,t){return this.setThemes(e,t),this}},{key:"setThemes",value:function(t,r){t&&"undefined"===t.push&&(t=[t]),this.setParameter(e.THEMES_ID,null),this.setParameter(e.THEMES_LABEL,null),this.setParameter(e.THEMES_URI,null);var n=r||e.THEMES_ID;this.setParameter(n,t)}},{key:"getThemes",value:function(){return this.getParameter(e.THEMES_ID)||this.getParameter(e.THEMES_LABEL)||this.getParameter(e.THEMES_URI)}},{key:"publishers",value:function(e,t){return this.setPublishers(e,t),this}},{key:"setPublishers",value:function(t,r){t&&"undefined"===t.push&&(t=[t]),this.setParameter(e.PUBLISHERS_ID,null),this.setParameter(e.PUBLISHERS_LABEL,null),this.setParameter(e.PUBLISHERS_URI,null);var n=r||e.PUBLISHERS_ID;this.setParameter(n,t)}},{key:"getPublishers",value:function(){return this.getParameter(e.PUBLISHERS_ID)||this.getParameter(e.PUBLISHERS_LABEL)||this.getParameter(e.PUBLISHERS_URI)}},{key:"schemes",value:function(e,t){return this.setSchemes(e,t),this}},{key:"setSchemes",value:function(t,r){t&&"undefined"===t.push&&(t=[t]),this.setParameter(e.SCHEMES_ID,null),this.setParameter(e.SCHEMES_LABEL,null),this.setParameter(e.SCHEMES_URI,null);var n=r||e.SCHEMES_ID;this.setParameter(n,t)}},{key:"getSchemes",value:function(){return this.getParameter(e.SCHEMES)||this.getParameter(e.SCHEMES_LABEL)||this.getParameter(e.SCHEMES_URI)}},{key:"serviceTypes",value:function(e){return this.setServiceTypes(e),this}},{key:"setServiceTypes",value:function(t){t&&"undefined"===t.push&&(t=[t]),this.setParameter(e.SERVICE_TYPES,t)}},{key:"getServiceTypes",value:function(){return this.getParameter(e.SERVICE_TYPES)}},{key:"visibility",value:function(e){return this.setVisibility(e),this}},{key:"setVisibility",value:function(t){this.setParameter(e.VISIBILITY,t)}},{key:"getVisibility",value:function(){this.getParameter(e.VISIBILITY)}},{key:"modified",value:function(e,t){return this.setModified(e,t),this}},{key:"setModified",value:function(t,r){if(!t)return this.setParameter(e.MODIFIED_BEFORE,null),void this.setParameter(e.MODIFIED_AFTER,null);var n=r&&(!0===r||"true"===r),i=n?e.MODIFIED_BEFORE:e.MODIFIED_AFTER,u=n?e.MODIFIED_AFTER:e.MODIFIED_BEFORE,s=t&&t.getTime?t.getTime():t;this.setParameter(u,null),this.setParameter(i,s)}},{key:"getModified",value:function(){return this.getParameter(e.MODIFIED_BEFORE)||this.getParameter(e.MODIFIED_AFTER)}},{key:"extent",value:function(e){return this.setExtent(e),this}},{key:"setExtent",value:function(t){t&&void 0!==t.toBboxString&&(t=t.toBboxString()),this.setParameter(e.EXTENT,t)}},{key:"getExtent",value:function(){return this.getParameter(e.EXTENT)}},{key:"begins",value:function(e){return this.setBeginDate(e),this}},{key:"setBeginDate",value:function(t){t&&t instanceof Date&&(t=t.getTime()),this.setParameter(e.BEGINS,t)}},{key:"getBeginDate",value:function(){var e=this.getParameter(this.parameter.BEGINS);return e&&(e=new Date(e)),e}},{key:"ends",value:function(e){return this.setEndDate(e),this}},{key:"setEndDate",value:function(t){t&&t instanceof Date&&(t=t.getTime()),this.setParameter(e.ENDS,t)}},{key:"getEndDate",value:function(){var e=this.getParameter(this.parameter.ENDS);return e&&(e=new Date(e)),e}},{key:"between",value:function(e,t){return this.setBetween(e,t),this}},{key:"setBetween",value:function(e,t){this.begins(e),this.ends(t)}},{key:"resourceTypes",value:function(e){return this.setResourceTypes(e),this}},{key:"setResourceTypes",value:function(t){t&&"undefined"===t.push&&(t=[t]),this.setParameter(e.RESOURCE_TYPE,t)}},{key:"getResourceTypes",value:function(){return this.getParameter(e.RESOURCE_TYPE)}},{key:"facets",value:function(e){return this.setFacets(e),this}},{key:"setFacets",value:function(e){this.query.includeFacets=e}},{key:"getFacets",value:function(){return this.query.includeFacets}},{key:"fields",value:function(e){return this.setFields(e),this}},{key:"setFields",value:function(e){e&&void 0===e.push&&(e=[e]),this.query.fields=e}},{key:"getFields",value:function(){return this.query.fields}},{key:"start",value:function(e){return this.setStart(e),this}},{key:"setStart",value:function(e){isNaN(e)||(this.query.start=e)}},{key:"getStart",value:function(){return this.query.start}},{key:"page",value:function(e){return this.setPage(e),this}},{key:"setPage",value:function(e){isNaN(e)||(this.query.start=e*this.query.size)}},{key:"getPage",value:function(){return this.query.start}},{key:"pageSize",value:function(e){return this.setPageSize(e),this}},{key:"setPageSize",value:function(e){if(!isNaN(e)){this.query.size=e;var t=Math.floor(1*this.query.start/this.query.size*1);this.query.start=t*(1*this.query.size)}}},{key:"getPageSize",value:function(){return this.query.size}},{key:"sort",value:function(e,t){return this.setSort(e,t),this}},{key:"setSort",value:function(e,t){t=!t||"asc"===t&&"desc"===t?t:"desc",e&&e.indexOf(",")<0&&(e=e+","+t),this.query.sort=e}},{key:"getSort",value:function(){return this.query.sort}},{key:"getSortField",value:function(){return this.query.sort.split(",")[0]}},{key:"getSortOrder",value:function(){return"asc"===this.query.sort.split(",")[1]}},{key:"getSortOptions",value:function(){return n.slice(0)}},{key:"clear",value:function(){this.query=this.defaultQuery}}]),i}()}),function(e,t){"function"==typeof define&&define.amd?define(["Query"],function(r){return e.QueryFactory=t(r)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.QueryFactory=t(require("./query")):GeoPlatform.QueryFactory=t(GeoPlatform.Query)}(window,function(e){return function(){return new e}}),function(e,t){"function"==typeof define&&define.amd?define(["q"],function(r){return e.ItemService=t(r)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.ItemService=t(require("Q")):GeoPlatform.ItemService=t(Q)}(window,function(e){return function(){function t(e){_classCallCheck(this,t),this.setUrl(e),this.timeout=1e4}return _createClass(t,[{key:"setUrl",value:function(e){this.baseUrl=e+"/api/items"}},{key:"timeout",value:function(e){this.timeout=e}},{key:"get",value:function(t){return e.reject(new Error("Must use a subclass of ItemService"))}},{key:"save",value:function(t){return e.reject(new Error("Must use a subclass of ItemService"))}},{key:"remove",value:function(t){return e.reject(new Error("Must use a subclass of ItemService"))}},{key:"patch",value:function(t,r){return e.reject(new Error("Must use a subclass of ItemService"))}},{key:"search",value:function(t){return e.reject(new Error("Must use a subclass of ItemService"))}}]),t}()}),function(e,t){"function"==typeof define&&define.amd?define(["jquery","q","GeoPlatform","ItemService"],function(r,n,i,u){return e.JQueryItemService=t(r,n,i,u)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.JQueryItemService=t(require("jquery"),require("q"),require("GeoPlatform"),require("ItemService")):GeoPlatform.JQueryItemService=t(jQuery,Q,GeoPlatform,GeoPlatform.ItemService)}(window,function(e,t,r,n){var i=["GET","POST","PUT","DELETE","PATCH"];return function(n){function u(){return _classCallCheck(this,u),_possibleConstructorReturn(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,r.ualUrl))}return _inherits(u,n),_createClass(u,[{key:"get",value:function(r,n){var i=this;return t.resolve(!0).then(function(){var u=i.buildRequest("GET",i.baseUrl+"/"+r,null,n),s=t.defer();return u.success=function(e){s.resolve(e)},u.error=function(e,t,r){s.reject(new Error(r))},e.ajax(u),s.promise}).catch(function(e){var r=new Error("ItemService.save() - Error fetching item: "+e.message);return t.reject(r)})}},{key:"save",value:function(r,n){var i=this;return t.resolve(!0).then(function(){var u="POST",s=i.baseUrl;r.id&&(u="PUT",s+="/"+r.id);var o=i.buildRequest(u,s,r,n),a=t.defer();return o.success=function(e){a.resolve(e)},o.error=function(e,t,r){a.reject(new Error(r))},e.ajax(o),a.promise}).catch(function(e){var r=new Error("ItemService.save() - Error saving item: "+e.message);return t.reject(r)})}},{key:"remove",value:function(r,n){var i=this;return t.resolve(!0).then(function(){var u=i.buildRequest("DELETE",i.baseUrl+"/"+r,null,n),s=t.defer();return u.success=function(e){s.resolve(!0)},u.error=function(e,t,r){s.reject(new Error(r))},e.ajax(u),s.promise}).catch(function(e){var r=new Error("ItemService.save() - Error deleting item: "+e.message);return t.reject(r)})}},{key:"patch",value:function(r,n,i){var u=this;return t.resolve(!0).then(function(){var s=u.buildRequest("PATCH",u.baseUrl+"/"+r,n,i),o=t.defer();return s.success=function(e){o.resolve(e)},s.error,e.ajax(s),o.promise}).catch(function(e){var r=new Error("ItemService.save() - Error patching item: "+e.message);return t.reject(r)})}},{key:"search",value:function(r,n){var i=this;return t.resolve(!0).then(function(){var u=r;r&&void 0!==r.getQuery&&(u=r.getQuery());var s=i.buildRequest("GET",i.baseUrl,u,n),o=t.defer();return s.success=function(e){o.resolve(e)},s.error=function(e,t,r){o.reject(new Error(r))},e.ajax(s),o.promise}).catch(function(e){var r=new Error("ItemService.search() - Error searching items: "+e.message);return t.reject(r)})}},{key:"buildRequest",value:function(e,t,r,n){if(i.indexOf(e)<0)throw new Error("Unsupported HTTP method "+e);if(!t)throw new Error("Must specify a URL for HTTP requests");var u={method:e,url:t,dataType:"json",timeout:this.timeout};if(r&&(u.data=r,"POST"!==e&&"PUT"!==e&&"PATCH"!==e||(u.processData=!1,u.contentType="application/json")),n&&"object"===(void 0===n?"undefined":_typeof(n)))for(var s in n)n.hasOwnProperty(s)&&(u[s]=n[s]);return u}}]),u}(n)}),function(e,t){"function"==typeof define&&define.amd?define(["jquery","q","GeoPlatform","JQueryItemService"],function(r,n,i,u){return e.JQueryMapService=t(r,n,i,u)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.JQueryMapService=t(require("jquery"),require("q"),require("GeoPlatform"),require("JQueryItemService")):GeoPlatform.JQueryMapService=t(jQuery,Q,GeoPlatform,GeoPlatform.JQueryItemService)}(window,function(e,t,r,n){return function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return _inherits(t,e),_createClass(t,[{key:"setUrl",value:function(e){this.baseUrl=e+"/api/maps"}}]),t}(n)}),function(e,t){"function"==typeof define&&define.amd?define(["jquery","q","GeoPlatform","JQueryItemService"],function(r,n,i,u){return e.JQueryLayerService=t(r,n,i,u)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.JQueryLayerService=t(require("jquery"),require("q"),require("GeoPlatform"),require("JQueryItemService")):GeoPlatform.JQueryLayerService=t(jQuery,Q,GeoPlatform,GeoPlatform.JQueryItemService)}(window,function(e,t,r,n){return function(r){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this))}return _inherits(n,r),_createClass(n,[{key:"setUrl",value:function(e){this.baseUrl=e+"/api/layers"}},{key:"style",value:function(r){var n=this;return t.resolve(!0).then(function(){var i=t.defer(),u=n.baseUrl+"/"+id+"/style",s=n.buildRequest("GET",u,null,r);return s.success=function(e){i.resolve(e)},s.error=function(e,t,r){var n="GeoPlatform.LayerService.style() - Error fetching item style: "+r,u=new Error(n);i.reject(u)},e.ajax(s),i.promise}).catch(function(e){var r=new Error("ItemService.save() - Error deleting item: "+e.message);return t.reject(r)})}},{key:"describe",value:function(r,n){var i=this;return t.resolve(!0).then(function(){if(!r)throw new Error("Must provide describe req");var u=["bbox","height","width","x","y"],s=u.find(function(e){return!r[e]});if(s)throw new Error("Must specify "+s+" in describe req");var o={srs:"EPSG:4326",bbox:r.bbox,height:r.height,width:r.width,info_format:"text/xml",x:r.x,y:r.y,i:r.x,j:r.y},a=t.defer(),c=i.baseUrl+"/"+id+"/describe",l=i.buildRequest("GET",c,o,n);return l.success=function(e){a.resolve(e)},l.error=function(e,t,r){a.reject(new Error(r))},e.ajax(l),a.promise}).catch(function(e){var r=new Error("JQueryLayerService.describe() -\n                    Error describing layer feature: "+e.message);return t.reject(r)})}}]),n}(n)}),function(e,t){"function"==typeof define&&define.amd?define(["jquery","q","GeoPlatform","JQueryItemService"],function(r,n,i,u){return e.JQueryServiceService=t(r,n,i,u)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.JQueryServiceService=t(require("jquery"),require("q"),require("GeoPlatform"),require("JQueryItemService")):GeoPlatform.JQueryServiceService=t(jQuery,Q,GeoPlatform,GeoPlatform.JQueryItemService)}(window,function(e,t,r,n){return function(r){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this))}return _inherits(n,r),_createClass(n,[{key:"setUrl",value:function(e){this.baseUrl=e+"/api/services"}},{key:"about",value:function(r,n){var i=this;return t.resolve(!0).then(function(){if(!r)throw new Error("Must provide service to get metadata about");var u=t.defer(),s=i.buildRequest("POST",i.baseUrl+"/about",r,n);return s.success=function(e){u.resolve(e)},s.error=function(e,t,r){u.reject(new Error(r))},e.ajax(s),u.promise}).catch(function(e){var r=new Error("JQueryServiceService.about() -\n                    Error describing service: "+e.message);return t.reject(r)})}}]),n}(n)}),function(e,t){"function"==typeof define&&define.amd?define(["ItemTypes","JQueryItemService","JQueryLayerService","JQueryMapService","JQueryServiceService"],function(r,n,i,u,s){return e.JQueryServiceFactory=t(r,n,i,u)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.JQueryServiceFactory=t(require("../../shared/types"),require("./item"),require("./layer"),require("./map"),require("./service")):GeoPlatform.JQueryServiceFactory=t(GeoPlatform.ItemTypes,GeoPlatform.JQueryItemService,GeoPlatform.JQueryLayerService,GeoPlatform.JQueryMapService,GeoPlatform.JQueryServiceService)}(window,function(e,t,r,n){return function(i,u){var s="string"==typeof i?i:i&&i.type?i.type:null;if(!s)throw new Error("Must provide a type or object with a type specified");if(!u)throw new Error("Must provide a base url");switch(s){case Types.LAYER:return new t(u);case Types.SERVICE:return new n(u);case Types.MAP:return new r(u);default:return new e(u)}}});