"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"function"==typeof define&&define.amd?define([],function(){}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports&&(module.exports=void 0)}(window),function(e,t){"function"==typeof define&&define.amd?define(["GeoPlatform"],function(r){return e.Query=t(r)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.Query=t(require("GeoPlatform")):GeoPlatform.Query=t(GeoPlatform)}(window,function(e){return function(){function e(){_classCallCheck(this,e),this._fields=["created","modified","createdBy","publishers","themes","description"],this._facets=["types","themes","publishers","serviceTypes","schemes","visibility","createdBy"],this.sortOptions=[{value:"label,asc",label:"Name (A-Z)"},{value:"label,desc",label:"Name (Z-A)"},{value:"type,asc",label:"Type (A-Z)"},{value:"type,desc",label:"Type (Z-A)"},{value:"modified,desc",label:"Most recently modified"},{value:"modified,asc",label:"Least recently modified"},{value:"_score,desc",label:"Relevance"}],this.parameters={TYPES:"type",THEMES_ID:"theme.id",THEMES_LABEL:"theme.label",THEMES_URI:"theme.uri",PUBLISHERS:"publisher.id",PUBLISHERS_LABEL:"publisher.label",PUBLISHERS_URI:"publisher.uri",CREATED_BY:"createdBy",CONTRIBUTED_BY:"contributedBy",CREATOR:"creator.id",SVC_TYPES:"serviceType.id",SCHEMES_ID:"scheme.id",SCHEMES_LABEL:"scheme.label",SCHEMES_URI:"scheme.uri",VISIBILITY:"visibility",QUERY:"q",KEYWORDS:"keyword",EXTENT:"extent",MODIFIED_BEFORE:"modified.max",MODIFIED_AFTER:"modified.min",BEGINS:"startDate.min",ENDS:"endDate.max",RESOURCE_TYPE:"resourceType"},this.query=this.defaultQuery={start:0,size:10,total:0,sort:"modified,desc",fields:this._fields,includeFacets:this._facets}}return _createClass(e,[{key:"getQuery",value:function(){var e={};for(var t in this.query){var r=this.query[t];void 0!==r.push&&(r=r.join(",")),e[t]=r}return e}},{key:"parameter",value:function(e,t){return this.setParameter(e,t),this}},{key:"setParameter",value:function(e,t){this.query[e]=t}},{key:"getParameter",value:function(e){return this.getParameter(ke)}},{key:"applyParameters",value:function(e){for(var t in e)e.hasOwnProperty(t)&&this.setParameter(t,e[t])}},{key:"q",value:function(e){return this.setQ(e),this}},{key:"setQ",value:function(e){this.setParameter(this.parameters.QUERY,e)}},{key:"getQ",value:function(){return this.getParameter(this.parameters.QUERY)}},{key:"keywords",value:function(e){return this.setQ(e),this}},{key:"setKeywords",value:function(e){e&&void 0!==e.push&&(e=e.join(",")),this.setParameter(this.parameters.KEYWORDS,e)}},{key:"getKeywords",value:function(){return this.getParameter(this.parameters.KEYWORDS)}},{key:"types",value:function(e){return this.setTypes(e),this}},{key:"setTypes",value:function(e){e&&"undefined"===e.push&&(e=[e]),this.setParameter(this.parameters.TYPES,e)}},{key:"getTypes",value:function(){return this.getParameter(this.parameters.TYPES)}},{key:"createdBy",value:function(e){return this.setCreatedBy(e),this}},{key:"setCreatedBy",value:function(e){this.setParameter(this.parameters.CREATED_BY,e)}},{key:"getCreatedBy",value:function(){return this.getParameter(this.parameters.CREATED_BY)}},{key:"themes",value:function(e,t){return this.setThemes(e),this}},{key:"setThemes",value:function(e,t){e&&"undefined"===e.push&&(e=[e]);var r=this.parameters.THEMES_ID;t&&"label"===t?r=this.parameters.THEMES_LABEL:t&&"uri"===t&&(r=this.parameters.THEMES_URI),this.setParameter(r,e)}},{key:"getThemes",value:function(){return this.getParameter(this.parameters.THEMES)}},{key:"publishers",value:function(e,t){return this.setPublishers(e),this}},{key:"setPublishers",value:function(e,t){e&&"undefined"===e.push&&(e=[e]);var r=this.parameters.PUBLISHERS_ID;t&&"label"===t?r=this.parameters.PUBLISHERS_LABEL:t&&"uri"===t&&(r=this.parameters.PUBLISHERS_URI),this.setParameter(r,e)}},{key:"getPublishers",value:function(){return this.getParameter(this.parameters.PUBLISHERS)}},{key:"serviceTypes",value:function(e){return this.setServiceTypes(e),this}},{key:"setServiceTypes",value:function(e){e&&"undefined"===e.push&&(e=[e]),this.setParameter(this.parameters.SERVICE_TYPES,e)}},{key:"getServiceTypes",value:function(){return this.getParameter(this.parameters.SERVICE_TYPES)}},{key:"schemes",value:function(e,t){return this.setSchemes(e),this}},{key:"setSchemes",value:function(e,t){e&&"undefined"===e.push&&(e=[e]);var r=this.parameters.SCHEMES_ID;t&&"label"===t?r=this.parameters.SCHEMES_LABEL:t&&"uri"===t&&(r=this.parameters.SCHEMES_URI),this.setParameter(r,e)}},{key:"getSchemes",value:function(){return this.getParameter(this.parameters.SCHEMES)}},{key:"visibility",value:function(e){return this.setVisibility(e),this}},{key:"setVisibility",value:function(e){this.setParameter(this.parameters.VISIBILITY,e)}},{key:"getVisibility",value:function(){this.getParameter(this.parameters.VISIBILITY)}},{key:"modified",value:function(e,t){return this.setModified(e,t),this}},{key:"setModified",value:function(e,t){if(!e)return this.setParameter(this.parameters.MODIFIED_BEFORE,null),void this.setParameter(this.parameters.MODIFIED_AFTER,null);var r=t&&(!0===t||"true"===t),i=r?this.parameters.MODIFIED_BEFORE:this.parameters.MODIFIED_AFTER,n=r?this.parameters.MODIFIED_AFTER:this.parameters.MODIFIED_BEFORE,s=e&&e.getTime?e.getTime():e;this.setParameter(n,null),this.setParameter(i,s)}},{key:"getModified",value:function(){return this.getParameter(this.parameters.MODIFIED_BEFORE)||this.getParameter(this.parameters.MODIFIED_AFTER)}},{key:"extent",value:function(e){return this.setExtent(e),this}},{key:"setExtent",value:function(e){e&&void 0!==e.toBboxString&&(e=e.toBboxString()),this.setParameter(this.parameters.EXTENT,e)}},{key:"getExtent",value:function(){return this.getParameter(this.parameters.EXTENT)}},{key:"begins",value:function(e){return this.setBegins(e),this}},{key:"setBeginDate",value:function(e){e&&e instanceof Date&&(e=e.getTime()),this.setParameter(this.parameters.BEGINS,e)}},{key:"getBeginDate",value:function(){var e=this.getParameter(this.parameter.BEGINS);return e&&(e=new Date(e)),e}},{key:"ends",value:function(e){return this.setEnds(e),this}},{key:"setEndDate",value:function(e){e&&e instanceof Date&&(e=e.getTime()),this.setParameter(this.parameters.ENDS,e)}},{key:"getEndDate",value:function(){var e=this.getParameter(this.parameter.ENDS);return e&&(e=new Date(e)),e}},{key:"between",value:function(e,t){return this.setBetween(e,t),this}},{key:"setBetween",value:function(e,t){this.begins(e),this.ends(t)}},{key:"resourceTypes",value:function(e){return this.setResourceTypes(e),this}},{key:"setResourceTypes",value:function(e){e&&"undefined"===e.push&&(e=[e]),this.setParameter(this.parameters.RESOURCE_TYPE,e)}},{key:"getResourceTypes",value:function(){return this.getParameter(this.parameters.RESOURCE_TYPE)}},{key:"facets",value:function(e){return this.setFacets(e),this}},{key:"setFacets",value:function(e){this.query.includeFacets=e}},{key:"getFacets",value:function(){return this.query.includeFacets}},{key:"fields",value:function(e){return this.setFields(e),this}},{key:"setFields",value:function(e){e&&void 0===e.push&&(e=[e]),this.query.fields=e}},{key:"getFields",value:function(){return this.query.fields}},{key:"start",value:function(e){return this.setStart(e),this}},{key:"setStart",value:function(e){isNaN(e)||(this.query.start=e)}},{key:"getStart",value:function(){return this.query.start}},{key:"page",value:function(e){return this.setPage(e),this}},{key:"setPage",value:function(e){isNaN(e)||(this.query.start=e*this.query.size)}},{key:"getPage",value:function(){return this.query.start}},{key:"pageSize",value:function(e){return this.setPageSize(e),this}},{key:"setPageSize",value:function(e){if(!isNaN(e)){this.query.size=e;var t=Math.floor(1*this.query.start/this.query.size*1);this.query.start=t*(1*this.query.size)}}},{key:"getPageSize",value:function(){return this.query.size}},{key:"sort",value:function(e,t){return this.setSort(e,t),this}},{key:"setSort",value:function(e,t){t=!t||"asc"===t&&"desc"===t?t:"desc",e&&e.indexOf(",")<0&&(e=e+","+t),this.query.sort=e}},{key:"getSort",value:function(){return this.query.sort}},{key:"getSortField",value:function(){return this.query.sort.split(",")[0]}},{key:"getSortOrder",value:function(){return"asc"===this.query.sort.split(",")[1]}},{key:"getSortOptions",value:function(){return this.sortOptions.slice(0)}},{key:"clear",value:function(){this.query=this.defaultQuery}}]),e}()}),function(e,t){"function"==typeof define&&define.amd?define(["Query"],function(r){return e.QueryFactory=t(r)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.QueryFactory=t(require("Query")):GeoPlatform.QueryFactory=t(GeoPlatform.Query)}(window,function(e){return function(){return new e}}),function(e,t){"function"==typeof define&&define.amd?define(["q","GeoPlatform"],function(r,i){return e.ItemService=t(r,i)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.ItemService=t(require("q"),require("GeoPlatform")):GeoPlatform.ItemService=t(Q,GeoPlatform)}(window,function(e,t){return function(){function r(){_classCallCheck(this,r),this.baseUrl=t.ualUrl+"/api/items",this.timeout=t.timeout||1e4}return _createClass(r,[{key:"timeout",value:function(e){this.timeout=e}},{key:"get",value:function(t){return e.reject(new Error("Must use a subclass of ItemService"))}},{key:"save",value:function(t){return e.reject(new Error("Must use a subclass of ItemService"))}},{key:"remove",value:function(t){return e.reject(new Error("Must use a subclass of ItemService"))}},{key:"patch",value:function(t,r){return e.reject(new Error("Must use a subclass of ItemService"))}},{key:"search",value:function(t){return e.reject(new Error("Must use a subclass of ItemService"))}}]),r}()}),function(e,t){"function"==typeof define&&define.amd?define(["jquery","q","GeoPlatform","ItemService"],function(r,i,n,s){return e.JQueryItemService=t(r,i,n,s)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.JQueryItemService=t(require("jquery"),require("q"),require("GeoPlatform"),require("ItemService")):GeoPlatform.JQueryItemService=t(jQuery,Q,GeoPlatform,GeoPlatform.ItemService)}(window,function(e,t,r,i){var n=["GET","POST","PUT","DELETE","PATCH"];return function(r){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this))}return _inherits(i,r),_createClass(i,[{key:"get",value:function(r,i){var n=this;return t.resolve(!0).then(function(){var s=n.buildRequest("GET",n.baseUrl+"/"+r,null,i),u=t.defer();return s.success=function(e){u.resolve(e)},s.error=function(e,t,r){u.reject(new Error(r))},e.ajax(s),u.promise}).catch(function(e){var r=new Error("ItemService.save() - Error fetching item: "+e.message);return t.reject(r)})}},{key:"save",value:function(r,i){var n=this;return t.resolve(!0).then(function(){var s="POST",u=n.baseUrl;r.id&&(s="PUT",u+="/"+r.id);var a=n.buildRequest(s,u,r,i),o=t.defer();return a.success=function(e){o.resolve(e)},a.error=function(e,t,r){o.reject(new Error(r))},e.ajax(a),o.promise}).catch(function(e){var r=new Error("ItemService.save() - Error saving item: "+e.message);return t.reject(r)})}},{key:"remove",value:function(r,i){var n=this;return t.resolve(!0).then(function(){var s=n.buildRequest("DELETE",n.baseUrl+"/"+r,null,i),u=t.defer();return s.success=function(e){u.resolve(!0)},s.error=function(e,t,r){u.reject(new Error(r))},e.ajax(s),u.promise}).catch(function(e){var r=new Error("ItemService.save() - Error deleting item: "+e.message);return t.reject(r)})}},{key:"patch",value:function(r,i,n){var s=this;return t.resolve(!0).then(function(){var u=s.buildRequest("PATCH",s.baseUrl+"/"+r,i,n),a=t.defer();return u.success=function(e){a.resolve(e)},u.error,e.ajax(u),a.promise}).catch(function(e){var r=new Error("ItemService.save() - Error patching item: "+e.message);return t.reject(r)})}},{key:"search",value:function(r,i){var n=this;return t.resolve(!0).then(function(){var s=r;r&&void 0!==r.getQuery&&(s=r.getQuery());var u=n.buildRequest("GET",n.baseUrl,s,i),a=t.defer();return u.success=function(e){a.resolve(e)},u.error=function(e,t,r){a.reject(new Error(r))},e.ajax(u),a.promise}).catch(function(e){var r=new Error("ItemService.search() - Error searching items: "+e.message);return t.reject(r)})}},{key:"buildRequest",value:function(e,t,r,i){if(n.indexOf(e)<0)throw new Error("Unsupported HTTP method "+e);if(!t)throw new Error("Must specify a URL for HTTP requests");var s={method:e,url:t,dataType:"json",timeout:this.timeout};if(r&&(s.data=r,"POST"!==e&&"PUT"!==e&&"PATCH"!==e||(s.processData=!1,s.contentType="application/json")),i&&"object"===(void 0===i?"undefined":_typeof(i)))for(var u in i)i.hasOwnProperty(u)&&(s[u]=i[u]);return s}}]),i}(i)}),function(e,t){"function"==typeof define&&define.amd?define(["jquery","q","GeoPlatform","JQueryItemService"],function(r,i,n,s){return e.JQueryMapService=t(r,i,n,s)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.JQueryMapService=t(require("jquery"),require("q"),require("GeoPlatform"),require("JQueryItemService")):GeoPlatform.JQueryMapService=t(jQuery,Q,GeoPlatform,GeoPlatform.JQueryItemService)}(window,function(e,t,r,i){return function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.baseUrl=r.ualUrl+"/api/maps",e}return _inherits(t,e),t}(i)}),function(e,t){"function"==typeof define&&define.amd?define(["jquery","q","GeoPlatform","JQueryItemService"],function(r,i,n,s){return e.JQueryLayerService=t(r,i,n,s)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.JQueryLayerService=t(require("jquery"),require("q"),require("GeoPlatform"),require("JQueryItemService")):GeoPlatform.JQueryLayerService=t(jQuery,Q,GeoPlatform,GeoPlatform.JQueryItemService)}(window,function(e,t,r,i){return function(i){function n(){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.baseUrl=r.ualUrl+"/api/layers",e}return _inherits(n,i),_createClass(n,[{key:"style",value:function(r){var i=this;return t.resolve(!0).then(function(){var n=t.defer(),s=i.baseUrl+"/"+id+"/style",u=i.buildRequest("GET",s,null,r);return u.success=function(e){n.resolve(e)},u.error=function(e,t,r){var i="GeoPlatform.LayerService.style() - Error fetching item style: "+r,s=new Error(i);n.reject(s)},e.ajax(u),n.promise}).catch(function(e){var r=new Error("ItemService.save() - Error deleting item: "+e.message);return t.reject(r)})}},{key:"describe",value:function(r,i){var n=this;return t.resolve(!0).then(function(){if(!r)throw new Error("Must provide describe req");var s=["bbox","height","width","x","y"],u=s.find(function(e){return!r[e]});if(u)throw new Error("Must specify "+u+" in describe req");var a={srs:"EPSG:4326",bbox:r.bbox,height:r.height,width:r.width,info_format:"text/xml",x:r.x,y:r.y,i:r.x,j:r.y},o=t.defer(),c=n.baseUrl+"/"+id+"/describe",l=n.buildRequest("GET",c,a,i);return l.success=function(e){o.resolve(e)},l.error=function(e,t,r){o.reject(new Error(r))},e.ajax(l),o.promise}).catch(function(e){var r=new Error("JQueryLayerService.describe() -\n                    Error describing layer feature: "+e.message);return t.reject(r)})}}]),n}(i)}),function(e,t){"function"==typeof define&&define.amd?define(["jquery","q","GeoPlatform","JQueryItemService"],function(r,i,n,s){return e.JQueryServiceService=t(r,i,n,s)}):"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e.JQueryServiceService=t(require("jquery"),require("q"),require("GeoPlatform"),require("JQueryItemService")):GeoPlatform.JQueryServiceService=t(jQuery,Q,GeoPlatform,GeoPlatform.JQueryItemService)}(window,function(e,t,r,i){return function(i){function n(){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.baseUrl=r.ualUrl+"/api/services",e}return _inherits(n,i),_createClass(n,[{key:"about",value:function(r,i){var n=this;return t.resolve(!0).then(function(){if(!r)throw new Error("Must provide service to get metadata about");var s=t.defer(),u=n.buildRequest("POST",n.baseUrl+"/about",r,i);return u.success=function(e){s.resolve(e)},u.error=function(e,t,r){s.reject(new Error(r))},e.ajax(u),s.promise}).catch(function(e){var r=new Error("JQueryServiceService.about() -\n                    Error describing service: "+e.message);return t.reject(r)})}}]),n}(i)});