/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Query, ItemService } from "@geoplatform/client";
import ServiceProxy from './base';
const ɵ0 = function (svc, req) {
    return svc.search(req.query);
}, ɵ1 = function (svc, req) {
    return svc.get(req.params.id);
}, ɵ2 = function (svc, req) {
    return svc.save(req.body);
}, ɵ3 = function (svc, req) {
    return svc.save(req.body);
}, ɵ4 = function (svc, req) {
    return svc.remove(req.params.id);
}, ɵ5 = function (
// @ts-ignore
// @ts-ignore
result, res) {
    res.status(204).end();
}, ɵ6 = function (svc, req) {
    return svc.patch(req.params.id, req.body);
}, ɵ7 = function (svc, req) {
    return svc.export(req.params.id, req.query.format);
}, ɵ8 = function (result, res) {
    /** @type {?} */
    let mimeType = result.headers['content-type'];
    /** @type {?} */
    let disposition = result.headers['content-disposition'];
    res.set("Content-Type", mimeType);
    res.setHeader('Content-disposition', disposition);
    res.send(result.body);
}, ɵ9 = function (svc, req) {
    return svc.getUri(req.body);
}, ɵ10 = function (result, res) {
    res.json({ uri: result });
}, ɵ11 = function (svc, req) {
    return svc.getUri(req.body)
        .then(uri => {
        /** @type {?} */
        let fields = ['serviceType', 'services', 'scheme', 'themes', 'publishers', 'keywords'];
        /** @type {?} */
        let query = new Query().uri(uri).fields(fields);
        return svc.search(query);
    });
}, ɵ12 = function (svc, req) {
    /** @type {?} */
    let input = req.body.url || req.files.file;
    return svc.import(input, req.query.format);
}, ɵ13 = function (svc, req) {
    return svc.associations(req.params.id, req.query);
}, ɵ14 = function (svc, req) {
    return svc.versions(req.params.id);
}, ɵ15 = function (svc, req) {
    return svc.get(req.params.id, { version: req.params.version });
};
/** @type {?} */
const Routes = [
    {
        key: 'search',
        method: 'get',
        path: 'items',
        auth: false,
        execFn: ɵ0
    },
    {
        key: 'get',
        method: 'get',
        path: 'items/:id',
        auth: false,
        execFn: ɵ1
    },
    {
        key: 'create',
        method: 'post',
        path: 'items',
        auth: true,
        execFn: ɵ2
    },
    {
        key: 'update',
        method: 'put',
        path: 'items/:id',
        auth: true,
        execFn: ɵ3
    },
    {
        key: 'delete',
        method: 'delete',
        path: 'items/:id',
        auth: true,
        execFn: ɵ4,
        respFn: ɵ5
    },
    {
        key: 'patch',
        method: 'patch',
        path: 'items/:id',
        auth: true,
        execFn: ɵ6
    },
    {
        key: 'export',
        method: 'get',
        path: 'items/:id/export',
        auth: false,
        execFn: ɵ7,
        respFn: ɵ8
    },
    {
        key: 'uri',
        method: 'post',
        path: 'items/uri',
        auth: false,
        execFn: ɵ9,
        respFn: ɵ10
    },
    {
        key: 'exists',
        method: 'post',
        path: 'items/exists',
        auth: false,
        execFn: ɵ11
    },
    {
        key: 'import',
        method: 'post',
        path: 'items/import',
        auth: true,
        execFn: ɵ12
    },
    {
        key: 'associations',
        method: 'get',
        path: 'items/:id/associations',
        auth: false,
        execFn: ɵ13
    },
    {
        key: 'versions',
        method: 'get',
        path: 'items/:id/versions',
        auth: false,
        execFn: ɵ14
    },
    {
        key: 'getVersion',
        method: 'get',
        path: 'items/:id/versions/:version',
        auth: false,
        execFn: ɵ15
    }
];
/**
 *
 * @param {?} router
 * @param {?=} options
 * @return {?}
 */
function bindRoutes(router, options) {
    //bind common endpoints
    options.pathBaseDefault = "items";
    options.serviceClass = ItemService;
    ServiceProxy.bindRoutes(router, Routes, options);
}
/**
 * ItemServiceProxy
 *
 * see examples/node/item-proxy for an in-depth example
 * @param {?=} options
 * @return {?}
 */
function ItemServiceProxy(options) {
    if (typeof (options) === 'undefined') {
        options = {};
    }
    ;
    /** @type {?} */
    let router = options.router;
    if (!options.router) {
        /** @type {?} */
        let express = require('express');
        if (!express) {
            throw new Error("ItemServiceProxy() - Must provide" +
                "'options.router' or include express as a dependency");
        }
        router = express.Router();
    }
    if (!router)
        throw new Error("ItemServiceProxy() - " +
            "Unable to create proxy route, missing router");
    bindRoutes(router, options);
    return router;
}
export default ItemServiceProxy;
export { ɵ0, ɵ1, ɵ2, ɵ3, ɵ4, ɵ5, ɵ6, ɵ7, ɵ8, ɵ9, ɵ10, ɵ11, ɵ12, ɵ13, ɵ14, ɵ15 };

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXRlbS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BnZW9wbGF0Zm9ybS9jbGllbnQvbm9kZS8iLCJzb3VyY2VzIjpbInNlcnZpY2VzL3Byb3hpZXMvaXRlbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN6RCxPQUFPLFlBQVksTUFBTSxRQUFRLENBQUM7V0FRbEIsVUFBUyxHQUFpQixFQUFFLEdBQVM7SUFDekMsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztDQUNoQyxPQU9PLFVBQVMsR0FBaUIsRUFBRSxHQUFTO0lBQ3pDLE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0NBQ2pDLE9BT08sVUFBUyxHQUFpQixFQUFFLEdBQVM7SUFDekMsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztDQUM3QixPQU9PLFVBQVMsR0FBaUIsRUFBRSxHQUFTO0lBQ3pDLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7Q0FDN0IsT0FPTyxVQUFTLEdBQWlCLEVBQUUsR0FBUztJQUN6QyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztDQUNwQyxPQUNPOztBQUVKLEFBREEsYUFBYTtBQUNiLE1BQVksRUFDWixHQUFTO0lBQ1QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztDQUN6QixPQU9PLFVBQVMsR0FBaUIsRUFBRSxHQUFTO0lBQ3pDLE9BQU8sR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7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Q0FBOEMsQ0FBQyxDQUFDO0lBRXBELFVBQVUsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFFNUIsT0FBTyxNQUFNLENBQUM7Q0FDakI7QUFFRCxlQUFlLGdCQUFnQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgeyBRdWVyeSwgSXRlbVNlcnZpY2UgfSBmcm9tIFwiQGdlb3BsYXRmb3JtL2NsaWVudFwiO1xuaW1wb3J0IFNlcnZpY2VQcm94eSBmcm9tICcuL2Jhc2UnO1xuXG5jb25zdCBSb3V0ZXMgPSBbXG4gICAge1xuICAgICAgICBrZXk6ICdzZWFyY2gnLFxuICAgICAgICBtZXRob2Q6ICdnZXQnLFxuICAgICAgICBwYXRoOiAnaXRlbXMnLFxuICAgICAgICBhdXRoOiBmYWxzZSxcbiAgICAgICAgZXhlY0ZuOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLnNlYXJjaChyZXEucXVlcnkpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleTogJ2dldCcsXG4gICAgICAgIG1ldGhvZDogJ2dldCcsXG4gICAgICAgIHBhdGg6ICdpdGVtcy86aWQnLFxuICAgICAgICBhdXRoOiBmYWxzZSxcbiAgICAgICAgZXhlY0ZuOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLmdldChyZXEucGFyYW1zLmlkKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBrZXk6ICdjcmVhdGUnLFxuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgcGF0aDogJ2l0ZW1zJyxcbiAgICAgICAgYXV0aDogdHJ1ZSxcbiAgICAgICAgZXhlY0ZuOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLnNhdmUocmVxLmJvZHkpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleTogJ3VwZGF0ZScsXG4gICAgICAgIG1ldGhvZDogJ3B1dCcsXG4gICAgICAgIHBhdGg6ICdpdGVtcy86aWQnLFxuICAgICAgICBhdXRoOiB0cnVlLFxuICAgICAgICBleGVjRm46IGZ1bmN0aW9uKHN2YyA6IEl0ZW1TZXJ2aWNlLCByZXEgOiBhbnkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdmMuc2F2ZShyZXEuYm9keSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5OiAnZGVsZXRlJyxcbiAgICAgICAgbWV0aG9kOiAnZGVsZXRlJyxcbiAgICAgICAgcGF0aDogJ2l0ZW1zLzppZCcsXG4gICAgICAgIGF1dGg6IHRydWUsXG4gICAgICAgIGV4ZWNGbjogZnVuY3Rpb24oc3ZjIDogSXRlbVNlcnZpY2UsIHJlcSA6IGFueSkge1xuICAgICAgICAgICAgcmV0dXJuIHN2Yy5yZW1vdmUocmVxLnBhcmFtcy5pZCk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlc3BGbjogZnVuY3Rpb24oXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICByZXN1bHQgOiBhbnksXG4gICAgICAgICAgICByZXMgOiBhbnkpIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoMjA0KS5lbmQoKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBrZXk6ICdwYXRjaCcsXG4gICAgICAgIG1ldGhvZDogJ3BhdGNoJyxcbiAgICAgICAgcGF0aDogJ2l0ZW1zLzppZCcsXG4gICAgICAgIGF1dGg6IHRydWUsXG4gICAgICAgIGV4ZWNGbjogZnVuY3Rpb24oc3ZjIDogSXRlbVNlcnZpY2UsIHJlcSA6IGFueSkge1xuICAgICAgICAgICAgcmV0dXJuIHN2Yy5wYXRjaChyZXEucGFyYW1zLmlkLCByZXEuYm9keSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5OiAnZXhwb3J0JyxcbiAgICAgICAgbWV0aG9kOiAnZ2V0JyxcbiAgICAgICAgcGF0aDogJ2l0ZW1zLzppZC9leHBvcnQnLFxuICAgICAgICBhdXRoOiBmYWxzZSxcbiAgICAgICAgZXhlY0ZuOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLmV4cG9ydChyZXEucGFyYW1zLmlkLCByZXEucXVlcnkuZm9ybWF0KTsgfSxcbiAgICAgICAgcmVzcEZuOiBmdW5jdGlvbihyZXN1bHQgOiBhbnksIHJlcyA6IGFueSkge1xuICAgICAgICAgICAgbGV0IG1pbWVUeXBlID0gcmVzdWx0LmhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddO1xuICAgICAgICAgICAgbGV0IGRpc3Bvc2l0aW9uID0gcmVzdWx0LmhlYWRlcnNbJ2NvbnRlbnQtZGlzcG9zaXRpb24nXTtcbiAgICAgICAgICAgIHJlcy5zZXQoXCJDb250ZW50LVR5cGVcIiwgbWltZVR5cGUpO1xuICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1kaXNwb3NpdGlvbicsIGRpc3Bvc2l0aW9uKTtcbiAgICAgICAgICAgIHJlcy5zZW5kKHJlc3VsdC5ib2R5KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBrZXk6ICd1cmknLFxuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgcGF0aDogJ2l0ZW1zL3VyaScsXG4gICAgICAgIGF1dGg6IGZhbHNlLFxuICAgICAgICBleGVjRm46IGZ1bmN0aW9uKHN2YyA6IEl0ZW1TZXJ2aWNlLCByZXEgOiBhbnkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdmMuZ2V0VXJpKHJlcS5ib2R5KTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVzcEZuOiBmdW5jdGlvbihyZXN1bHQgOiBhbnksIHJlcyA6IGFueSkge1xuICAgICAgICAgICAgcmVzLmpzb24oeyB1cmk6IHJlc3VsdCB9KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBrZXk6ICdleGlzdHMnLFxuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgcGF0aDogJ2l0ZW1zL2V4aXN0cycsXG4gICAgICAgIGF1dGg6IGZhbHNlLFxuICAgICAgICBleGVjRm46IGZ1bmN0aW9uKHN2YyA6IEl0ZW1TZXJ2aWNlLCByZXEgOiBhbnkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdmMuZ2V0VXJpKHJlcS5ib2R5KVxuICAgICAgICAgICAgLnRoZW4oIHVyaSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGZpZWxkcyA9IFsnc2VydmljZVR5cGUnLCdzZXJ2aWNlcycsJ3NjaGVtZScsJ3RoZW1lcycsJ3B1Ymxpc2hlcnMnLCdrZXl3b3JkcyddO1xuICAgICAgICAgICAgICAgIGxldCBxdWVyeSA6IFF1ZXJ5ID0gbmV3IFF1ZXJ5KCkudXJpKHVyaSkuZmllbGRzKGZpZWxkcyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN2Yy5zZWFyY2gocXVlcnkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5OiAnaW1wb3J0JyxcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIHBhdGg6ICdpdGVtcy9pbXBvcnQnLFxuICAgICAgICBhdXRoOiB0cnVlLFxuICAgICAgICBleGVjRm46IGZ1bmN0aW9uKHN2YyA6IEl0ZW1TZXJ2aWNlLCByZXEgOiBhbnkpIHtcbiAgICAgICAgICAgIGxldCBpbnB1dCA9IHJlcS5ib2R5LnVybCB8fCByZXEuZmlsZXMuZmlsZTtcbiAgICAgICAgICAgIHJldHVybiBzdmMuaW1wb3J0KGlucHV0LCByZXEucXVlcnkuZm9ybWF0KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBrZXk6ICdhc3NvY2lhdGlvbnMnLFxuICAgICAgICBtZXRob2Q6ICdnZXQnLFxuICAgICAgICBwYXRoOiAnaXRlbXMvOmlkL2Fzc29jaWF0aW9ucycsXG4gICAgICAgIGF1dGg6IGZhbHNlLFxuICAgICAgICBleGVjRm46IGZ1bmN0aW9uKHN2YyA6IEl0ZW1TZXJ2aWNlLCByZXEgOiBhbnkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdmMuYXNzb2NpYXRpb25zKHJlcS5wYXJhbXMuaWQsIHJlcS5xdWVyeSk7IH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5OiAndmVyc2lvbnMnLFxuICAgICAgICBtZXRob2Q6ICdnZXQnLFxuICAgICAgICBwYXRoOiAnaXRlbXMvOmlkL3ZlcnNpb25zJyxcbiAgICAgICAgYXV0aDogZmFsc2UsXG4gICAgICAgIGV4ZWNGbjogZnVuY3Rpb24oc3ZjIDogSXRlbVNlcnZpY2UsIHJlcSA6IGFueSkge1xuICAgICAgICAgICAgcmV0dXJuIHN2Yy52ZXJzaW9ucyhyZXEucGFyYW1zLmlkKTsgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBrZXk6ICdnZXRWZXJzaW9uJyxcbiAgICAgICAgbWV0aG9kOiAnZ2V0JyxcbiAgICAgICAgcGF0aDogJ2l0ZW1zLzppZC92ZXJzaW9ucy86dmVyc2lvbicsXG4gICAgICAgIGF1dGg6IGZhbHNlLFxuICAgICAgICBleGVjRm46IGZ1bmN0aW9uKHN2YyA6IEl0ZW1TZXJ2aWNlLCByZXEgOiBhbnkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdmMuZ2V0KHJlcS5wYXJhbXMuaWQsIHsgdmVyc2lvbjogcmVxLnBhcmFtcy52ZXJzaW9uIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gVE9ETyBmaW5kTXVsdGlwbGVcbl07XG5cbi8qKlxuICpcbiAqL1xuZnVuY3Rpb24gYmluZFJvdXRlcyhyb3V0ZXIgOiBhbnksIG9wdGlvbnMgPzogYW55KSB7XG4gICAgLy9iaW5kIGNvbW1vbiBlbmRwb2ludHNcbiAgICBvcHRpb25zLnBhdGhCYXNlRGVmYXVsdCA9IFwiaXRlbXNcIjtcbiAgICBvcHRpb25zLnNlcnZpY2VDbGFzcyA9IEl0ZW1TZXJ2aWNlO1xuICAgIFNlcnZpY2VQcm94eS5iaW5kUm91dGVzKHJvdXRlciwgUm91dGVzLCBvcHRpb25zKTtcbn1cblxuXG5cblxuLyoqXG4gKiBJdGVtU2VydmljZVByb3h5XG4gKlxuICogc2VlIGV4YW1wbGVzL25vZGUvaXRlbS1wcm94eSBmb3IgYW4gaW4tZGVwdGggZXhhbXBsZVxuICovXG5mdW5jdGlvbiBJdGVtU2VydmljZVByb3h5KCBvcHRpb25zID86IGFueSApIHtcblxuICAgIGlmKHR5cGVvZihvcHRpb25zKSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgIH07XG5cbiAgICBsZXQgcm91dGVyID0gb3B0aW9ucy5yb3V0ZXI7XG4gICAgaWYoIW9wdGlvbnMucm91dGVyKSB7XG4gICAgICAgIGxldCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuICAgICAgICBpZighZXhwcmVzcykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSXRlbVNlcnZpY2VQcm94eSgpIC0gTXVzdCBwcm92aWRlXCIgK1xuICAgICAgICAgICAgICAgIFwiJ29wdGlvbnMucm91dGVyJyBvciBpbmNsdWRlIGV4cHJlc3MgYXMgYSBkZXBlbmRlbmN5XCIpO1xuICAgICAgICB9XG4gICAgICAgIHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG4gICAgfVxuXG4gICAgaWYoIXJvdXRlcikgdGhyb3cgbmV3IEVycm9yKFwiSXRlbVNlcnZpY2VQcm94eSgpIC0gXCIgK1xuICAgICAgICBcIlVuYWJsZSB0byBjcmVhdGUgcHJveHkgcm91dGUsIG1pc3Npbmcgcm91dGVyXCIpO1xuXG4gICAgYmluZFJvdXRlcyhyb3V0ZXIsIG9wdGlvbnMpO1xuXG4gICAgcmV0dXJuIHJvdXRlcjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgSXRlbVNlcnZpY2VQcm94eTtcbiJdfQ==