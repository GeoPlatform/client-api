{"version":3,"sources":["node_modules/tslib/tslib.es6.js","ng://@geoplatform/client/shared/error.ts","ng://@geoplatform/client/shared/types.ts","ng://@geoplatform/client/shared/uri-factory.ts","ng://@geoplatform/client/shared/parameters.ts","ng://@geoplatform/client/shared/kg-query.ts","ng://@geoplatform/client/shared/classifiers.ts","ng://@geoplatform/client/shared/query.ts","ng://@geoplatform/client/shared/config.ts","ng://@geoplatform/client/http/client.ts","ng://@geoplatform/client/http/xhr.ts","ng://@geoplatform/client/services/item.ts","ng://@geoplatform/client/services/dataset.ts","ng://@geoplatform/client/services/map.ts","ng://@geoplatform/client/services/layer.ts","ng://@geoplatform/client/services/service.ts","ng://@geoplatform/client/services/gallery.ts","ng://@geoplatform/client/services/utils.ts","ng://@geoplatform/client/services/agol.ts","ng://@geoplatform/client/services/tracking.ts","ng://@geoplatform/client/services/kg.ts","ng://@geoplatform/client/shared/polyfills.ts","ng://@geoplatform/client/index.ts","ng://@geoplatform/client/shared/query-factory.ts","ng://@geoplatform/client/services/factory.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","this","constructor","prototype","create","_super","GPError","tslib_1.__extends","Error","setError","value","error","setStatus","status","statusCode","message","_this","call","ItemTypes","DATASET","SERVICE","LAYER","MAP","GALLERY","COMMUNITY","APPLICATION","TOPIC","WEBSITE","IMAGE_PRODUCT","ORGANIZATION","CONTACT","PERSON","CONCEPT","CONCEPT_SCHEME","STANDARD","RIGHTS_STATEMENT","ItemTypeLabels","URI_BASE","ESRI_TYPES","formatReference","ref","toLowerCase","replace","result","prop","fixServiceHref","service","stripLayerFromServiceHref","type","serviceType","conformsTo","indexOf","uri","href","accessURL","matches","match","length","url","lastChar","trim","substring","URIFactory","factories","register","factory","object","md5Fn","dataset","md5","pubName","publisher","publishers","map","pub","label","join","title","layer","svcUrl","services","servicedBy","lyrUrl","args","layerName","author","createdBy","_createdBy","identifiers","identifier","gallery","community","org","name","person","vcard","email","hasEmail","tel","orgName","positionTitle","scheme","inScheme","schemeRef","prefLabel","item","landingPage","productId","Parameters","ALTERNATE_TITLE","BEGINS","CLASSIFIERS","CREATED","CREATED_BEFORE","CREATED_AFTER","CREATED_BY","CREATOR","CONTRIBUTED_BY","ENDS","EXTENT","IDENTIFIERS","KEYWORDS","LAST_MODIFIED_BY","MODIFIED","MODIFIED_BEFORE","MODIFIED_AFTER","PUBLISHERS_ID","PUBLISHERS_LABEL","PUBLISHERS_URI","CONTACTS_ID","CONTACTS_LABEL","CONTACTS_URI","QUERY","SCHEMES_ID","SCHEMES_LABEL","SCHEMES_URI","SIMILAR_TO","STATUS","SERVICE_TYPES","THEMES_ID","THEMES_LABEL","THEMES_URI","TOPICS_ID","TOPICS_LABEL","TOPICS_URI","TYPES","URI","USED_BY_ID","USED_BY_LABEL","USED_BY_URI","VISIBILITY","RESOURCE_TYPE","LANDING_PAGE","PURPOSE","RELIABILITY","RELIABILITY_MIN","RELIABILITY_MAX","ONLINE","COMPLIANT","SPEED","SPEED_MIN","SPEED_MAX","LIKES","LIKES_MIN","LIKES_MAX","VIEWS","VIEWS_MIN","VIEWS_MAX","HREF","LAYER_TYPE","LAYER_NAME","PARENT_LAYER","SUB_LAYER","MAP_LAYER","GALLERY_ITEM","FACETS","FIELDS","SORT","PAGE","PAGE_SIZE","FOR_TYPES","SORT_OPTIONS_DEFAULT","KGQuery","getQuery","query","parameter","setParameter","undefined","getParameter","key","applyParameters","obj","q","text","setQ","QueryParameters","getQ","classifiers","types","setClassifiers","getClassifiers","objTypes","setTypes","getTypes","page","setPage","isNaN","getPage","nextPage","previousPage","pageSize","size","setPageSize","getPageSize","sort","order","setSort","getSort","getSortField","split","getSortOrder","getSortOptions","slice","clear","defaultQuery","Classifiers","FUNCTION","TOPIC_PRIMARY","TOPIC_SECONDARY","SUBJECT_PRIMARY","SUBJECT_SECONDARY","AUDIENCE","PLACE","CATEGORY","Fields","ACCESS_RIGHTS","ALTERNATE_TITLES","ANNOTATIONS","CONTACTS","DATASETS","DESCRIPTION","DISTRIBUTIONS","GALLERY_ITEMS","LABEL","LAYERS","LEGEND","PUBLISHERS","RESOURCE_TYPES","SERVICE_TYPE","SERVICES","SPATIAL","STATISTICS","SUB_LAYERS","TEMPORAL","THEMES","THUMBNAIL","TOPICS","USED_BY","FIELDS_DEFAULT","Facets","CONCEPT_SCHEMES","FACETS_DEFAULT","FacetToParam","BBOX_REGEX","toArray","Query","clone","json","JSON","parse","stringify","setFacetParameter","facet","param","console","log","keywords","setKeywords","getKeywords","setUri","getUri","user","setCreatedBy","getCreatedBy","lastModifiedBy","setLastModifiedBy","getLastModifiedBy","themes","setThemes","getThemes","topics","setTopics","getTopics","setPublishers","getPublishers","contacts","setContacts","getContacts","usedBy","ids","setUsedBy","getUsedBy","schemes","setSchemes","getSchemes","serviceTypes","setServiceTypes","getServiceTypes","visibility","vis","setVisibility","getVisibility","getStatus","extent","bbox","setExtent","toBboxString","test","getExtent","classifier","setClassifier","getClassifier","isArray","classes","keys","k","forEach","modified","date","beforeOrAfter","setModified","Date","dir","oppProp","arg","getTime","getModified","created","setCreated","getCreated","begins","setBeginDate","getBeginDate","ends","setEndDate","getEndDate","between","begin","end","setBetween","resourceTypes","setResourceTypes","getResourceTypes","facets","names","setFacets","getFacets","addFacet","push","removeFacet","idx","splice","fields","setFields","getFields","addField","field","removeField","options","toString","assign","Config","ualUrl","configure","GPHttpClient","setTimeout","timeout","setAuthToken","token","createRequestOpts","execute","opts","Q.reject","XHRHttpClient","method","Authorization","o","promise","axios","then","response","data","catch","err","Q.resolve","ItemService","setUrl","baseUrl","apiBase","milliseconds","_timeout","setLogger","logger","logError","e","logDebug","msg","debug","get","id","version","buildRequest","save","itemObj","remove","patch","overrides","search","params","ps","import","format","isFile","ro","processData","formData","overwrite","export","responseType","getMultiple","exists","uris","like","view","associations","versions","httpMethods","request","client","httpClient","DatasetService","MapService","LayerService","style","describe","req","missing","find","srs","height","width","info_format","x","y","i","j","validate","ServiceService","about","svc","results","harvest","liveTest","statistics","GalleryService","addItem","galleryId","removeItem","itemId","UtilsService","capabilities","property","parseFile","file","locate","location","AgolQuery","_query","val","groups","setGroups","getGroups","orgs","setOrgs","getOrgs","AgolService","getOrg","searchOrgs","getGroup","searchGroups","getItem","searchItems","getAgolId","filter","Categories","UNKNOWN","KNOWLEDGE_GRAPH","USER","COMMUNITY_POST","COMMUNITY_PAGE","APP_PAGE","Events","ACCESSED","DISPLAYED","VIEWED","EDITED","DELETED","CLONED","ADDED","REMOVED","EXPORTED","IMPORTED","Event","getCategory","category","getType","setItem","getRelated","related","setRelated","DefaultTrackingServiceProvider","logEvent","event","logSearch","resultCount","TrackingService","setProvider","provider","evt","pageView","logPageView","KGService","suggest","_search","sources","Polyfills","apply","defineProperty","target","varArgs","TypeError","to","index","arguments","nextSource","nextKey","writable","configurable","queryFactory","factoryFn","TrackingEventFactory","eventType","layers","layerState","layerEvents","concat","baseLayer","baseEvents","cats","cat"],"mappings":"uWAgBA,IAAIA,EAAgB,SAASC,EAAGC,GAI5B,OAHAF,EAAgBG,OAAOC,gBAClB,CAAEC,UAAW,cAAgBC,OAAS,SAAUL,EAAGC,GAAKD,EAAEI,UAAYH,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIK,KAAKL,EAAOA,EAAEM,eAAeD,KAAIN,EAAEM,GAAKL,EAAEK,MACpDN,EAAGC,IAG5B,SAAAO,EAA0BR,EAAGC,GAEzB,SAAAQ,IAAgBC,KAAKC,YAAcX,EADnCD,EAAcC,EAAGC,GAEjBD,EAAEY,UAAkB,OAANX,EAAaC,OAAOW,OAAOZ,IAAMQ,EAAGG,UAAYX,EAAEW,UAAW,IAAIH,GCzBnF,IAAAK,EAAAC,GAAsBC,EAAAA,EAAtBF,EAAsBG,OAQXF,EAAAH,UAAAM,kBAASC,GAAgBT,KAAKU,MAAQD,GACtCJ,EAAAH,UAAAS,mBAAUF,GAAgBT,KAAKY,OAASZ,KAAKa,WAAaJ,MALjE,SAAAJ,EAAYS,GAAZ,IAAAC,EACIX,EAAAY,KAAAhB,KAAMc,IAAQd,qBAHM,iBACK,IAGzBe,EAAKL,MAAQ,OCLrB,IAAMO,EAAY,CACdC,QAAkB,eAClBC,QAAkB,eAClBC,MAAkB,QAClBC,IAAkB,MAClBC,QAAkB,UAClBC,UAAkB,YAClBC,YAAkB,cAClBC,MAAkB,QAClBC,QAAkB,UAClBC,cAAkB,aAClBC,aAAkB,mBAClBC,QAAkB,cAClBC,OAAkB,cAClBC,QAAkB,eAClBC,eAAkB,qBAClBC,SAAkB,eAClBC,iBAAkB,uBAGhBC,EAAiB,GACvBA,EAAelB,EAAUC,SAAoB,UAC7CiB,EAAelB,EAAUE,SAAoB,UAC7CgB,EAAelB,EAAUG,OAAoB,QAC7Ce,EAAelB,EAAUI,KAAoB,MAC7Cc,EAAelB,EAAUK,SAAoB,UAC7Ca,EAAelB,EAAUM,WAAoB,YAC7CY,EAAelB,EAAUO,aAAoB,cAC7CW,EAAelB,EAAUQ,OAAoB,QAC7CU,EAAelB,EAAUS,SAAoB,UAC7CS,EAAelB,EAAUU,eAAoB,gBAC7CQ,EAAelB,EAAUW,cAAoB,eAC7CO,EAAelB,EAAUY,SAAoB,UAC7CM,EAAelB,EAAUa,QAAoB,SAC7CK,EAAelB,EAAUc,SAAoB,UAC7CI,EAAelB,EAAUe,gBAAoB,iBAC7CG,EAAelB,EAAUgB,UAAoB,WAC7CE,EAAelB,EAAUiB,kBAAoB,mBClC7C,IAAME,EAAW,6BAEXC,EAAa,CACf,oDACA,kDACA,gDACA,kDAMJ,SAAAC,EAA0BC,GACtB,GAAW,OAARA,EAAc,MAAO,GACxB,GAAmB,iBAAhB,EACC,OAAOA,EAAIC,cAAcC,QAAQ,MAAM,IACtC,GAAmB,iBAAhB,EAaR,MAAO,GAZH,IAAIC,EAAS,GACb,IAAI,IAAIC,KAAQJ,EACZ,GAAGA,EAAI1C,eAAe8C,GAAO,CACzB,IAAIlC,EAAQ8B,EAAII,GACblC,MAAAA,IAECiC,IAAWjC,EAAM,IAAI+B,cAAcC,QAAQ,MAAM,KAI7D,OAAOC,EAWf,SAAAE,EAAwBC,IAiCxB,SAAAC,EAAmCD,GAE/B,IAAIA,EAAS,OACb,IAAIE,EAAOF,EAAQG,aAAeH,EAAQI,WAC1C,IAAIF,EAAM,OAGV,GAAoC,GAAhCV,EAAWa,QAAQH,EAAKI,KAAY,CAEpC,IAAIC,EAAOP,EAAQO,MAAQP,EAAQQ,UAC/BC,EAAUF,EAAKG,MAAM,qCACtBD,GAA4B,EAAjBA,EAAQE,SAIlBJ,EAAOA,EAAKX,QAAQa,EAAQ,GAAI,WAE7BT,EAAQO,OAAMP,EAAQO,KAAOA,GAC7BP,EAAQQ,YAAWR,EAAQQ,UAAYD,KAlDlDN,CAA0BD,GAC1B,IAAIY,EAAMZ,EAAQQ,WAAaR,EAAQO,KACvC,IAAIK,IAAQA,EAAID,OAAQ,OAAO,KAiB/B,IAAIE,GATJD,GAFAA,GAFAA,GAAOA,EAAM,IAAIE,OAAOnB,eAEdC,QAAQ,gBAAgB,KAExBA,QAAQ,uBAAuB,IAC/BA,QAAQ,+BAA+B,IACvCA,QAAQ,sBAAsB,IAC9BA,QAAQ,+BAAgC,IACxCA,QAAQ,wBAAyB,IACjCA,QAAQ,wBAAyB,IACjCA,QAAQ,wBAAyB,IACjCA,QAAQ,oBAAqB,KAEpBgB,EAAID,OAAO,GAI9B,MAHI,MAAQE,GAAY,MAAQA,IAC5BD,EAAMA,EAAIG,UAAU,EAAGH,EAAID,OAAO,IAE/BC,MAsCLI,EAAa,CAEfC,UAAY,GAEZC,SAAW,SAAUhB,EAAeiB,GAChChE,KAAK8D,UAAUf,GAAQiB,GAG3B7D,OAAS,SAAS8D,EAAcC,GAC5B,IAAID,IAAWA,EAAOlB,KAAM,OAAO,KACnC,GAAsB,mBAAlB,EACA,MAAM,IAAIxC,MAAM,qDAEpB,IAAIyD,EAAUhE,KAAK8D,UAAUG,EAAOlB,MACpC,OAAIiB,EACGA,EAAQC,EAAQC,GADH,OAQ5BL,EAAWE,SAAS9C,EAAUC,QAAS,SAASiD,EAAeC,GAC3D,IAAIC,GAAWF,EAAQG,WAAWH,EAAQI,YAAY,IACjDC,IAAK,SAAAC,GAAS,OAAOA,EAAIC,OAAO,KAAOC,KAAK,IAC7CpC,EAAYD,EAAgB,CAC5BsC,MAAOT,EAAQS,MACfH,IAAKJ,IAET,OAAOjC,EAAW,eAAiBgC,EAAI7B,KAG3CsB,EAAWE,SAAS9C,EAAUE,QAAS,SAAS0B,EAAeuB,GAC3D,IACI7B,EAAMD,EADAM,EAAeC,IAEzB,OAAOT,EAAW,eAAiBgC,EAAI7B,KAG3CsB,EAAWE,SAAS9C,EAAUG,MAAO,SAASyD,EAAaT,GAEvD,IAAIU,EAAS,GACTC,EAAWF,EAAMG,YAAcH,EAAME,SACtCA,GAAYA,EAASvB,SACpBsB,EAASC,EAAS,GAAG1B,WAAa0B,EAAS,GAAG3B,MAAQ,IAC1D,IAAI6B,EAASJ,EAAMxB,WAAawB,EAAMzB,MAAQ,GAO1C8B,EAAOJ,GANGD,EAAMM,WAAa,IAMHF,EAC9B,IAAIC,EAAK1B,OAAQ,OAAO,KAGxB,IAAIjB,EAAMD,EAAgB4C,GAC1B,OAAO9C,EAAW,aAAegC,EAAI7B,KASzCsB,EAAWE,SAAS9C,EAAUI,IAAK,SAASmD,EAAWJ,GACnD,IAAIgB,EAASZ,EAAIa,WAAab,EAAIc,YAAc,GAC5CC,GAAef,EAAIe,aAAef,EAAIgB,YAAc,IAAIb,KAAK,IAC7DpC,EAAMD,EAAgB,CAACsC,MAAOJ,EAAII,MAAOQ,OAAQA,EAAQG,YAAaA,IAC1E,OAAOnD,EAAW,WAAagC,EAAI7B,KAGvCsB,EAAWE,SAAS9C,EAAUK,QAAS,SAASmE,EAAerB,GAC3D,IAAIgB,EAASK,EAAQJ,WAAaI,EAAQH,YAAc,GACpD/C,EAAMD,EAAgB,CAACsC,MAAOa,EAAQb,MAAOQ,OAAQA,IACzD,OAAOhD,EAAW,eAAiBgC,EAAI7B,KAG3CsB,EAAWE,SAAS9C,EAAUM,UAAW,SAASmE,EAAiBtB,GAC/D,IAAI7B,EAAMD,EAAgB,CAACsC,MAAOc,EAAUd,QAC5C,OAAOxC,EAAW,iBAAmBgC,EAAI7B,KAG7CsB,EAAWE,SAAS9C,EAAUW,aAAc,SAAS+D,EAAWvB,GAC5D,IAAI7B,EAAMD,EAAgBqD,EAAIjB,OAASiB,EAAIC,MAC3C,OAAOxD,EAAW,oBAAsBgC,EAAI7B,KAGhDsB,EAAWE,SAAS9C,EAAUa,OAAQ,SAAS+D,EAAczB,GACzD,IAAI7B,EAAMD,EAAgBuD,EAAOD,MACjC,OAAOxD,EAAW,cAAgBgC,EAAI7B,KAG1CsB,EAAWE,SAAS9C,EAAUY,QAAS,SAASiE,EAAa1B,GACzD,IAAI7B,EAAY,GAUhB,OATGuD,EAAMC,OAASD,EAAME,YACpBzD,EAAIwD,MAAQD,EAAMC,OAASD,EAAME,UAClCF,EAAMG,MACL1D,EAAI0D,IAAMH,EAAMG,MACjBH,EAAMI,SAAWJ,EAAM,wBACtBvD,EAAI2D,QAAUJ,EAAMI,SAAWJ,EAAM,sBACtCA,EAAMK,gBACL5D,EAAI4D,cAAgBL,EAAMK,eAC9B5D,EAAMD,EAAgBC,GACfH,EAAW,eAAiBgC,EAAI7B,KAG3CsB,EAAWE,SAAS9C,EAAUc,QAAS,SAASkC,EAAcG,GAC1D,IAAIgC,EAASnC,EAAOoC,UAAYpC,EAAOmC,OAEnCE,EAAYhE,EADE8D,EAAUA,EAAO1B,OAAS0B,EAAOG,UAAa,IAE5DhE,EAAMD,EAAiB2B,EAAOS,OAAST,EAAOsC,WAClD,OAAOnE,EAAW,0BAA4BgC,EAAIkC,GAAa,IAAMlC,EAAI7B,KAG7EsB,EAAWE,SAAS9C,EAAUe,eAAgB,SAASiC,EAAcG,GACjE,IAAI7B,EAAMD,EAAgB2B,EAAOS,OAAST,EAAOsC,WACjD,OAAOnE,EAAW,0BAA4BgC,EAAI7B,KAItDsB,EAAWE,SAAS9C,EAAUO,YAAa,SAASyC,EAAcG,GAC9D,IAAIH,IAAWA,EAAOW,MAAO,OAAO,KACpC,IAAIQ,EAASnB,EAAOoB,WAAapB,EAAOqB,YAAc,GAClD/C,EAAMD,EAAgB,CAACsC,MAAOX,EAAOW,MAAOQ,OAAQA,IACxD,OAAOhD,EAAW,mBAAqBgC,EAAI7B,KAG/CsB,EAAWE,SAAS9C,EAAUQ,MAAO,SAASwC,EAAcG,GACxD,IAAIH,IAAWA,EAAOW,MAAO,OAAO,KACpC,IAAIQ,EAASnB,EAAOoB,WAAapB,EAAOqB,YAAc,GAClD/C,EAAMD,EAAgB,CAACsC,MAAOX,EAAOW,MAAOQ,OAAQA,IACxD,OAAOhD,EAAW,aAAegC,EAAI7B,KAGzCsB,EAAWE,SAAS9C,EAAUS,QAAS,SAAS8E,EAAYpC,GACxD,IAAIoC,IAASA,EAAKC,YAAa,OAAO,KACtC,IAAIlE,EAAMD,EAAgBkE,EAAKC,aAC/B,OAAOrE,EAAW,eAAiBgC,EAAI7B,KAG3CsB,EAAWE,SAAS9C,EAAUU,cAAe,SAAS6E,EAAYpC,GAC9D,IAAIoC,EAAKE,UAAW,OAAO,KAC3B,IAAInE,EAAMD,EAAgBkE,EAAKE,WAC/B,OAAOtE,EAAW,eAAiBgC,EAAI7B,KCvP3C,IAAAoE,EAAe,CACXC,gBAAmB,kBACnBC,OAAmB,gBACnBC,YAAmB,cACnBC,QAAmB,UACnBC,eAAmB,cACnBC,cAAmB,cACnBC,WAAmB,YACnBC,QAAmB,aACnBC,eAAmB,gBACnBC,KAAmB,cACnBC,OAAmB,SACnBC,YAAmB,cACnBC,SAAmB,WACnBC,iBAAmB,iBACnBC,SAAmB,WACnBC,gBAAmB,eACnBC,eAAmB,eACnBC,cAAmB,eACnBC,iBAAmB,kBACnBC,eAAmB,gBACnBC,YAAmB,cACnBC,eAAmB,iBACnBC,aAAmB,eACnBC,MAAmB,IACnBC,WAAmB,YACnBC,cAAmB,eACnBC,YAAmB,aACnBC,WAAmB,YACnBC,OAAmB,SACnBC,cAAmB,iBACnBC,UAAmB,WACnBC,aAAmB,cACnBC,WAAmB,YACnBC,UAAmB,WACnBC,aAAmB,cACnBC,WAAmB,YACnBC,MAAmB,OACnBC,IAAmB,MACnBC,WAAmB,YACnBC,cAAmB,eACnBC,YAAmB,aACnBC,WAAmB,aACnBC,cAAmB,eACnBpI,QAAmB,UACnBqI,aAAmB,cACnBC,QAAmB,UAGnBC,YAAmB,cACnBC,gBAAmB,kBACnBC,gBAAmB,kBACnBC,OAAmB,SACnBC,UAAmB,YACnBC,MAAmB,QACnBC,UAAmB,YACnBC,UAAmB,YACnBC,MAAmB,QACnBC,UAAmB,YACnBC,UAAmB,YACnBC,MAAmB,QACnBC,UAAmB,YACnBC,UAAmB,YAGnBC,KAAmB,OACnBC,WAAmB,YACnBC,WAAmB,YACnBC,aAAmB,cACnBC,UAAmB,WACnBxJ,QAAmB,UACnByJ,UAAmB,WACnBC,aAAmB,cAGnBC,OAAmB,gBACnBC,OAAmB,SACnBC,KAAmB,OACnBC,KAAmB,OACnBC,UAAmB,OAGnBC,UAAmB,OC9EjBC,EAA2D,CAC7D,CAAE3K,MAAM,YAAmBiE,MAAO,cAClC,CAAEjE,MAAM,aAAmBiE,MAAO,cAClC,CAAEjE,MAAM,WAAmBiE,MAAO,cAClC,CAAEjE,MAAM,YAAmBiE,MAAO,cAClC,CAAEjE,MAAM,gBAAmBiE,MAAO,0BAClC,CAAEjE,MAAM,eAAmBiE,MAAO,2BAClC,CAAEjE,MAAM,cAAmBiE,MAAO,cAItC2G,GAsBIA,EAAAnL,UAAAoL,SAAA,WACI,IAAI5I,EAAoB,GACxB,IAAI,IAAIC,KAAQ3C,KAAKuL,MAAO,CACxB,IAAI9K,EAAQT,KAAKuL,MAAM5I,GACV,OAAVlC,GAAyC,oBAAhBA,EAAU,OAClCA,EAAQA,EAAMkE,KAAK,MAEvBjC,EAAOC,GAAQlC,EAEnB,OAAOiC,GAOX2I,EAAAnL,UAAAsL,UAAA,SAAU5F,EAAenF,GAErB,OADAT,KAAKyL,aAAa7F,EAAMnF,GACjBT,MAGXqL,EAAAnL,UAAAuL,aAAA,SAAc7F,EAAenF,GACZ,OAAVA,GAAkBA,IAAUiL,iBACpB1L,KAAKuL,MAAM3F,GAElB5F,KAAKuL,MAAM3F,GAAQnF,GAG3B4K,EAAAnL,UAAAyL,aAAA,SAAcC,GACV,OAAO5L,KAAKuL,MAAMK,IAGtBP,EAAAnL,UAAA2L,gBAAA,SAAiBC,GACb,IAAI,IAAIlM,KAAKkM,EACNA,EAAIjM,eAAeD,IAClBI,KAAKyL,aAAa7L,EAAGkM,EAAIlM,KASrCyL,EAAAnL,UAAA6L,EAAA,SAAEC,GAEE,OADAhM,KAAKiM,KAAKD,GACHhM,MAMXqL,EAAAnL,UAAA+L,KAAA,SAAMD,GACFhM,KAAKyL,aAAaS,EAAgB/D,MAAO6D,IAG7CX,EAAAnL,UAAAiM,KAAA,WACI,OAAOnM,KAAK2L,aAAaO,EAAgB/D,QAU7CkD,EAAAnL,UAAAkM,YAAA,SAAYC,GAER,OADArM,KAAKsM,eAAeD,GACbrM,MAMXqL,EAAAnL,UAAAoM,eAAA,SAAgBD,GACRA,IACiB,iBAAlB,IAA4BA,EAAQA,EAAQ,CAACA,IAChDrM,KAAKyL,aAAaS,EAAgBlD,MAAOqD,KAM7ChB,EAAAnL,UAAAqM,eAAA,WACI,OAAOvM,KAAK2L,aAAaO,EAAgBlD,QAc7CqC,EAAAnL,UAAAmM,MAAA,SAAMG,GAEF,OADAxM,KAAKyM,SAASD,GACPxM,MAUXqL,EAAAnL,UAAAuM,SAAA,SAAUD,GACFA,IACoB,iBAArB,IAA+BA,EAAW,CAACA,IAC9CxM,KAAKyL,aAAaS,EAAgBf,UAAWqB,KAUjDnB,EAAAnL,UAAAwM,SAAA,WACI,OAAO1M,KAAK2L,aAAaO,EAAgBf,YAU7CE,EAAAnL,UAAAyM,KAAA,SAAMA,GAEF,OADA3M,KAAK4M,QAAQD,GACN3M,MAGXqL,EAAAnL,UAAA0M,QAAA,SAAQD,GACDE,MAAMF,IAAc,EAALA,EAAO,IACzB3M,KAAKuL,MAAK,KAAa,EAALoB,IAGtBtB,EAAAnL,UAAA4M,QAAA,WACI,OAAO9M,KAAKuL,MAAK,MAGrBF,EAAAnL,UAAA6M,SAAA,WACI/M,KAAK4M,QAAQ5M,KAAKuL,MAAK,KAAM,IAGjCF,EAAAnL,UAAA8M,aAAA,WACIhN,KAAK4M,QAAQ5M,KAAKuL,MAAK,KAAM,IAUjCF,EAAAnL,UAAA+M,SAAA,SAAUC,GAEN,OADAlN,KAAKmN,YAAYD,GACVlN,MAGXqL,EAAAnL,UAAAiN,YAAA,SAAaD,GACNL,MAAMK,IAAc,EAALA,EAAO,IACzBlN,KAAKuL,MAAK,KAAa,EAAL2B,IAGtB7B,EAAAnL,UAAAkN,YAAA,WACI,OAAOpN,KAAKuL,MAAK,MAWrBF,EAAAnL,UAAAmN,KAAA,SAAMA,EAAeC,GAEjB,OADAtN,KAAKuN,QAAQF,EAAMC,GACZtN,MAOVqL,EAAAnL,UAAAqN,QAAA,SAAQF,EAAeC,GACnBA,EAAQA,GAAS,OACdD,GAAQA,EAAKnK,QAAQ,KAAK,IAC1BmK,EAAOA,EAAO,IAAMC,GACvBtN,KAAKuL,MAAK,KAAQ8B,GAGvBhC,EAAAnL,UAAAsN,QAAA,WACI,OAAOxN,KAAKuL,MAAK,MAGrBF,EAAAnL,UAAAuN,aAAA,WACI,OAAOzN,KAAKuL,MAAK,KAAMmC,MAAM,KAAK,IAGtCrC,EAAAnL,UAAAyN,aAAA,WACI,MAAyC,QAAlC3N,KAAKuL,MAAK,KAAMmC,MAAM,KAAK,IAMtCrC,EAAAnL,UAAA0N,eAAA,WACI,OAAOxC,EAAqByC,MAAM,IAUtCxC,EAAAnL,UAAA4N,MAAA,WACI9N,KAAKuL,MAAQvL,KAAK+N,iBAtPtB,SAAA1C,IAEIrL,KAAK+N,aAAe,CAChBpB,KAAM,EACNO,KAAM,GACNG,KAAM,iBAGVrN,KAAKuL,MAAQ,CACToB,KAAM,EACNO,KAAM,GACNG,KAAM,iBC9BlB,IAAAW,EAAgB,CACZxE,QAAsB,UACtByE,SAAsB,WACtBC,cAAsB,eACtBC,gBAAsB,iBACtBC,gBAAsB,iBACtBC,kBAAsB,mBACtB9M,UAAsB,YACtB+M,SAAsB,WACtBC,MAAsB,QACtBC,SAAsB,YCPpBC,EAAuB,CACzBC,cAAsB,SACtBC,iBAAsB,kBACtBC,YAAsB,cACtB9H,YAAsB,cACtB9E,eAAsB,SACtB6M,SAAsB,WACtB9H,QAAsB,UACtBG,WAAsB,YACtB4H,SAAsB,WACtBC,YAAsB,cACtBC,cAAsB,gBACtB1H,OAAsB,SACtB2H,cAAsB,QACtB1E,KAAsB,OACtBhD,YAAsB,cACtBC,SAAsB,WACtB0H,MAAsB,QACtBzH,iBAAsB,iBACtB0H,OAAsB,SACtB3E,WAAsB,YACtBC,WAAsB,YACtB2E,OAAsB,SACtB1H,SAAsB,WACtBgD,aAAsB,cACtB2E,WAAsB,aACtBC,eAAsB,gBACtBC,aAAsB,cACtBC,SAAsB,WACtBC,QAAsB,UACtBC,WAAsB,aACtBlH,OAAsB,SACtBmH,WAAsB,YACtBC,SAAsB,WACtBC,OAAsB,SACtBC,UAAsB,YACtBC,OAAsB,SACtBC,QAAsB,SACtB3G,WAAsB,aACtBE,aAAsB,eAGpB0G,EAA4B,CAC9BxB,EAAM,QAAUA,EAAM,SAAWA,EAAM,WACvCA,EAAM,WAAaA,EAAM,OAASA,EAAM,aAKtCyB,EAAuB,CACzBvB,iBAAsB,kBACtBwB,gBAAsB,UACtBjJ,WAAsB,YACtBqD,KAAsB,OACtBhD,YAAsB,cACtBiD,WAAsB,YACtBC,WAAsB,YACtBR,MAAsB,QACtBL,OAAsB,SACtByF,WAAsB,aACtBR,SAAsB,WACtBpF,YAAsB,cACtBhB,cAAsB,eACtBqB,MAAsB,QACtBtB,OAAsB,SACtBqH,OAAsB,SACtBE,OAAsB,SACtB/G,MAAsB,OACtBgH,QAAsB,SACtB5F,MAAsB,QACtBf,WAAsB,cAGpB+G,EAA4B,CAC9BF,EAAM,MACNA,EAAM,WACNA,EAAM,cACNA,EAAM,gBACNA,EAAM,WACNA,EAAM,YAUJG,EAA6B,GACnCA,EAAaH,EAAM,OAAoBvJ,EAAWqC,MAClDqH,EAAaH,EAAM,QAAoBvJ,EAAW+B,UAClD2H,EAAaH,EAAM,QAAoBvJ,EAAWkC,UAClDwH,EAAaH,EAAM,YAAoBvJ,EAAWkB,cAClDwI,EAAaH,EAAM,UAAoBvJ,EAAWqB,YAClDqI,EAAaH,EAAM,iBAAoBvJ,EAAWyB,WAClDiI,EAAaH,EAAM,SAAoBvJ,EAAWuC,WAOlD,IAAMkC,EAA6D,CAC/D,CAAE3K,MAAM,YAAmBiE,MAAO,cAClC,CAAEjE,MAAM,aAAmBiE,MAAO,cAClC,CAAEjE,MAAM,WAAmBiE,MAAO,cAClC,CAAEjE,MAAM,YAAmBiE,MAAO,cAClC,CAAEjE,MAAM,gBAAmBiE,MAAO,0BAClC,CAAEjE,MAAM,eAAmBiE,MAAO,2BAClC,CAAEjE,MAAM,cAAmBiE,MAAO,cAIhC4L,EAAa,gEAGnB,SAAAC,EAAiB9P,GACb,IAAIiC,EAASjC,EAKb,OAHc,OAAXiC,GAA2C,oBAAjBA,EAAW,OAAmBA,EAAS,CAACA,IAEvD,OAAXA,GAAoBA,EAAOc,SAAQd,EAAS,MACxCA,EAWX,IAAA8N,GA6BIA,EAAAtQ,UAAAoL,SAAA,WACI,IAAI5I,EAAoB,GACxB,IAAI,IAAIC,KAAQ3C,KAAKuL,MAAO,CACxB,IAAI9K,EAAQT,KAAKuL,MAAM5I,GACV,OAAVlC,GAAyC,oBAAhBA,EAAU,OAClCA,EAAQA,EAAMkE,KAAK,MAEvBjC,EAAOC,GAAQlC,EAEnB,OAAOiC,GAMX8N,EAAAtQ,UAAAuQ,MAAA,WACI,IAAI/N,EAAS,IAAI8N,EACbE,EAAOC,KAAKC,MAAMD,KAAKE,UAAU7Q,KAAKuL,QAE1C,OADA7I,EAAOmJ,gBAAgB6E,GAChBhO,GAWX8N,EAAAtQ,UAAAsL,UAAA,SAAU5F,EAAenF,GAErB,OADAT,KAAKyL,aAAa7F,EAAMnF,GACjBT,MAOXwQ,EAAAtQ,UAAAuL,aAAA,SAAc7F,EAAenF,GACZ,OAAVA,GAAkBA,IAAUiL,WACH,oBAAhBjL,EAAU,OAAsBA,EAAM+C,cACvCxD,KAAKuL,MAAM3F,GAElB5F,KAAKuL,MAAM3F,GAAQnF,GAO3B+P,EAAAtQ,UAAAyL,aAAA,SAAcC,GACV,OAAO5L,KAAKuL,MAAMK,IAMtB4E,EAAAtQ,UAAA2L,gBAAA,SAAiBC,GACb,IAAI,IAAIlM,KAAKkM,EACNA,EAAIjM,eAAeD,IAClBI,KAAKyL,aAAY,EAAcK,EAAIlM,KAU/C4Q,EAAAtQ,UAAA4Q,kBAAA,SAAmBC,EAAetQ,GAC9B,IAAIuQ,EAAiBX,EAAaU,GAC9BC,GACAC,QAAQC,IAAI,gFACqCH,EAAQ,kEAG7D/Q,KAAKyL,aAAauF,GAAOD,EAAOtQ,IAUpC+P,EAAAtQ,UAAA6L,EAAA,SAAEC,GAA0C,OAAjBhM,KAAKiM,KAAKD,GAAchM,MAGnDwQ,EAAAtQ,UAAA+L,KAAA,SAAMD,GAAwBhM,KAAKyL,aAAa9E,EAAWwB,MAAO6D,IAElEwE,EAAAtQ,UAAAiM,KAAA,WAAkB,OAAOnM,KAAK2L,aAAahF,EAAWwB,QAMtDqI,EAAAtQ,UAAAiR,SAAA,SAASnF,GAEL,OADAhM,KAAKoR,YAAYpF,GACVhM,MAMXwQ,EAAAtQ,UAAAkR,YAAA,SAAapF,GACThM,KAAKyL,aAAa9E,EAAWa,SAAU+I,EAAQvE,KAGnDwE,EAAAtQ,UAAAmR,YAAA,WACI,OAAOrR,KAAK2L,aAAahF,EAAWa,WAOxCgJ,EAAAtQ,UAAAiD,IAAA,SAAKA,GAED,OADAnD,KAAKsR,OAAOnO,GACLnD,MAGXwQ,EAAAtQ,UAAAoR,OAAA,SAAOnO,GACHnD,KAAKyL,aAAa9E,EAAWsC,IAAK9F,IAGtCqN,EAAAtQ,UAAAqR,OAAA,WACI,OAAOvR,KAAK2L,aAAahF,EAAWsC,MAOxCuH,EAAAtQ,UAAAmM,MAAA,SAAMA,GAEF,OADArM,KAAKyM,SAASJ,GACPrM,MAMXwQ,EAAAtQ,UAAAuM,SAAA,SAAUJ,GACNrM,KAAKyL,aAAa9E,EAAWqC,MAAOuH,EAAQlE,KAGhDmE,EAAAtQ,UAAAwM,SAAA,WACI,OAAO1M,KAAK2L,aAAahF,EAAWqC,QAOxCwH,EAAAtQ,UAAAmF,UAAA,SAAUmM,GAEN,OADAxR,KAAKyR,aAAaD,GACXxR,MAIXwQ,EAAAtQ,UAAAuR,aAAA,SAAcD,GACVxR,KAAKyL,aAAa9E,EAAWO,WAAYsK,IAI7ChB,EAAAtQ,UAAAwR,aAAA,WACI,OAAO1R,KAAK2L,aAAahF,EAAWO,aAOxCsJ,EAAAtQ,UAAAyR,eAAA,SAAeH,GAEX,OADAxR,KAAK4R,kBAAkBJ,GAChBxR,MAIXwQ,EAAAtQ,UAAA0R,kBAAA,SAAmBJ,GACfxR,KAAKyL,aAAa9E,EAAWc,iBAAkB+J,IAInDhB,EAAAtQ,UAAA2R,kBAAA,WACI,OAAO7R,KAAK2L,aAAahF,EAAWc,mBAiBxC+I,EAAAtQ,UAAA4R,OAAA,SAAOA,EAAyBtG,GAE5B,OADAxL,KAAK+R,UAAUD,EAAQtG,GAChBxL,MAYXwQ,EAAAtQ,UAAA6R,UAAA,SAAWD,EAAwBtG,GAG/BxL,KAAKyL,aAAa9E,EAAW+B,UAAW,MACxC1I,KAAKyL,aAAa9E,EAAWgC,aAAc,MAC3C3I,KAAKyL,aAAa9E,EAAWiC,WAAY,MAEzC,IAAIoI,EAAQxF,GAAa7E,EAAW+B,UACpC1I,KAAKyL,aAAauF,EAAOT,EAAQuB,KAGrCtB,EAAAtQ,UAAA8R,UAAA,WACI,OAAOhS,KAAK2L,aAAahF,EAAW+B,YAChC1I,KAAK2L,aAAahF,EAAWgC,eAC7B3I,KAAK2L,aAAahF,EAAWiC,aAgBrC4H,EAAAtQ,UAAA+R,OAAA,SAAOA,EAAwBzG,GAE3B,OADAxL,KAAKkS,UAAUD,EAAQzG,GAChBxL,MAYXwQ,EAAAtQ,UAAAgS,UAAA,SAAWD,EAAwBzG,GAG/BxL,KAAKyL,aAAa9E,EAAWkC,UAAW,MACxC7I,KAAKyL,aAAa9E,EAAWmC,aAAc,MAC3C9I,KAAKyL,aAAa9E,EAAWoC,WAAY,MAEzC,IAAIiI,EAAQxF,GAAa7E,EAAWkC,UACpC7I,KAAKyL,aAAauF,EAAOT,EAAQ0B,KAGrCzB,EAAAtQ,UAAAiS,UAAA,WACI,OAAOnS,KAAK2L,aAAahF,EAAWkC,YAChC7I,KAAK2L,aAAahF,EAAWmC,eAC7B9I,KAAK2L,aAAahF,EAAWoC,aAerCyH,EAAAtQ,UAAAqE,WAAA,SAAWA,EAA4BiH,GAEnC,OADAxL,KAAKoS,cAAc7N,EAAYiH,GACxBxL,MAUXwQ,EAAAtQ,UAAAkS,cAAA,SAAe7N,EAA4BiH,GAGvCxL,KAAKyL,aAAa9E,EAAWkB,cAAe,MAC5C7H,KAAKyL,aAAa9E,EAAWmB,iBAAkB,MAC/C9H,KAAKyL,aAAa9E,EAAWoB,eAAgB,MAE7C,IAAIiJ,EAAQxF,GAAa7E,EAAWkB,cACpC7H,KAAKyL,aAAauF,EAAOT,EAAQhM,KAGrCiM,EAAAtQ,UAAAmS,cAAA,WACI,OAAOrS,KAAK2L,aAAahF,EAAWkB,gBAChC7H,KAAK2L,aAAahF,EAAWmB,mBAC7B9H,KAAK2L,aAAahF,EAAWoB,iBAerCyI,EAAAtQ,UAAAoS,SAAA,SAASA,EAA0B9G,GAE/B,OADAxL,KAAKuS,YAAYD,EAAU9G,GACpBxL,MAUXwQ,EAAAtQ,UAAAqS,YAAA,SAAaD,EAA0B9G,GAGnCxL,KAAKyL,aAAa9E,EAAWqB,YAAa,MAC1ChI,KAAKyL,aAAa9E,EAAWsB,eAAgB,MAC7CjI,KAAKyL,aAAa9E,EAAWuB,aAAc,MAE3C,IAAI8I,EAAQxF,GAAa7E,EAAWqB,YACpChI,KAAKyL,aAAauF,EAAOT,EAAQ+B,KAGrC9B,EAAAtQ,UAAAsS,YAAA,WACI,OAAOxS,KAAK2L,aAAahF,EAAWqB,cAChChI,KAAK2L,aAAahF,EAAWsB,iBAC7BjI,KAAK2L,aAAahF,EAAWuB,eAiBrCsI,EAAAtQ,UAAAuS,OAAA,SAAOC,EAAqBlH,GAExB,OADAxL,KAAK2S,UAAUD,EAAKlH,GACbxL,MAYXwQ,EAAAtQ,UAAAyS,UAAA,SAAWD,EAAqBlH,GAG5BxL,KAAKyL,aAAa9E,EAAWuC,WAAY,MACzClJ,KAAKyL,aAAa9E,EAAWwC,cAAe,MAC5CnJ,KAAKyL,aAAa9E,EAAWyC,YAAa,MAE1C,IAAI4H,EAAQxF,GAAa7E,EAAWuC,WACpClJ,KAAKyL,aAAauF,EAAOT,EAAQmC,KAGrClC,EAAAtQ,UAAA0S,UAAA,WACI,OAAO5S,KAAK2L,aAAahF,EAAWuC,aAChClJ,KAAK2L,aAAahF,EAAWwC,gBAC7BnJ,KAAK2L,aAAahF,EAAWyC,cAiBrCoH,EAAAtQ,UAAA2S,QAAA,SAAQA,EAAyBrH,GAE7B,OADAxL,KAAK8S,WAAWD,EAASrH,GAClBxL,MAYXwQ,EAAAtQ,UAAA4S,WAAA,SAAYD,EAAyBrH,GAGjCxL,KAAKyL,aAAa9E,EAAWyB,WAAY,MACzCpI,KAAKyL,aAAa9E,EAAW0B,cAAe,MAC5CrI,KAAKyL,aAAa9E,EAAW2B,YAAa,MAE1C,IAAI0I,EAAQxF,GAAa7E,EAAWyB,WACpCpI,KAAKyL,aAAauF,EAAOT,EAAQsC,KAGrCrC,EAAAtQ,UAAA6S,WAAA,WACI,OAAO/S,KAAK2L,aAAahF,EAAWyB,aAChCpI,KAAK2L,aAAahF,EAAW0B,gBAC7BrI,KAAK2L,aAAahF,EAAW2B,cASrCkI,EAAAtQ,UAAA8S,aAAA,SAAa3G,GAET,OADArM,KAAKiT,gBAAgB5G,GACdrM,MAMXwQ,EAAAtQ,UAAA+S,gBAAA,SAAiB5G,GACbrM,KAAKyL,aAAa9E,EAAW8B,cAAe8H,EAAQlE,KAGxDmE,EAAAtQ,UAAAgT,gBAAA,WACI,OAAOlT,KAAK2L,aAAahF,EAAW8B,gBAOxC+H,EAAAtQ,UAAAiT,WAAA,SAAWC,GAEP,OADApT,KAAKqT,cAAcD,GACZpT,MAMXwQ,EAAAtQ,UAAAmT,cAAA,SAAeF,GACXnT,KAAKyL,aAAa9E,EAAW0C,WAAY8J,IAG7C3C,EAAAtQ,UAAAoT,cAAA,WACI,OAAOtT,KAAK2L,aAAahF,EAAW0C,aAOxCmH,EAAAtQ,UAAAU,OAAA,SAAOH,GAEH,OADAT,KAAKW,UAAUF,GACRT,MAMXwQ,EAAAtQ,UAAAS,UAAA,SAAWF,GACPT,KAAKyL,aAAa9E,EAAW6B,OAAQ/H,IAGzC+P,EAAAtQ,UAAAqT,UAAA,WACI,OAAOvT,KAAK2L,aAAahF,EAAW6B,SAOxCgI,EAAAtQ,UAAAsT,OAAA,SAAOC,GAEH,OADAzT,KAAK0T,UAAUD,GACRzT,MAMXwQ,EAAAtQ,UAAAwT,UAAA,SAAWD,GACP,GAAGA,EACC,GAAiC,oBAAvBA,EAAiB,aAEvBA,EAAOA,EAAKE,oBAET,GAAyB,oBAAfF,EAAS,MAAqBA,EAAKjQ,QAGvB,oBAAlBiQ,EAAK,GAAO,KACnBA,EAAOA,EAAK,GAAG,GAAG,IAAIA,EAAK,GAAG,GAAG,IAAIA,EAAK,GAAG,GAAG,IAAIA,EAAK,GAAG,OAEzD,CAAA,GAAoB,iBAAjB,EAMN,MAAM,IAAIlT,MAAM,sFALhB,IAAI+P,EAAWsD,KAAKH,GAChB,MAAM,IAAIlT,MAAM,0EAQ5BP,KAAKyL,aAAa9E,EAAWW,OAAQmM,IAMzCjD,EAAAtQ,UAAA2T,UAAA,WACI,OAAO7T,KAAK2L,aAAahF,EAAWW,SAkBxCkJ,EAAAtQ,UAAA4T,WAAA,SAAWA,EAAqBrT,GAE5B,OADAT,KAAK+T,cAAcD,EAAYrT,GACxBT,MAaXwQ,EAAAtQ,UAAA6T,cAAA,SAAcD,EAAqBrT,GAC/B,IAAI2L,EAAcpM,KAAK2L,aAAahF,EAAWG,cAAgB,GAC/DsF,EAAY0H,GAAcvD,EAAQ9P,GAClCT,KAAKyL,aAAa9E,EAAWG,YAAasF,IAO9CoE,EAAAtQ,UAAA8T,cAAA,SAAcF,GAEV,OADkB9T,KAAK2L,aAAahF,EAAWG,cAAgB,IAC5CgN,IAAe,IAiBtCtD,EAAAtQ,UAAAkM,YAAA,SAAY3L,GAER,OADAT,KAAKsM,eAAe7L,GACbT,MAMXwQ,EAAAtQ,UAAAoM,eAAA,SAAgB7L,GACZ,GAAIA,GAA2B,iBAAlB,IAA8Bd,MAAMsU,QAAQxT,GAAzD,CAIA,IAAMyT,EAAU1U,OAAO2U,KAAKnG,GAAaxJ,IAAI,SAAA4P,GAAG,OAAApG,EAAYoG,KACxDhI,EAAcpM,KAAK2L,aAAahF,EAAWG,cAAgB,GAC/DtH,OAAO2U,KAAK1T,GAAO4T,QAAS,SAAAP,IACpBI,EAAQhR,QAAQ4Q,KAChB1H,EAAY0H,GAAcvD,EAAQ9P,EAAMqT,OAGhD9T,KAAKyL,aAAa9E,EAAWG,YAAasF,QAVtCpM,KAAKyL,aAAa9E,EAAWG,YAAa,OAgBlD0J,EAAAtQ,UAAAqM,eAAA,WACI,OAAOvM,KAAK2L,aAAahF,EAAWG,cAAgB,MAOxD0J,EAAAtQ,UAAAoU,SAAA,SAASC,EAAoBC,GAEzB,OADAxU,KAAKyU,YAAYF,EAAMC,GAChBxU,MAOXwQ,EAAAtQ,UAAAuU,YAAA,SAAaF,EAAoBC,GAG7B,IAAID,EAGA,OAFAvU,KAAKyL,aAAa9E,EAAWgB,gBAAiB,WAC9C3H,KAAKyL,aAAa9E,EAAWiB,eAAgB,MAI5C2M,aAAgBG,OACjBH,EAAO,IAAIG,KAAI,IAEnB,IAAIC,EAAMH,KAAoC,IAAlBA,GAA4C,SAAlBA,GAClD7R,EAAOgS,EAAMhO,EAAWgB,gBAAkBhB,EAAWiB,eACrDgN,EAAUD,EAAMhO,EAAWiB,eAAiBjB,EAAWgB,gBACvDkN,EAAON,GAAQA,EAAKO,QAAWP,EAAKO,UAAYP,EAEpDvU,KAAKyL,aAAamJ,EAAS,MAC3B5U,KAAKyL,aAAa9I,EAAMkS,IAG5BrE,EAAAtQ,UAAA6U,YAAA,WACI,IAAItU,EAAQT,KAAK2L,aAAahF,EAAWgB,kBACrC3H,KAAK2L,aAAahF,EAAWiB,gBAIjC,OAHGnH,GAA2B,iBAAlB,IACRA,EAAQ,IAAIiU,KAAKjU,IAEdA,GAOX+P,EAAAtQ,UAAA8U,QAAA,SAAQT,EAAoBC,GAExB,OADAxU,KAAKiV,WAAWV,EAAMC,GACfxU,MAOXwQ,EAAAtQ,UAAA+U,WAAA,SAAYV,EAAoBC,GAG5B,IAAID,EAGA,OAFAvU,KAAKyL,aAAa9E,EAAWK,eAAgB,WAC7ChH,KAAKyL,aAAa9E,EAAWM,cAAe,MAI3CsN,aAAgBG,OACjBH,EAAO,IAAIG,KAAI,IAEnB,IAAIC,EAAMH,KAAoC,IAAlBA,GAA4C,SAAlBA,GAClD7R,EAAOgS,EAAMhO,EAAWK,eAAiBL,EAAWM,cACpD2N,EAAUD,EAAMhO,EAAWM,cAAgBN,EAAWK,eACtD6N,EAAON,GAAQA,EAAKO,QAAWP,EAAKO,UAAYP,EAEpDvU,KAAKyL,aAAamJ,EAAS,MAC3B5U,KAAKyL,aAAa9I,EAAMkS,IAG5BrE,EAAAtQ,UAAAgV,WAAA,WACI,IAAIzU,EAAQT,KAAK2L,aAAahF,EAAWK,iBACrChH,KAAK2L,aAAahF,EAAWM,eAIjC,OAHGxG,GAA2B,iBAAlB,IACRA,EAAQ,IAAIiU,KAAKjU,IAEdA,GAOX+P,EAAAtQ,UAAAiV,OAAA,SAAOZ,GAEH,OADAvU,KAAKoV,aAAab,GACXvU,MAGXwQ,EAAAtQ,UAAAkV,aAAA,SAAcb,GACPA,GAAQA,aAAgBG,OACvBH,EAAOA,EAAKO,WAChB9U,KAAKyL,aAAa9E,EAAWE,OAAQ0N,IAGzC/D,EAAAtQ,UAAAmV,aAAA,WACI,IAAId,EAAOvU,KAAK2L,aAAahF,EAAWE,QAExC,OADG0N,IAAMA,EAAO,IAAIG,KAAKH,IAClBA,GAOX/D,EAAAtQ,UAAAoV,KAAA,SAAKf,GAED,OADAvU,KAAKuV,WAAWhB,GACTvU,MAGXwQ,EAAAtQ,UAAAqV,WAAA,SAAYhB,GACLA,GAAQA,aAAgBG,OACvBH,EAAOA,EAAKO,WAChB9U,KAAKyL,aAAa9E,EAAWU,KAAMkN,IAGvC/D,EAAAtQ,UAAAsV,WAAA,WACI,IAAIjB,EAAOvU,KAAK2L,aAAahF,EAAWU,MAExC,OADGkN,IAAMA,EAAO,IAAIG,KAAKH,IAClBA,GAOX/D,EAAAtQ,UAAAuV,QAAA,SAAQC,EAAqBC,GAEzB,OADA3V,KAAK4V,WAAWF,EAAOC,GAChB3V,MAGXwQ,EAAAtQ,UAAA0V,WAAA,SAAWF,EAAqBC,GAC5B3V,KAAKmV,OAAOO,GACZ1V,KAAKsV,KAAKK,IAOdnF,EAAAtQ,UAAA2V,cAAA,SAAcxJ,GAEV,OADArM,KAAK8V,iBAAiBzJ,GACfrM,MAGXwQ,EAAAtQ,UAAA4V,iBAAA,SAAiBzJ,GACbrM,KAAKyL,aAAa9E,EAAW2C,cAAeiH,EAAQlE,KAGxDmE,EAAAtQ,UAAA6V,iBAAA,WACI,OAAO/V,KAAK2L,aAAahF,EAAW2C,gBAOxCkH,EAAAtQ,UAAA8V,OAAA,SAAOC,GAEH,OADAjW,KAAKkW,UAAUD,GACRjW,MAMXwQ,EAAAtQ,UAAAgW,UAAA,SAAWD,GACPjW,KAAKyL,aAAa9E,EAAWmE,OAAQyF,EAAQ0F,KAGjDzF,EAAAtQ,UAAAiW,UAAA,WACI,OAAOnW,KAAK2L,aAAahF,EAAWmE,SAMxC0F,EAAAtQ,UAAAkW,SAAA,SAASxQ,GACL,IAAIoQ,EAAShW,KAAKmW,aAAe,GACjCH,EAAOK,KAAKzQ,GACZ5F,KAAKkW,UAAUF,IAMnBxF,EAAAtQ,UAAAoW,YAAA,SAAY1Q,GACR,IAAIoQ,EAAShW,KAAKmW,aAAe,GAC7BI,EAAMP,EAAO9S,QAAQ0C,GACjB,GAAL2Q,IACCP,EAAOQ,OAAOD,EAAK,GACnBvW,KAAKkW,UAAUF,KAQvBxF,EAAAtQ,UAAAuW,OAAA,SAAOA,GAEH,OADAzW,KAAK0W,UAAUD,GACRzW,MAMXwQ,EAAAtQ,UAAAwW,UAAA,SAAWD,GACPzW,KAAKyL,aAAa9E,EAAWoE,OAAQwF,EAAQkG,KAGjDjG,EAAAtQ,UAAAyW,UAAA,WACI,OAAO3W,KAAK2L,aAAahF,EAAWoE,SAMxCyF,EAAAtQ,UAAA0W,SAAA,SAASC,GACL,IAAIJ,EAASzW,KAAK2W,aAAe,GACjCF,EAAOJ,KAAKQ,GACZ7W,KAAK0W,UAAUD,IAMnBjG,EAAAtQ,UAAA4W,YAAA,SAAYD,GACR,IAAIJ,EAASzW,KAAK2W,aAAe,GAC7BJ,EAAME,EAAOvT,QAAQ2T,GACjB,GAALN,IACCE,EAAOD,OAAOD,EAAK,GACnBvW,KAAK0W,UAAUD,KAYvBjG,EAAAtQ,UAAAyM,KAAA,SAAMA,GAEF,OADA3M,KAAK4M,QAAQD,GACN3M,MAGXwQ,EAAAtQ,UAAA0M,QAAA,SAAQD,GACDE,MAAMF,IAAc,EAALA,EAAO,GACzB3M,KAAKyL,aAAa9E,EAAWsE,KAAW,EAAL0B,IAGvC6D,EAAAtQ,UAAA4M,QAAA,WACI,OAAO9M,KAAK2L,aAAahF,EAAWsE,OAGxCuF,EAAAtQ,UAAA6M,SAAA,WACI/M,KAAK4M,QAAQ5M,KAAK8M,UAAU,IAGhC0D,EAAAtQ,UAAA8M,aAAA,WACIhN,KAAK4M,QAAQ5M,KAAK8M,UAAU,IAUhC0D,EAAAtQ,UAAA+M,SAAA,SAAUC,GAEN,OADAlN,KAAKmN,YAAYD,GACVlN,MAGXwQ,EAAAtQ,UAAAiN,YAAA,SAAaD,GACNL,MAAMK,IAAc,EAALA,EAAO,GACzBlN,KAAKyL,aAAa9E,EAAWuE,UAAgB,EAALgC,IAG5CsD,EAAAtQ,UAAAkN,YAAA,WACI,OAAOpN,KAAK2L,aAAahF,EAAWuE,YAWxCsF,EAAAtQ,UAAAmN,KAAA,SAAMA,EAAcC,GAEhB,OADAtN,KAAKuN,QAAQF,EAAMC,GACZtN,MAOVwQ,EAAAtQ,UAAAqN,QAAA,SAAQF,EAAcC,GAClBA,EAAQA,GAAS,OACdD,GAAQA,EAAKnK,QAAQ,KAAK,IAC1BmK,EAAOA,EAAO,IAAMC,GACvBtN,KAAKyL,aAAa9E,EAAWqE,KAAMqC,IAGxCmD,EAAAtQ,UAAAsN,QAAA,WACI,OAAOxN,KAAK2L,aAAahF,EAAWqE,OAGxCwF,EAAAtQ,UAAAuN,aAAA,WACI,IAAIhN,EAAQT,KAAKwN,UACjB,OAAO/M,GAASA,EAAM+C,OAAS/C,EAAMiN,MAAM,KAAK,GAAK,MAGzD8C,EAAAtQ,UAAAyN,aAAA,WACI,IAAIlN,EAAQT,KAAKwN,UACjB,OAAO/M,GAASA,EAAM+C,OAAS/C,EAAMiN,MAAM,KAAK,GAAK,MAMzD8C,EAAAtQ,UAAA0N,eAAA,WACI,OAAOxC,EAAqByC,MAAM,IAUtC2C,EAAAtQ,UAAA4N,MAAA,WACI9N,KAAKuL,MAAQoF,KAAKC,MAAMD,KAAKE,UAAU7Q,KAAK+N,mBAp/BhD,SAAAyC,EAAYuG,GACR/W,KAAK+N,aAAe,GACpB/N,KAAK+N,aAAapH,EAAWsE,KAAK+L,YAAc,EAChDhX,KAAK+N,aAAapH,EAAWuE,UAAU8L,YAAc,GACrDhX,KAAK+N,aAAapH,EAAWqE,KAAKgM,YAAc,gBAChDhX,KAAK+N,aAAapH,EAAWoE,OAAOiM,YAAc/G,EAAepC,MAAM,GACvE7N,KAAK+N,aAAapH,EAAWmE,OAAOkM,YAAc5G,EAAevC,MAAM,GACpEkJ,GAAWA,EAAO,WACjBvX,OAAOyX,OAAOjX,KAAK+N,aAAcgJ,EAAO,iBACjCA,EAAO,UAElB/W,KAAKuL,MAAQoF,KAAKC,MAAMD,KAAKE,UAAU7Q,KAAK+N,eACzCgJ,GACC/W,KAAK6L,gBAAgBkL,OChK7BG,EAAkC,CAElCC,OAAQ,8BAGRC,UAAW,SAASL,GAChBvX,OAAOyX,OAAOjX,KAAM+W,KCF5BM,GAeIA,EAAAnX,UAAAoX,WAAA,SAAWC,GACPvX,KAAKuX,QAAUA,GAMnBF,EAAAnX,UAAAsX,aAAA,SAAa3C,GACNA,GAAuB,iBAAhB,EACN7U,KAAKyX,MAAQ,WAAa,OAAO5C,GAC7BA,GAAuB,mBAAhB,IACX7U,KAAKyX,MAAQ5C,IAIrBwC,EAAAnX,UAAAwX,kBAAA,SAEIX,GAEA,MAAM,IAAIxW,MAAM,sDAGpB8W,EAAAnX,UAAAyX,QAAA,SAEIC,GAEA,OAAOC,EAAAA,OAAS,IAAItX,MAAM,+CAhC9B,SAAA8W,EAAYN,gBANiB,IAOzBA,EAAUA,GAAW,GACrB/W,KAAKsX,WAAWP,EAAO,SAAU,KACjC/W,KAAKwX,aAAaT,EAAO,OCVjC,IAAA3W,EAAA0X,GAA4BxX,EAAAA,EAA5BF,EAA4BiX,GAWxBS,EAAA5X,UAAAwX,kBAAA,SAAkBX,GAEd,IAAIa,EAAgC,CAChCG,OAAQhB,EAAO,OACftT,IAAKsT,EAAO,IACZQ,QAASR,EAAO,SAAY/W,KAAKuX,SAgBrC,IAboB,IAAjBR,EAAO,OACNa,EAAI,aAAgB,QAErBb,EAAO,SACNa,EAAI,OAAUb,EAAO,QAGtBA,EAAO,OACNa,EAAI,KAAQb,EAAO,KACnBa,EAAI,YAAe,oBAIpB5X,KAAKyX,MAAO,CACX,IAAIA,EAAQzX,KAAKyX,QACdA,IACCG,EAAI,QAAWA,EAAI,SAAY,GAC/BA,EAAI,QAASI,cAAgB,UAAYP,EACzCG,EAAI,iBAAmB,GAK/B,GAAGb,EAAO,QACN,IAAI,IAAIkB,KAAKlB,EAAO,QACbA,EAAO,QAASlX,eAAeoY,KAC9BL,EAAKK,GAAKlB,EAAO,QAASkB,IAKtC,OAAOL,GAIXE,EAAA5X,UAAAyX,QAAA,SAAQC,GAEJ,QAAqB,IAAlB,EACC,MAAM,IAAIrX,MAAM,oIAKpB,IAAI2X,EAAUC,EAAMP,GACnBQ,KAAM,SAAAC,GAAc,OAAOA,EAASC,OACpCC,SAAO,SAAA7X,GACJ,IAAI8X,EAAgB,IAAInY,EAAQK,EAAMI,SAItC,OAHIJ,EAAM2X,WACNG,EAAM,IAAInY,EAAQK,EAAM2X,SAASC,OAE9BT,EAAAA,OAASW,KAEpB,OAAOC,EAAAA,QAAUP,OAjErB,SAAAJ,EAAYf,UACR3W,EAAAY,KAAAhB,KAAM+W,IAAQ/W,KCgBtB,IAAA0Y,GAcIA,EAAAxY,UAAAyY,OAAA,SAAOC,GACH5Y,KAAK6Y,QAAUD,EACf5Y,KAAK4Y,QAAUA,EAAU,cAM7BF,EAAAxY,UAAAoX,WAAA,SAAWwB,GACP9Y,KAAK+Y,SAAWD,GAMpBJ,EAAAxY,UAAAqX,QAAA,SAAQuB,GAEJ,OADA9Y,KAAKsX,WAAWwB,GACT9Y,MAMX0Y,EAAAxY,UAAA8Y,UAAA,SAAUC,GACNjZ,KAAKiZ,OAASA,GAMlBP,EAAAxY,UAAAgZ,SAAA,SAASC,GACFnZ,KAAKiZ,QAAUjZ,KAAKiZ,OAAOvY,OAC1BV,KAAKiZ,OAAOvY,MAAMyY,IAO1BT,EAAAxY,UAAAkZ,SAAA,SAASC,GACFrZ,KAAKiZ,QAAUjZ,KAAKiZ,OAAOK,OAC1BtZ,KAAKiZ,OAAOK,MAAMD,IAY1BX,EAAAxY,UAAAqZ,IAAA,SAAKC,EAAazC,GAAlB,IAAAhW,EAAAf,KAEQyD,EAAMzD,KAAK4Y,QAAU,IAAMY,EAK/B,OAJGzC,GAAWA,EAAQ0C,UAClBhW,GAAO,aAAesT,EAAQ0C,SAG3BhB,EAAAA,QAAWhV,GACjB2U,KAAM,SAAA3U,GACH,IAAImU,EAAO7W,EAAK2Y,aAAa,CAAE3B,OAAO,MAAOtU,IAAIA,EAAKsT,QAAQA,IAC9D,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,uBAAuBiZ,EAAE,KAAKL,EAAErY,SAGpD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,uBAAyBV,EAAI1X,SACpC+W,EAAAA,OAASW,MASxBE,EAAAxY,UAAAyZ,KAAA,SAAMC,EAAgB7C,GAAtB,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAWmB,GACjBxB,KAAM,SAAA5R,GAEH,IAAIuR,EAAS,OACTtU,EAAM1C,EAAK6X,QACf,GAAGpS,EAAKgT,GACJzB,EAAS,MACTtU,GAAO,IAAM+C,EAAKgT,QAKlB,IAAIhT,EAAKrD,IACL,OAAOpC,EAAKwQ,OAAO/K,EAAMuQ,GACxBqB,KAAM,SAAAjV,GACHqD,EAAKrD,IAAMA,EACX,IAAIyU,EAAO7W,EAAK2Y,aAAa,CAAC3B,OAAOA,EAAQtU,IAAIA,EAAK6U,KAAK9R,EAAMuQ,QAAQA,IACzE,OAAOhW,EAAK4W,QAAQC,KAKhC,IAAIA,EAAO7W,EAAK2Y,aAAa,CAAC3B,OAAOA,EAAQtU,IAAIA,EAAK6U,KAAK9R,EAAMuQ,QAAQA,IACzE,OAAOhW,EAAK4W,QAAQC,KAGvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,sBAAsB4Y,EAAErY,SAG5C,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,wBAA0BV,EAAI1X,SACrC+W,EAAAA,OAASW,MASxBE,EAAAxY,UAAA2Z,OAAA,SAAQL,EAAazC,GAArB,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAWzY,KAAK4Y,QAAU,IAAMY,GACtCpB,KAAM,SAAA3U,GACH,IAAImU,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,SAAUtU,IAAKA,EAAKsT,QAASA,IAExC,OAAOhW,EAAK4W,QAAQC,KAEvBQ,KAAM,WAAM,OAAA,IACZG,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,uBAAuBiZ,EAAE,KAAKL,EAAErY,SAGpD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,0BAA4BV,EAAI1X,SACvC+W,EAAAA,OAASW,MAUxBE,EAAAxY,UAAA4Z,MAAA,SAAON,EAAaM,EAAa/C,GAAjC,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAWzY,KAAK4Y,QAAU,IAAMY,GACtCpB,KAAM,SAAA3U,GACH,IAAImU,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAQ,QAAStU,IAAKA,EAAK6U,KAAMwB,EAAO/C,QAASA,IAErD,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,uBAAuBiZ,EAAE,KAAKL,EAAErY,SAGpD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,yBAA2BV,EAAI1X,SACtC+W,EAAAA,OAASW,MAWxBE,EAAAxY,UAAAuQ,MAAA,SAAO+I,EAAaO,EAAiBhD,GAArC,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAWzY,KAAK4Y,QAAU,IAAMY,EAAK,UAC3CpB,KAAM,SAAA3U,GACH,IAAImU,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAQ,OAAQtU,IAAKA,EAAK6U,KAAMyB,EAAWhD,QAASA,IAExD,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,sBAAsBiZ,EAAE,KAAKL,EAAErY,SAGnD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,yBAA2BV,EAAI1X,SACtC+W,EAAAA,OAASW,MASxBE,EAAAxY,UAAA8Z,OAAA,SAAQnF,EAAckC,GAAtB,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAW5D,GACjBuD,KAAM,SAAA6B,GACH,IAAIC,EAAKD,EAASA,EAAO3O,WAAa,GAClCsM,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MAAOtU,IAAK1C,EAAK6X,QAASqB,OAAQC,EAAInD,QAASA,IAE1D,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,0BAA0B4Y,EAAErY,SAGhD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,0BAA4BV,EAAI1X,SACvC+W,EAAAA,OAASW,MAWxBE,EAAAxY,UAAAia,UAAA,SAAQtF,EAAWuF,EAAiBrD,GAApC,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,SAAW,GACjBL,KAAM,WACH,GAAS,OAANvD,GAAcA,IAAQnJ,UACrB,MAAM,IAAInL,MAAM,oCAEpB,IAAI8Z,EAAyB,iBAAhB,EACTC,EAA4B,CAC5BvC,OAAO,OACPtU,IAAK1C,EAAK8X,QAAU,cACpB0B,aAAa,EACbC,UAAU,EACVzD,QAASA,GAEVsD,GACCC,EAAE,KAAQzF,EACVyF,EAAE,KAAQ,CAAEF,OAAQA,KAEpBE,EAAE,UAAY,EACdA,EAAE,KAAQ,CAAE7W,IAAKoR,EAAKuF,OAAQA,IAE/BrD,GAAWA,EAAQ0D,YAClBH,EAAE,KAAMG,YAAe1D,EAAQ0D,UAAW,UACnC1D,EAAQ0D,WAEnB,IAAI7C,EAAO7W,EAAK2Y,aAAaY,GAC7B,OAAOvZ,EAAK4W,QAAQC,KAEvBW,SAAO,SAAAY,GACJ,IAAIX,EAAM,IAAIjY,MAAM,yBAAyB4Y,EAAErY,SAO/C,OANAtB,OAAOyX,OAAOuB,EAAKW,GACH,MAAbA,EAAEvY,UAAmBuY,EAAErY,QAAQoC,QAAQ,wBACtC1D,OAAOyX,OAAOuB,EAAK,CAAC5X,OAAQ,MAC7BuY,EAAE3S,MACDhH,OAAOyX,OAAOuB,EAAK,CAAEhS,KAAO2S,EAAE3S,OAClCzF,EAAKmY,SAAS,0BAA4BV,EAAI1X,SACvC+W,EAAAA,OAASW,MAWxBE,EAAAxY,UAAAwa,UAAA,SAAQlB,EAAaY,EAAiBrD,GAAtC,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,SAAW,GACjBL,KAAM,WACH,IAAI3U,EAAM1C,EAAK6X,QAAU,IAAMY,EAAK,UAChC5B,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAQ,MAAOtU,IAAKA,EACpBwW,OAAQ,CAACG,OAAOA,GAChB1J,MAAM,EACNqG,QAASA,IAEb,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAO,SAAAY,GACJ,IAAIE,EAAMF,EAAErY,SAETqY,EAAEtY,YAA6B,MAAfsY,EAAEtY,YAAmC,QAAfsY,EAAEtY,cACvCwY,EAAM,wCAAwCe,EAAM,KAExD,IAAI5B,EAAM,IAAIjY,MAAM,yBAAyB8Y,GAG7C,OAFA7Z,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,0BAA4BV,EAAI1X,SACvC+W,EAAAA,OAASW,MAUxBE,EAAAxY,UAAAqR,OAAA,SAAQtN,EAAc8S,GAAtB,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAWxU,GACjBmU,KAAM,SAAAtM,GACH,IAAIA,IAAQA,EAAI/I,KACZ,MAAM,IAAIxC,MAAM,+CACpB,IAAIkD,EAAM1C,EAAK8X,QAAU,kBACzB9B,EAAUA,GAAW,IACb4D,aAAe,OACvB,IAAI/C,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAQ,OAAQtU,IAAKA,EAAK6U,KAAMxM,EAAKiL,QAASA,IAElD,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAO,SAAAY,GACJ,IAAIX,EAAM,IAAIjY,MAAM,+BAA+B4Y,EAAErY,SAGrD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,0BAA4BV,EAAI1X,SACvC+W,EAAAA,OAASW,MAWxBE,EAAAxY,UAAA0a,YAAA,SAAalI,EAAgBqE,GAA7B,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAW/F,GACjB0F,KAAM,SAAA7S,GAEH,IACI9B,EAAM1C,EAAK8X,QAAU,aAErBjB,EAAO7W,EAAK2Y,aAAa,CAAC3B,OAHjB,OAGgCtU,IAAIA,EAAK6U,KAAK/S,EAAawR,QAAQA,IAChF,OAAOhW,EAAK4W,QAAQC,KAGvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,yBAAyB4Y,EAAErY,SAG/C,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,+BAAiCV,EAAI1X,SAC5C+W,EAAAA,OAASW,MAUxBE,EAAAxY,UAAA2a,OAAA,SAAOC,EAAiB/D,GAAxB,IAAAhW,EAAAf,KACI,OAAOyY,EAAAA,QAAUqC,GAChB1C,KAAM,SAAA0C,GACH,IAAqBrX,EAAM1C,EAAK8X,QAAU,oBACtCjB,EAAO7W,EAAK2Y,aAAa,CAAC3B,OADjB,OACgCtU,IAAIA,EAAK6U,KAAKwC,EAAM/D,QAAQA,IACzE,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,0BAA0B4Y,EAAErY,SAGhD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,0BAA4BV,EAAI1X,SACvC+W,EAAAA,OAASW,MAKxBE,EAAAxY,UAAA6a,KAAA,SAAKvU,EAAYuQ,GAAjB,IAAAhW,EAAAf,KACI,OAAOyY,EAAAA,QAAUjS,EAAKgT,IACrBpB,KAAM,SAAAoB,GACH,IAAoB/V,EAAM1C,EAAK8X,QAAU,cAAgBW,EAAK,SAC1D5B,EAAO7W,EAAK2Y,aAAa,CAAC3B,OADjB,MACgCtU,IAAIA,EAAKsT,QAAQA,IAC9D,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,qBAAqBiG,EAAKgT,GAAE,KAAKL,EAAErY,SAGvD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,wBAA0BV,EAAI1X,SACrC+W,EAAAA,OAASW,MAIxBE,EAAAxY,UAAA8a,KAAA,SAAKxU,EAAYuQ,GAAjB,IAAAhW,EAAAf,KACI,OAAOyY,EAAAA,QAAUjS,EAAKgT,IACrBpB,KAAM,SAAAoB,GACH,IAAoB/V,EAAM1C,EAAK8X,QAAU,cAAgBW,EAAK,SAC1D5B,EAAO7W,EAAK2Y,aAAa,CAAC3B,OADjB,MACgCtU,IAAIA,EAAKsT,QAAQA,IAC9D,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,qCAAqCiG,EAAKgT,GAAE,KAAKL,EAAErY,SAGvE,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,wBAA0BV,EAAI1X,SACrC+W,EAAAA,OAASW,MAUxBE,EAAAxY,UAAA+a,aAAA,SAAczB,EAAaS,EAAclD,GAAzC,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAWe,GACjBpB,KAAM,SAAAoB,GACH,IAAI/V,EAAM1C,EAAK6X,QAAU,IAAMY,EAAK,gBAChC5B,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MACPtU,IAAIA,EACJwW,OAAQA,GAAU,GAClBlD,QAASA,IAEb,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,wCAAwCiZ,EAAE,KAAKL,EAAErY,SAGrE,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,gCAAkCV,EAAI1X,SAC7C+W,EAAAA,OAASW,MAUxBE,EAAAxY,UAAAgb,SAAA,SAAU1B,EAAaS,EAAelD,GAAtC,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAWe,GACjBpB,KAAM,SAAAoB,GACH,IAAI/V,EAAM1C,EAAK6X,QAAU,IAAMY,EAAK,YAChC5B,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MAAOtU,IAAIA,EAAKwW,OAAQA,EAAQlD,QAAQA,IAEnD,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,oCAAoCiZ,EAAE,KAAKL,EAAErY,SAGjE,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,4BAA8BV,EAAI1X,SACzC+W,EAAAA,OAASW,MAgBxBE,EAAAxY,UAAAwZ,aAAA,SAAc3C,GAEV,GAAG/W,KAAKmb,YAAYjY,QAAQ6T,EAAO,QAAS,EACxC,MAAM,IAAIxW,MAAM,2BAA2BwW,EAAO,QAEtD,IAAIA,EAAO,IACP,MAAM,IAAIxW,MAAM,wCAIpB,OAFAwW,EAAO,QAAW/W,KAAK+Y,UAAY,IACxB/Y,KAAK0X,kBAAkBX,IAItC2B,EAAAxY,UAAAwX,kBAAA,SAAkBX,GACd,IAAIqE,EAAUpb,KAAKqb,OAAO3D,kBAAkBX,GAE5C,OADA/W,KAAKoZ,SAAS,qCAAuCzI,KAAKE,UAAUuK,IAC7DA,GAGX1C,EAAAxY,UAAAyX,QAAA,SAAQC,GACJ,OAAO5X,KAAKqb,OAAO1D,QAAQC,GAC1BW,SAAM,SAAAY,GAKH,OAJGA,MAAAA,IACCA,EAAI,IAAI5Y,MAAM,yHAGXsX,EAAAA,OAASsB,SAzexB,SAAAT,EAAYjV,EAAc6X,iBAJI,qBAEK,CAAC,MAAO,OAAQ,MAAO,SAAU,SAGhEtb,KAAK2Y,OAAOlV,GACZzD,KAAKqb,OAASC,EC7BtB,IAAAlb,EAAAmb,GAA6Bjb,EAAAA,EAA7BF,EAA6BsY,GAMzB6C,EAAArb,UAAAyY,OAAA,SAAOC,GACHxY,EAAAF,UAAMyY,OAAM3X,KAAAhB,KAAC4Y,GACb5Y,KAAK4Y,QAAUA,EAAU,oBAN7B,SAAA2C,EAAY9X,EAAc6X,UACtBlb,EAAAY,KAAAhB,KAAMyD,EAAK6X,IAAWtb,KCF9B,IAAAI,EAAAob,GAAyBlb,EAAAA,EAAzBF,EAAyBsY,GAMrB8C,EAAAtb,UAAAyY,OAAA,SAAOC,GACHxY,EAAAF,UAAMyY,OAAM3X,KAAAhB,KAAC4Y,GACb5Y,KAAK4Y,QAAUA,EAAU,gBAN7B,SAAA4C,EAAY/X,EAAY6X,UACpBlb,EAAAY,KAAAhB,KAAMyD,EAAK6X,IAAWtb,KCF9B,IAAAI,EAAAqb,GAA2Bnb,EAAAA,EAA3BF,EAA2BsY,GAMvB+C,EAAAvb,UAAAyY,OAAA,SAAOC,GACHxY,EAAAF,UAAMyY,OAAM3X,KAAAhB,KAAC4Y,GACb5Y,KAAK4Y,QAAUA,EAAU,eAQ7B6C,EAAAvb,UAAAwb,MAAA,SAAOlC,EAAazC,GAApB,IAAAhW,EAAAf,KACI,OAAOyY,EAAAA,QAAWe,GACjBpB,KAAM,SAACoB,GAEJ,IAAI/V,EAAM1C,EAAK6X,QAAU,IAAMY,EAAK,SAChC5B,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MAAOtU,IAAIA,EAAKsT,QAAQA,IAEnC,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,yBAAyB4Y,EAAErY,SAG/C,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,0BAA4BV,EAAI1X,SACvC+W,EAAAA,OAASW,MAUxBiD,EAAAvb,UAAAyb,SAAA,SAAUnC,EAAaoC,EAAW7E,GAAlC,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAWmD,GACjBxD,KAAM,SAACwD,GAEJ,IAAIA,EACA,MAAM,IAAIrb,MAAM,2CAGpB,IACIsb,EADO,CAAC,OAAQ,SAAU,QAAS,IAAK,KACzBC,KAAK,SAAAlQ,GAAO,OAACgQ,EAAIhQ,KACpC,GAAGiQ,EACC,MAAM,IAAItb,MAAM,gBAAgBsb,EAAO,oBAG3C,IAAI5B,EAAS,CACT8B,IAAc,YACdtI,KAAcmI,EAAInI,KAClBuI,OAAcJ,EAAII,OAClBC,MAAcL,EAAIK,MAClBC,YAAc,WACdC,EAAcP,EAAIO,EAClBC,EAAcR,EAAIQ,EAClBC,EAAcT,EAAIO,EAClBG,EAAcV,EAAIQ,GAGlB3Y,EAAM1C,EAAK6X,QAAU,IAAMY,EAAK,YAChC5B,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MAAOtU,IAAIA,EAAKwW,OAAOA,EAAQlD,QAAQA,IAElD,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,mCAAmC4Y,EAAErY,SAGzD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,6BAA+BV,EAAI1X,SAC1C+W,EAAAA,OAASW,MAUxBiD,EAAAvb,UAAAqc,SAAA,SAAS/C,EAAaS,EAAclD,GAApC,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAWwB,GACjB7B,KAAM,SAAA6B,GAEH,IAAIA,EACA,MAAM,IAAI1Z,MAAM,sDAGpB,IAAIkD,EAAM1C,EAAK6X,QAAU,IAAMY,EAAK,YAChC5B,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MAAOtU,IAAIA,EAAKwW,OAAOA,EAAQlD,QAAQA,IAElD,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,mCAAmC4Y,EAAErY,SAGzD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,6BAA+BV,EAAI1X,SAC1C+W,EAAAA,OAASW,SAxGxB,SAAAiD,EAAYhY,EAAc6X,UACtBlb,EAAAY,KAAAhB,KAAMyD,EAAK6X,IAAWtb,KCD9B,IAAAI,EAAAoc,GAA6Blc,EAAAA,EAA7BF,EAA6BsY,GAMzB8D,EAAAtc,UAAAyY,OAAA,SAAOC,GACHxY,EAAAF,UAAMyY,OAAM3X,KAAAhB,KAAC4Y,GACb5Y,KAAK4Y,QAAUA,EAAU,iBAY7B4D,EAAAtc,UAAAuc,MAAA,SAAO5Z,EAAekU,GAAtB,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAW5V,GACjBuV,KAAM,SAAAsE,GACH,IAAIA,EACA,MAAM,IAAInc,MAAM,8CACpB,IAAIqX,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,OAAQtU,IAAI1C,EAAK6X,QAAU,SAAUN,KAAKoE,EAAK3F,QAAQA,IAElE,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,6BAA6B4Y,EAAErY,SAGnD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,4BAA8BV,EAAI1X,SACzC+W,EAAAA,OAASW,MAUxBgE,EAAAtc,UAAAmM,MAAA,SAAO0K,GAAP,IAAAhW,EAAAf,KAEQuL,GAAQ,IAAIiF,GACfnE,MAAMpL,EAAUgB,UAChB4T,cAAc,eACd5I,SAAS,IACT3B,WAED,OAAOmN,EAAAA,QAAWlN,GACjB6M,KAAM,SAAC6B,GACJ,IAAIxW,EAAM1C,EAAK8X,QAAU,aACrBjB,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MAAOtU,IAAIA,EAAKwW,OAAOA,EAAQlD,QAAQA,IAElD,OAAOhW,EAAK4W,QAAQC,KAEvBQ,KAAK,SAAAC,GAAY,OAAAA,EAASsE,UAC1BpE,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,iCAAiC4Y,EAAErY,SAGvD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,4BAA8BV,EAAI1X,SACzC+W,EAAAA,OAASW,MAUxBgE,EAAAtc,UAAAia,UAAA,SAAQtX,EAAekU,GAAvB,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAW5V,GACjBuV,KAAM,SAAAsE,GACH,IAAIjZ,EAAM1C,EAAK6X,QAAU,UACrBhB,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,OAAQtU,IAAIA,EAAK6U,KAAKoE,EAAK3F,QAAQA,IAE9C,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,4BAA4B4Y,EAAErY,SAGlD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,6BAA+BV,EAAI1X,SAC1C+W,EAAAA,OAASW,MAUxBgE,EAAAtc,UAAA0c,QAAA,SAASpD,EAAazC,GAAtB,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAWe,GACjBpB,KAAM,SAAAoB,GACH,IAAI/V,EAAM1C,EAAK6X,QAAU,IAAMY,EAAK,WAChC5B,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MAAOtU,IAAIA,EAAKsT,QAAQA,IAEnC,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,yCAAyC4Y,EAAErY,SAG/D,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,8BAAgCV,EAAI1X,SAC3C+W,EAAAA,OAASW,MAUxBgE,EAAAtc,UAAA2c,SAAA,SAAUrD,EAAazC,GAAvB,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAWe,GACjBpB,KAAM,SAAAoB,GACH,IAAI/V,EAAM1C,EAAK6X,QAAU,IAAMY,EAAK,QAChC5B,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MAAOtU,IAAIA,EAAKsT,QAAQA,IAEnC,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,0BAA0B4Y,EAAErY,SAGhD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,+BAAkCV,EAAI1X,SAC7C+W,EAAAA,OAASW,MASxBgE,EAAAtc,UAAA4c,WAAA,SAAYtD,EAAazC,GAAzB,IAAAhW,EAAAf,KACI,OAAOyY,EAAAA,QAAWe,GACjBpB,KAAM,SAAAoB,GACH,IAAI/V,EAAM1C,EAAK6X,QAAU,IAAMY,EAAK,cAChC5B,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MAAOtU,IAAIA,EAAKsT,QAAQA,IAEnC,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,qCAAqC4Y,EAAErY,SAG3D,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,iCAAmCV,EAAI1X,SAC9C+W,EAAAA,OAASW,SA9JxB,SAAAgE,EAAY/Y,EAAY6X,UACpBlb,EAAAY,KAAAhB,KAAMyD,EAAK6X,IAAWtb,KCN9B,IAAAI,EAAA2c,GAA6Bzc,EAAAA,EAA7BF,EAA6BsY,GAMzBqE,EAAA7c,UAAAyY,OAAA,SAAOC,GACHxY,EAAAF,UAAMyY,OAAM3X,KAAAhB,KAAC4Y,GACb5Y,KAAK4Y,QAAUA,EAAU,kBAG7BmE,EAAA7c,UAAA8c,QAAA,SAASC,EAAoBrD,EAAe7C,GAA5C,IAAAhW,EAAAf,KACI,OAAOyY,EAAAA,SAAW,GACjBL,KAAM,WACH,IAAI3U,EAAM1C,EAAK6X,QAAU,IAAMqE,EAAY,SACvCrF,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,OAAQtU,IAAIA,EAAK6U,KAAMsB,EAAS7C,QAAQA,IAEnD,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,sBAAwB4Y,EAAErY,SAG9C,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,8BAAgCV,EAAI1X,SAC3C+W,EAAAA,OAASW,MAIxBuE,EAAA7c,UAAAgd,WAAA,SAAYD,EAAoBE,EAAcpG,GAA9C,IAAAhW,EAAAf,KACI,OAAOyY,EAAAA,QAAWzY,KAAK4Y,QAAU,IAAMqE,EAAY,UAAYE,GAC9D/E,KAAM,SAAA3U,GACH,IAAImU,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,SAAUtU,IAAIA,EAAKsT,QAAQA,IAEtC,OAAOhW,EAAK4W,QAAQC,KAEvBQ,KAAM,WAAK,OAAA,IACXG,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,sBAAwB4Y,EAAErY,SAG9C,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,8BAA+BV,EAAI1X,SAC1C+W,EAAAA,OAASW,SAvCxB,SAAAuE,EAAYtZ,EAAc6X,UACtBlb,EAAAY,KAAAhB,KAAMyD,EAAK6X,IAAWtb,KCX9B,IAAAod,GAeIA,GAAAld,UAAAyY,OAAA,SAAOC,GACH5Y,KAAK4Y,QAAUA,GAMnBwE,GAAAld,UAAA8Y,UAAA,SAAUC,GACNjZ,KAAKiZ,OAASA,GAMlBmE,GAAAld,UAAAgZ,SAAA,SAASC,GACFnZ,KAAKiZ,QAAUjZ,KAAKiZ,OAAOvY,OAC1BV,KAAKiZ,OAAOvY,MAAMyY,IAO1BiE,GAAAld,UAAAkZ,SAAA,SAASC,GACFrZ,KAAKiZ,QAAUjZ,KAAKiZ,OAAOK,OAC1BtZ,KAAKiZ,OAAOK,MAAMD,IAW1B+D,GAAAld,UAAAmd,aAAA,SAAcC,EAAwB/R,EAAawL,GAAnD,IAAAhW,EAAAf,KAEQyD,EAAMzD,KAAK4Y,QAAU,oBAIzB,OAHG0E,IACC7Z,GAAO,IAAM6Z,GAEV7E,EAAAA,QAAWhV,GACjB2U,KAAM,SAAC3U,GACJ,IAAImU,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MAAOtU,IAAIA,EAAKwW,OAAO1O,GAAO,GAAIwL,QAAQA,IAErD,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,+BAA+B4Y,EAAErY,SAGrD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,iCAAmCV,EAAI1X,SAC9C+W,EAAAA,OAASW,MAUxB4E,GAAAld,UAAAqd,UAAA,SAAWC,EAAYpD,EAAiBrD,GAAxC,IAAAhW,EAAAf,KAEQyD,EAAMzD,KAAK4Y,QAAU,mBAEzB,OAAOH,EAAAA,QAAWhV,GACjB2U,KAAM,SAAA3U,GAEH,IAAImU,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,OAAStU,IAAIA,EACpB6U,KAAM,CAAE8B,OAAQA,GAChBoD,KAAMA,EACNhD,UAAU,EACVzD,QAASA,IAEb,OAAOhW,EAAK4W,QAAQC,KAEvBQ,KAAM,SAAAC,GAAY,OAAAA,IAClBE,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,uBAAuB4Y,EAAErY,SAG7C,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,8BAAgCV,EAAI1X,SAC3C+W,EAAAA,OAASW,MAWxB4E,GAAAld,UAAAud,OAAA,SAAOhd,EAAasW,GAApB,IAAAhW,EAAAf,KAEQyD,EAAMzD,KAAK4Y,QAAU,uBACzB,OAAOH,EAAAA,QAAUhV,GAChB2U,KAAM,SAAA3U,GACH,IAAImU,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAQ,MACRtU,IAAKA,EACLwW,OAAQ,CAAEyD,SAAUjd,GACpBsW,QAASA,IAEb,OAAOhW,EAAK4W,QAAQC,KAEvBQ,KAAK,SAAAC,GAAY,OAAAA,IACjBE,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,6BAA6B4Y,EAAErY,SAGnD,OAFAtB,OAAOyX,OAAOuB,EAAKW,GACnBpY,EAAKmY,SAAS,2BAA6BV,EAAI1X,SACxC+W,EAAAA,OAASW,MAmBxB4E,GAAAld,UAAAwZ,aAAA,SAAc3C,GAEV,GAAG/W,KAAKmb,YAAYjY,QAAQ6T,EAAO,QAAS,EACxC,MAAM,IAAIxW,MAAM,2BAA2BwW,EAAO,QAEtD,IAAIA,EAAO,IACP,MAAM,IAAIxW,MAAM,wCAIpB,OAFAwW,EAAO,QAAW/W,KAAKuX,SAAWL,EAAM,SAAY,IAE7ClX,KAAK0X,kBAAkBX,IAGlCqG,GAAAld,UAAAwX,kBAAA,SAAkBX,GACd,OAAO/W,KAAKqb,OAAO3D,kBAAkBX,IAGzCqG,GAAAld,UAAAyX,QAAA,SAAQC,GACJ,OAAO5X,KAAKqb,OAAO1D,QAAQC,GAC1BW,SAAM,SAAEY,GAKL,OAJGA,MAAAA,IACCA,EAAI,IAAI5Y,MAAM,0HAGXsX,EAAAA,OAASsB,UAlKxB,SAAAiE,GAAY3Z,EAAc6X,gBALC,qBAEM,CAAC,MAAO,OAAQ,MAAO,SAAU,SAI9Dtb,KAAKqb,OAASC,EACdtb,KAAK4Y,QAAUnV,EACfzD,KAAKuX,QAAUL,EAAM,SAAY,ICfzC,IAMAyG,IAWIA,GAAAzd,UAAAoL,SAAA,WACI,IAAI5I,EAAgC,GACpC,IAAI,IAAIC,KAAQ3C,KAAK4d,OAAQ,CACzB,IAAInd,EAAQT,KAAK4d,OAAOjb,GACX,OAAVlC,GAAyC,oBAAhBA,EAAU,OAClCA,EAAQA,EAAMkE,KAAK,MAEvBjC,EAAOC,GAAQlC,EAEnB,OAAOiC,GAKXib,GAAAzd,UAAA6L,EAAA,SAAEtL,GAAgD,OAAlBT,KAAKiM,KAAKxL,GAAeT,MACzD2d,GAAAzd,UAAA+L,KAAA,SAAKxL,GAAkBT,KAAK4d,OAAM,EAAKnd,GACvCkd,GAAAzd,UAAAiM,KAAA,WAAkB,OAAOnM,KAAK4d,OAAM,GAIpCD,GAAAzd,UAAAmM,MAAA,SAAM5L,GACoB,OAAtBT,KAAKyM,SAAShM,GAAeT,MAEjC2d,GAAAzd,UAAAuM,SAAA,SAAShM,GACL,IAAIod,EAEAA,EADDpd,GAASd,MAAMsU,QAAQxT,GAChB,EAAyBkE,KAAK,KAChC,EACR3E,KAAK4d,OAAM,MAASC,GAExBF,GAAAzd,UAAAwM,SAAA,WAAwB,OAAO1M,KAAK4d,OAAM,OAI1CD,GAAAzd,UAAA4d,OAAA,SAAOrd,GACoB,OAAvBT,KAAK+d,UAAUtd,GAAeT,MAElC2d,GAAAzd,UAAA6d,UAAA,SAAUtd,GACN,IAAIod,EAEAA,EADDpd,GAASd,MAAMsU,QAAQxT,GAChB,EAAyBkE,KAAK,KAChC,EACR3E,KAAK4d,OAAM,OAAUC,GAEzBF,GAAAzd,UAAA8d,UAAA,WAAyB,OAAOhe,KAAK4d,OAAM,QAI3CD,GAAAzd,UAAA+d,KAAA,SAAKxd,GACoB,OAArBT,KAAKke,QAAQzd,GAAeT,MAEhC2d,GAAAzd,UAAAge,QAAA,SAAQzd,GACJ,IAAIod,EAEAA,EADDpd,GAASd,MAAMsU,QAAQxT,GAChB,EAAyBkE,KAAK,KAChC,EACR3E,KAAK4d,OAAM,KAAQC,GAEvBF,GAAAzd,UAAAie,QAAA,WAAuB,OAAOne,KAAK4d,OAAM,MAIzCD,GAAAzd,UAAAsT,OAAA,SAAO/S,GAAkD,OAAvBT,KAAK0T,UAAUjT,GAAeT,MAChE2d,GAAAzd,UAAAwT,UAAA,SAAUjT,GAAeT,KAAK4d,OAAM,KAAQnd,GAC5Ckd,GAAAzd,UAAA2T,UAAA,WAAoB,OAAO7T,KAAK4d,OAAM,MAQtCD,GAAAzd,UAAAmN,KAAA,SAAMA,EAAeC,GACU,OAA3BtN,KAAKuN,QAAQF,EAAMC,GAAetN,MAMrC2d,GAAAzd,UAAAqN,QAAA,SAAQF,EAAeC,GACnBA,EAAQA,GAAS,OACdD,GAAQA,EAAKnK,QAAQ,KAAK,IAC1BmK,EAAOA,EAAO,IAAMC,GACvBtN,KAAK4d,OAAM,KAAQvQ,GAExBsQ,GAAAzd,UAAAsN,QAAA,WAAqB,OAAOxN,KAAK4d,OAAM,MACvCD,GAAAzd,UAAAuN,aAAA,WAA0B,OAAOzN,KAAK4d,OAAM,KAAMlQ,MAAM,KAAK,IAC7DiQ,GAAAzd,UAAAyN,aAAA,WAA2B,MAA0C,QAAnC3N,KAAK4d,OAAM,KAAMlQ,MAAM,KAAK,IAS9DiQ,GAAAzd,UAAAyM,KAAA,SAAMA,GAEF,OADA3M,KAAK4M,QAAQD,GACN3M,MAGX2d,GAAAzd,UAAA0M,QAAA,SAAQD,GACDE,MAAMF,IAAc,EAALA,EAAO,IACzB3M,KAAK4d,OAAM,KAAa,EAALjR,IAGvBgR,GAAAzd,UAAA4M,QAAA,WACI,OAAO9M,KAAK4d,OAAM,MAGtBD,GAAAzd,UAAA6M,SAAA,WACI/M,KAAK4M,QAAQ5M,KAAK4d,OAAM,KAAM,IAGlCD,GAAAzd,UAAA8M,aAAA,WACIhN,KAAK4M,QAAQ5M,KAAK4d,OAAM,KAAM,IAUlCD,GAAAzd,UAAA+M,SAAA,SAAUC,GAEN,OADAlN,KAAKmN,YAAYD,GACVlN,MAGX2d,GAAAzd,UAAAiN,YAAA,SAAaD,GACNL,MAAMK,IAAc,EAALA,EAAO,IACzBlN,KAAK4d,OAAM,KAAa,EAAL1Q,IAGvByQ,GAAAzd,UAAAkN,YAAA,WACI,OAAOpN,KAAK4d,OAAM,UA/ItB,SAAAD,KACI3d,KAAK4d,OAAS,CACVjR,KAAM,EACNO,KAAM,QAoJlBkR,IAeIA,GAAAle,UAAAyY,OAAA,SAAOC,GACH5Y,KAAK4Y,QAAUA,EAAU,aAY7BwF,GAAAle,UAAAme,OAAA,SAAQ7E,EAAazC,GAArB,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAWe,GACjBpB,KAAM,SAAAoB,GACH,IAAI5B,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MAAOtU,IAAI1C,EAAK6X,QAAU,SAAWY,EAAIzC,QAAQA,IAE5D,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,6CAA6CiZ,EAAE,KAAKL,EAAErY,SAE1E,OADAtB,OAAOyX,OAAOuB,EAAKW,GACZtB,EAAAA,OAASW,MASxB4F,GAAAle,UAAAoe,WAAA,SAAYzJ,EAAiBkC,GAA7B,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAW5D,GACjBuD,KAAM,SAAA6B,GAEH,IAAIC,EAAKD,EAAO3O,WACZsM,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MACPtU,IAAK1C,EAAK6X,QAAU,QACpBqB,OAAQC,EACRnD,QAASA,IAEb,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,oDAAoD4Y,EAAErY,SAE1E,OADAtB,OAAOyX,OAAOuB,EAAKW,GACZtB,EAAAA,OAASW,MAgBxB4F,GAAAle,UAAAqe,SAAA,SAAU/E,EAAazC,GAAvB,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAWe,GACjBpB,KAAM,SAAAoB,GACH,IAAI5B,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MAAOtU,IAAI1C,EAAK6X,QAAU,WAAaY,EAAIzC,QAAQA,IAE9D,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,iDAAiDiZ,EAAE,KAAKL,EAAErY,SAE9E,OADAtB,OAAOyX,OAAOuB,EAAKW,GACZtB,EAAAA,OAASW,MAUxB4F,GAAAle,UAAAse,aAAA,SAAc3J,EAAiBkC,GAA/B,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAW5D,GACjBuD,KAAM,SAAA6B,GAEH,IAAIC,EAAKD,EAAO3O,WACZsM,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MACPtU,IAAK1C,EAAK6X,QAAU,UACpBqB,OAAQC,EACRnD,QAASA,IAEb,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,wDAAwD4Y,EAAErY,SAE9E,OADAtB,OAAOyX,OAAOuB,EAAKW,GACZtB,EAAAA,OAASW,MAexB4F,GAAAle,UAAAue,QAAA,SAASjF,EAAazC,GAAtB,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAWe,GACjBpB,KAAM,SAACoB,GACJ,IAAI5B,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MACPtU,IAAI1C,EAAK6X,QAAU,UAAYY,EAC/BzC,QAAQA,IAEZ,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,+CAA+CiZ,EAAE,KAAKL,EAAErY,SAE5E,OADAtB,OAAOyX,OAAOuB,EAAKW,GACZtB,EAAAA,OAASW,MAUxB4F,GAAAle,UAAAwe,YAAA,SAAa7J,EAAiBkC,GAA9B,IAAAhW,EAAAf,KAEI,OAAOyY,EAAAA,QAAW5D,GACjBuD,KAAM,SAAA6B,GAEH,IAAIC,EAAKD,EAAO3O,WACZsM,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MACPtU,IAAK1C,EAAK6X,QAAU,SACpBqB,OAAQC,EACRnD,QAASA,IAEb,OAAOhW,EAAK4W,QAAQC,KAEvBW,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,sDAAsD4Y,EAAErY,SAE5E,OADAtB,OAAOyX,OAAOuB,EAAKW,GACZtB,EAAAA,OAASW,MAQxB4F,GAAAle,UAAAye,UAAA,SAAW7S,GACP,IAAIA,EAAK,OAAO,KAEhB,IAAIA,EAAI/I,KAAM,OAAO,KAErB,GAAG9B,EAAUW,eAAiBkK,EAAI/I,MAAQ,UAAY+I,EAAI/I,KACtD,OAAO+I,EAAI0N,GAGf,IAAI1N,EAAIvG,cAAgBuG,EAAIvG,YAAY/B,OAAQ,OAAO,KACvD,IAAIkP,EAAM5G,EAAIvG,YAAYqZ,OAAQ,SAACpF,GAAc,OAACA,EAAGtW,QAAQ,WAC7D,OAAIwP,EAAIlP,OACDkP,EAAI,GAAGjQ,QAAQ,QAAQ,IADP,MAkB3B2b,GAAAle,UAAAwZ,aAAA,SAAc3C,GAEV,GAAG/W,KAAKmb,YAAYjY,QAAQ6T,EAAO,QAAS,EACxC,MAAM,IAAIxW,MAAM,2BAA2BwW,EAAO,QAEtD,IAAIA,EAAO,IACP,MAAM,IAAIxW,MAAM,wCAIpB,OAFAwW,EAAO,QAAW/W,KAAKuX,SAAWL,EAAM,SAAY,IAE7ClX,KAAK0X,kBAAkBX,IAGlCqH,GAAAle,UAAAwX,kBAAA,SAAkBX,GACd,OAAO/W,KAAKqb,OAAO3D,kBAAkBX,IAGzCqH,GAAAle,UAAAyX,QAAA,SAAQC,GACJ,OAAO5X,KAAKqb,OAAO1D,QAAQC,GAC1BW,SAAM,SAAAY,GAKH,OAJGA,MAAAA,IACCA,EAAI,IAAI5Y,MAAM,yHAGXsX,EAAAA,OAASsB,UArOxB,SAAAiF,GAAY3a,EAAc6X,gBAHC,qBACM,CAAC,MAAO,OAAQ,MAAO,SAAU,SAG9Dtb,KAAK2Y,OAAOlV,GACZzD,KAAKqb,OAASC,EACdtb,KAAKuX,QAAU,IC1KvB,IAAMsH,GAAqC,CACvCC,QAAiB,mBACjB5d,QAAiB,UACjBC,QAAiB,UACjBC,MAAiB,QACjBC,IAAiB,MACjBC,QAAiB,UACjBC,UAAiB,YACjBM,QAAiB,UACjBD,aAAiB,eACjBG,QAAiB,UACjBC,eAAiB,iBACjBR,YAAiB,cACjBC,MAAiB,QACjBC,QAAiB,UACjBC,cAAiB,gBACjBO,iBAAiB,kBACjB6c,gBAAiB,kBACjBC,KAAiB,OACjBC,eAAiB,iBACjBC,eAAiB,iBACjBC,SAAiB,oBAGfC,GAAiC,CACnCC,SAAY,WACZC,UAAY,YACZC,OAAY,SACZxY,QAAY,UACZyY,OAAY,SACZC,QAAY,UACZC,OAAY,SACZC,MAAY,QACZC,QAAY,UACZC,SAAY,WACZC,SAAY,YA0BhB,IAAAC,IAiBIA,GAAA7f,UAAA8f,YAAA,WAAyB,OAAOhgB,KAAKigB,UACrCF,GAAA7f,UAAAggB,QAAA,WAAqB,OAAOlgB,KAAK+C,MACjCgd,GAAA7f,UAAAue,QAAA,WAAkB,OAAOze,KAAKwG,MAC9BuZ,GAAA7f,UAAAigB,QAAA,SAAQ3Z,GAAcxG,KAAKwG,KAAOA,EAAQA,EAAKgT,IAAMhT,EAAQ,MAC7DuZ,GAAA7f,UAAAkgB,WAAA,WAAqB,OAAOpgB,KAAKqgB,SACjCN,GAAA7f,UAAAogB,WAAA,SAAWD,GACPrgB,KAAKqgB,QAAUA,EAAWA,EAAQ7G,IAAM6G,EAAW,UAhBvD,SAAAN,GAAYE,EAAmBld,EAAeyD,EAAa6Z,GACvD,aAJiB,kBACG,MAGhBJ,IAAcld,EACd,MAAM,IAAIxC,MAAM,mGAGpBP,KAAKigB,SAAWA,EAChBjgB,KAAK+C,KAAOA,EACZ/C,KAAKmgB,QAAQ3Z,GACbxG,KAAKsgB,WAAWD,GAqExB,IAAAE,IAEIA,GAAArgB,UAAAsgB,SAAA,SACIP,EACAQ,EACAja,EAEA6Z,GAEApP,QAAQC,IAAK,UAAY+O,EAAW,OAASQ,EAAQ,MAAQja,IAKjE+Z,GAAArgB,UAAAwgB,UAAA,SAAUzG,EAAiB0G,GACvB1P,QAAQC,IAAK,WAAaP,KAAKE,UAAUoJ,GAAU,UAAY0G,EAAa,iBAdhF,SAAAJ,MAsDJ,IAAAK,IAeIA,GAAA1gB,UAAA2gB,YAAA,SAAYC,GACLA,IACC9gB,KAAK8gB,SAAWA,IAOxBF,GAAA1gB,UAAAugB,MAAA,SAAOA,GAEH,OADAzgB,KAAKwgB,SAAUC,GACRzgB,MAMX4gB,GAAA1gB,UAAAsgB,SAAA,SAAUC,GAAV,IAAA1f,EAAAf,KACI,GAAIA,KAAK8gB,UAAa9gB,KAAK8gB,SAASN,UAAaC,EAEjD,GAAG9gB,MAAMsU,QAAQwM,GACH,EACHpM,QAAS,SAAC0M,GAAgB,OAAAhgB,EAAKyf,SAASO,SAE5C,CACH,IAAIA,EAAG,EACP,IACI/gB,KAAK8gB,SAASN,SACVO,EAAIf,cACJe,EAAIb,UACJa,EAAItC,UACJsC,EAAIX,cAEV,MAAMjH,GACJlI,QAAQC,IACJ,qDACA6P,EAAIf,cAAgB,KAAOe,EAAIb,UAAY,KAC3Ca,EAAItC,UAAY,OAAStF,EAAErY,YAa3C8f,GAAA1gB,UAAA8gB,SAAA,SAAUhG,EAAe1C,GAErB,OADAtY,KAAKihB,YAAYjG,EAAM1C,GAChBtY,MAQX4gB,GAAA1gB,UAAA+gB,YAAA,SACIjG,EAEA1C,GAEAtY,KAAKwgB,SAAU,IAAIT,GAAMlB,GAAU,SAAWO,GAAM,OAASpE,KAUjE4F,GAAA1gB,UAAAwgB,UAAA,SAAWzG,EAAc0G,GACrB3gB,KAAK8gB,SAASJ,UAAUzG,EAAQ0G,QAvFpC,SAAAC,GAAY7J,iBAFa,KAGlBA,GAA+B,iBAApB,GACVvX,OAAOyX,OAAOjX,KAAM+W,GAEpB/W,KAAK8gB,UACL9gB,KAAK6gB,YAAY,IAAIN,IChNjC,IAAAW,IAeIA,GAAAhhB,UAAAyY,OAAA,SAAOC,GACH5Y,KAAK6Y,QAAUD,EACf5Y,KAAK4Y,QAAUA,EAAU,oBAQ7BsI,GAAAhhB,UAAAihB,QAAA,SAAS5V,EAAiBwL,GACtB,IAAItT,EAAMzD,KAAK4Y,QAAU,WACzB,OAAO5Y,KAAKohB,QAAQ3d,EAAK8H,EAAOwL,GAC/BwB,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,oDAAoD4Y,EAAErY,SAE1E,OADAtB,OAAOyX,OAAOuB,EAAKW,GACZtB,EAAAA,OAASW,MAUxB0I,GAAAhhB,UAAAmM,MAAA,SAAOd,EAAiBwL,GACpB,IAAItT,EAAMzD,KAAK4Y,QAAU,SACzB,OAAO5Y,KAAKohB,QAAQ3d,EAAK8H,EAAOwL,GAC/BwB,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,8CAA8C4Y,EAAErY,SAEpE,OADAtB,OAAOyX,OAAOuB,EAAKW,GACZtB,EAAAA,OAASW,MAWxB0I,GAAAhhB,UAAAmhB,QAAA,SAAS9V,EAAiBwL,GACtB,IAAItT,EAAMzD,KAAK4Y,QAAU,WACzB,OAAO5Y,KAAKohB,QAAQ3d,EAAK8H,EAAOwL,GAC/BwB,SAAM,SAAAY,GACH,IAAIX,EAAM,IAAIjY,MAAM,kDAAkD4Y,EAAErY,SAExE,OADAtB,OAAOyX,OAAOuB,EAAKW,GACZtB,EAAAA,OAASW,MAcxB0I,GAAAhhB,UAAAkhB,QAAA,SAAS3d,EAAc8H,EAAiBwL,GAAxC,IAAAhW,EAAAf,KACI,OAAOyY,EAAAA,SAAW,GACjBL,KAAM,WACH,IAAIrM,EAA2BR,EAAMD,WACjCsM,EAAO7W,EAAK2Y,aAAa,CACzB3B,OAAO,MAAOtU,IAAIA,EAAKwW,OAAOlO,EAAGgL,QAAQA,IAE7C,OAAOhW,EAAK4W,QAAQC,MAc5BsJ,GAAAhhB,UAAAwZ,aAAA,SAAc3C,GAEV,GAAG/W,KAAKmb,YAAYjY,QAAQ6T,EAAO,QAAS,EACxC,MAAM,IAAIxW,MAAM,2BAA2BwW,EAAO,QAEtD,IAAIA,EAAO,IACP,MAAM,IAAIxW,MAAM,wCAIpB,OAFAwW,EAAO,QAAW/W,KAAKuX,SAAWL,EAAM,SAAY,IAE7ClX,KAAK0X,kBAAkBX,IAGlCmK,GAAAhhB,UAAAwX,kBAAA,SAAkBX,GACd,OAAO/W,KAAKqb,OAAO3D,kBAAkBX,IAGzCmK,GAAAhhB,UAAAyX,QAAA,SAAQC,GACJ,OAAO5X,KAAKqb,OAAO1D,QAAQC,GAC1BW,SAAM,SAAAY,GAKH,OAJGA,MAAAA,IACCA,EAAI,IAAI5Y,MAAM,uHAGXsX,EAAAA,OAASsB,UAjHxB,SAAA+H,GAAYzd,EAAc6X,gBAHC,qBACM,CAAC,MAAO,OAAQ,MAAO,SAAU,SAG9Dtb,KAAK2Y,OAAOlV,GACZzD,KAAKqb,OAASC,GCiBtB,SAAAgG,MAlCA,SAAAC,IACgC,mBAAjB/hB,OAAOyX,QAEhBzX,OAAOgiB,eAAehiB,OAAQ,SAAU,CACtCiB,MAAO,SAAgBghB,EAAcC,GAEnC,GAAc,MAAVD,EACF,MAAM,IAAIE,UAAU,8CAMtB,IAFA,IAAIC,EAAKpiB,OAAOiiB,GAEPI,EAAQ,EAAGA,EAAQC,UAAUte,OAAQqe,IAAS,CACrD,IAAIE,EAAaD,UAAUD,GAE3B,GAAkB,MAAdE,EACF,IAAK,IAAIC,KAAWD,EAEdviB,OAAOU,UAAUL,eAAemB,KAAK+gB,EAAYC,KACnDJ,EAAGI,GAAWD,EAAWC,IAKjC,OAAOJ,GAETK,UAAU,EACVC,cAAc,IAOlBX,GCnCJD,6GCEA,SAAAa,KACI,OAAO,IAAI3R,6EpB0Pf,SAAA4R,GAAmBle,GACf,GAAsB,mBAAlB,EACA,MAAM,IAAI3D,MAAM,qDAEpB,OAAO,SAAS0D,GACZ,OAAOJ,EAAW1D,OAAO8D,EAAQC,6MqBpPlB,SAAS2Q,EAAW+D,EAAkB0C,GACzD,IAAIvY,EAAwB,iBAAhB,EACR8R,EAAOA,GAAOA,EAAI9R,KAAO8R,EAAI9R,KAAO,KACxC,IAAIA,EAAM,MAAM,IAAIxC,MAAM,uDAC1B,IAAIqY,EAAS,MAAM,IAAIrY,MAAM,2BAC7B,IAAI+a,EAAY,MAAM,IAAI/a,MAAM,uDAChC,OAAOwC,GACH,KAAK9B,EAAUG,MAAS,OAAO,IAAIqa,EAAe7C,EAAS0C,GAC3D,KAAKra,EAAUE,QAAS,OAAO,IAAIqb,EAAe5D,EAAS0C,GAC3D,KAAKra,EAAUI,IAAS,OAAO,IAAIma,EAAe5C,EAAS0C,GAC3D,KAAKra,EAAUK,QAAS,OAAO,IAAIyb,EAAenE,EAAS0C,GAC3D,KAAKra,EAAUC,QAAS,OAAO,IAAIqa,EAAe3C,EAAS0C,GAC3D,QAAwB,OAAO,IAAI5C,EAAeE,EAAS0C,gILyEnE,SAAA+G,GAA8BC,EAAoB9b,GAC9C,IAAI9D,EAAM,GACV,GAAG4f,GAAa9b,GAAQA,EAAKzD,KACzB,GAAG9B,EAAUI,MAAQmF,EAAKzD,MAEtB,GADAL,EAAO2T,KAAM,IAAI0J,GAAMlB,GAAU,IAAMyD,EAAW9b,IAC/C4Y,GAAM,YAAekD,IAEpB9b,EAAK+b,OAAOlO,QAAS,SAACmO,GAClB,GAAGA,EAAW3d,MAAO,CACjB,IAAI4d,EAAcJ,GAAqBC,EAAWE,EAAW3d,OACxD+Z,OAAO,SAAAzF,GAAG,OAAI,OAAJA,IACZsJ,GAAeA,EAAYjf,SAC1Bd,EAASA,EAAOggB,OAAOD,OAKhCjc,EAAKmc,WAAW,CACf,IAAIC,EAAaP,GAAqBC,EAAW9b,EAAKmc,WACjD/D,OAAO,SAAAzF,GAAG,OAAI,OAAJA,IACZyJ,GAAcA,EAAWpf,SACxBd,EAASA,EAAOggB,OAAQE,UAIjC,GAAG3hB,EAAUG,QAAUoF,EAAKzD,KAC/BL,EAAO2T,KAAM,IAAI0J,GAAMlB,GAAU,MAAQyD,EAAW9b,IACjD4Y,GAAM,YAAekD,GAAa9b,EAAKzB,UAAYyB,EAAKzB,SAASvB,QAChEd,EAAO2T,KAAM,IAAI0J,GAAMlB,GAAU,QAAUyD,EAAW9b,EAAKzB,SAAS,SAErE,CACH,IAAIkb,EAvFhB,SAAAD,EAAqBjd,GACjB,IAAIL,EAASmc,GAAU,QACvB,GAAG9b,EAAM,CACL,IAAI8f,EAAkBrjB,OAAO2U,KAAK0K,IAAYra,IAAI,SAAC4P,GAAW,OAAAyK,GAAWzK,KAEzE,IAAIyO,EAAK3f,QAAQH,GACb,OAAOA,EAEN,IAAIA,EAAKG,QAAQ,KAAM,CACxB,IAAI4f,EAAM/f,EAAK2K,MAAM,KAAK,GAC1B,IAAImV,EAAK3f,QAAQ4f,GACb,OAAOA,GAGnB,OAAOpgB,EAyEgBsd,CAAYxZ,EAAKzD,MAChCL,EAAO2T,KAAM,IAAI0J,GAAME,EAAUqC,EAAW9b,IAQpD,OAAO9D","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","\nclass GPError extends Error {\n    public error : string|null;\n    public status: number = 500;\n    public statusCode : number = 500;\n    constructor(message : string) {\n        super(message);\n        this.error = null;\n    }\n    public setError(value:string) { this.error = value; }\n    public setStatus(value:number) { this.status = this.statusCode = value; }\n}\n\nexport default GPError;\n","\n\nconst ItemTypes = {\n    DATASET         : \"dcat:Dataset\",\n    SERVICE         : \"regp:Service\",\n    LAYER           : \"Layer\",\n    MAP             : \"Map\",\n    GALLERY         : \"Gallery\",\n    COMMUNITY       : 'Community',\n    APPLICATION     : 'Application',\n    TOPIC           : 'Topic',\n    WEBSITE         : 'WebSite',\n    IMAGE_PRODUCT   : 'eo:Product',\n    ORGANIZATION    : \"org:Organization\",\n    CONTACT         : \"vcard:VCard\",\n    PERSON          : \"foaf:Person\",\n    CONCEPT         : \"skos:Concept\",\n    CONCEPT_SCHEME  : \"skos:ConceptScheme\",\n    STANDARD        : 'dct:Standard',\n    RIGHTS_STATEMENT: 'dct:RightsStatement'\n};\n\nconst ItemTypeLabels = {};\nItemTypeLabels[ItemTypes.DATASET]          = \"Dataset\";\nItemTypeLabels[ItemTypes.SERVICE]          = \"Service\";\nItemTypeLabels[ItemTypes.LAYER]            = \"Layer\";\nItemTypeLabels[ItemTypes.MAP]              = \"Map\";\nItemTypeLabels[ItemTypes.GALLERY]          = \"Gallery\";\nItemTypeLabels[ItemTypes.COMMUNITY]        = 'Community';\nItemTypeLabels[ItemTypes.APPLICATION]      = 'Application';\nItemTypeLabels[ItemTypes.TOPIC]            = 'Topic';\nItemTypeLabels[ItemTypes.WEBSITE]          = 'WebSite';\nItemTypeLabels[ItemTypes.IMAGE_PRODUCT]    = \"Image Product\";\nItemTypeLabels[ItemTypes.ORGANIZATION]     = \"Organization\";\nItemTypeLabels[ItemTypes.CONTACT]          = \"Contact\";\nItemTypeLabels[ItemTypes.PERSON]           = \"Person\";\nItemTypeLabels[ItemTypes.CONCEPT]          = \"Concept\";\nItemTypeLabels[ItemTypes.CONCEPT_SCHEME]   = \"Concept Scheme\";\nItemTypeLabels[ItemTypes.STANDARD]         = 'Standard';\nItemTypeLabels[ItemTypes.RIGHTS_STATEMENT] = 'Rights Statement';\n\n\nexport {\n    ItemTypes as default,\n    ItemTypes,\n    ItemTypeLabels\n};\n","\nimport ItemTypes from './types';\n\n\n\nconst URI_BASE = 'http://www.geoplatform.gov';\n\nconst ESRI_TYPES = [\n    \"http://www.geoplatform.gov/spec/esri-feature-rest\",\n    \"http://www.geoplatform.gov/spec/esri-image-rest\",\n    \"http://www.geoplatform.gov/spec/esri-map-rest\",\n    \"http://www.geoplatform.gov/spec/esri-tile-rest\"\n];\n\n\n\n\nfunction formatReference( ref : any ) : any {\n    if(ref === null) return '';\n    if(typeof(ref) === 'string')\n        return ref.toLowerCase().replace(/\\s/g,'');\n    else if(typeof(ref) === 'object') {\n        var result = '';\n        for(var prop in ref) {\n            if(ref.hasOwnProperty(prop)) {\n                var value = ref[prop];\n                if(value !== null && typeof(value) !== 'undefined') {\n                    //TODO catch non-string-able values\n                    result += (value+'').toLowerCase().replace(/\\s/g,'');\n                }\n            }\n        }\n        return result;\n    }\n    return '';\n}\n\n/**\n * Adjusts service access url to ignore certain patterns that can affect\n * how URI uniqueness is.\n * @param service - GP Service instance\n * @return access url adjusted for URI generation needs\n */\nfunction fixServiceHref(service : any) : string {\n    stripLayerFromServiceHref(service);\n    let url = service.accessURL || service.href;\n    if(!url || !url.length) return null;\n\n    //ensure case sensitivity is not an issue\n    // and that any surrounding whitespace is ignored\n    url = (url + '').trim().toLowerCase();\n\n    url = url.replace(/http(s)?:\\/\\//,'');    //ignore protocol for URI purposes\n\n    url = url.replace(/&?request=[A-Za-z]+/i,'')\n             .replace(/&?service=(WMS|WFS|WCS|CSW)/i,'')\n             .replace(/&?version=[0-9\\.]*/i,'')\n             .replace(/&?layers=[A-Za-z0-9\\-\\:_,]*/i, '')\n             .replace(/&?srs=[A-Za-z0-9\\:]*/i, '')\n             .replace(/&?crs=[A-Za-z0-9\\:]*/i, '')\n             .replace(/&?format=[A-Za-z\\/]*/i, '')\n             .replace(/&?bbox=[0-9,\\.]*/i, '');\n\n    let lastChar = url[url.length-1];\n    if( '/' === lastChar || '?' === lastChar) { //ignore empty querystring or trailing slashes\n        url = url.substring(0, url.length-1);\n    }\n    return url;\n}\n\n\n/**\n * ESRI services sometimes have layer information baked into their URL\n * which needs to be removed before the service can be used.\n * @param service - GP Service object\n */\nfunction stripLayerFromServiceHref(service : any) : string {\n\n    if(!service) return;\n    let type = service.serviceType || service.conformsTo;\n    if(!type) return;\n\n    //if ESRI service, make sure it doesn't have a layer id on the href\n    if( ESRI_TYPES.indexOf(type.uri) >= 0 ) {\n\n        let href = service.href || service.accessURL;\n        let matches = href.match(/(Map|Feature|Image)(Server\\/\\d+)/i);\n        if(matches && matches.length > 2) {\n            // 0 < full string match (ie, 'MapServer/1')\n            // 1 < server type match (ie, 'Map' or 'Feature')\n            // 2 < bit we care about (ie, 'Server/1')\n            href = href.replace(matches[2], 'Server/');\n\n            if(service.href) service.href = href;\n            if(service.accessURL) service.accessURL = href;\n        }\n    }\n}\n\n\n\n\n/**\n * @see https://geoplatform.atlassian.net/wiki/display/DT/Common+Object+Identifier+Scheme\n */\nconst URIFactory = {\n\n    factories : {},\n\n    register : function (type : string, factory : Function) {\n        this.factories[type] = factory;\n    },\n\n    create : function(object : any, md5Fn : Function) {\n        if(!object || !object.type) return null;\n        if( typeof(md5Fn) !== 'function' ) {\n            throw new Error(\"Must specify a MD5 function when using URIFactory\");\n        }\n        let factory = this.factories[object.type];\n        if(!factory) return null;\n        return factory(object, md5Fn);\n    }\n};\n\n\n\n\nURIFactory.register(ItemTypes.DATASET, function(dataset : any, md5 : Function) {\n    let pubName = (dataset.publisher||dataset.publishers||[])\n        .map( pub => { return pub.label||\"\"; }).join('');\n    let ref : any = formatReference({\n        title: dataset.title,\n        pub: pubName\n    });\n    return URI_BASE + '/id/dataset/' + md5(ref);\n});\n\nURIFactory.register(ItemTypes.SERVICE, function(service : any, md5 : Function) {\n    let url = fixServiceHref(service);\n    let ref = formatReference(url);\n    return URI_BASE + '/id/service/' + md5(ref);\n});\n\nURIFactory.register(ItemTypes.LAYER, function(layer : any, md5 : Function) {\n\n    let svcUrl = '';\n    let services = layer.servicedBy || layer.services;\n    if(services && services.length)\n        svcUrl = services[0].accessURL || services[0].href || '';\n    let lyrUrl = layer.accessURL || layer.href || '';\n    let lyrName = layer.layerName || '';\n\n    //not recommended based upon following example:\n    //  http://services.nationalmap.gov/.../MapServer/WMSServer?request=GetCapabilities&service=WMS/layer/1\n    // return url + '/layer/' + layer.layerName;\n\n    let args = svcUrl + lyrName + lyrUrl;\n    if(!args.length) return null;   //nothing was provided\n\n    //ALTERNATE URI PATTERN\n    let ref = formatReference(args);\n    return URI_BASE + '/id/layer/' + md5(ref);\n\n});\n\n/**\n * Uses the map title, createdBy, and all third-party identifiers associated with the map\n * @param {object} map - GP Map object\n * @return {string} uri unique to this object\n */\nURIFactory.register(ItemTypes.MAP, function(map : any, md5 : Function) {\n    let author = map.createdBy || map._createdBy || \"\";\n    let identifiers = (map.identifiers || map.identifier || []).join('');\n    let ref = formatReference({title: map.title, author: author, identifiers: identifiers});\n    return URI_BASE + '/id/map/' + md5(ref);\n});\n\nURIFactory.register(ItemTypes.GALLERY, function(gallery : any, md5 : Function) {\n    let author = gallery.createdBy || gallery._createdBy || \"\";\n    let ref = formatReference({title: gallery.title, author: author});\n    return URI_BASE + '/id/gallery/' + md5(ref);\n});\n\nURIFactory.register(ItemTypes.COMMUNITY, function(community : any, md5 : Function) {\n    let ref = formatReference({title: community.title});\n    return URI_BASE + '/id/community/' + md5(ref);\n});\n\nURIFactory.register(ItemTypes.ORGANIZATION, function(org : any, md5 : Function) {\n    let ref = formatReference(org.label || org.name);\n    return URI_BASE + '/id/organization/' + md5(ref);\n});\n\nURIFactory.register(ItemTypes.PERSON, function(person : any, md5 : Function) {\n    let ref = formatReference(person.name);\n    return URI_BASE + '/id/person/' + md5(ref);\n});\n\nURIFactory.register(ItemTypes.CONTACT, function(vcard : any, md5 : Function) {\n    let ref : any = {};\n    if(vcard.email || vcard.hasEmail)\n        ref.email = vcard.email || vcard.hasEmail; //email\n    if(vcard.tel)\n        ref.tel = vcard.tel; //tel\n    if(vcard.orgName || vcard['organization-name'])\n        ref.orgName = vcard.orgName || vcard['organization-name']; //orgName\n    if(vcard.positionTitle)\n        ref.positionTitle = vcard.positionTitle; //positionTitle\n    ref = formatReference(ref);\n    return URI_BASE + '/id/contact/' + md5(ref);\n});\n\nURIFactory.register(ItemTypes.CONCEPT, function(object : any, md5 : Function) {\n    let scheme = object.inScheme || object.scheme;\n    let schemeLabel = scheme ? (scheme.label || scheme.prefLabel) : '';\n    let schemeRef = formatReference(schemeLabel);\n    let ref = formatReference( object.label || object.prefLabel );\n    return URI_BASE + '/id/metadata-codelists/' + md5(schemeRef) + '/' + md5(ref);\n});\n\nURIFactory.register(ItemTypes.CONCEPT_SCHEME, function(object : any, md5 : Function) {\n    let ref = formatReference(object.label || object.prefLabel);\n    return URI_BASE + '/id/metadata-codelists/' + md5(ref);\n});\n\n\nURIFactory.register(ItemTypes.APPLICATION, function(object : any, md5 : Function) {\n    if(!object || !object.title) return null;\n    let author = object.createdBy || object._createdBy || \"\";\n    let ref = formatReference({title: object.title, author: author});\n    return URI_BASE + '/id/application/' + md5(ref);\n});\n\nURIFactory.register(ItemTypes.TOPIC, function(object : any, md5 : Function) {\n    if(!object || !object.title) return null;\n    let author = object.createdBy || object._createdBy || \"\";\n    let ref = formatReference({title: object.title, author: author});\n    return URI_BASE + '/id/topic/' + md5(ref);\n});\n\nURIFactory.register(ItemTypes.WEBSITE, function(item : any, md5 : Function) {\n    if(!item || !item.landingPage) return null;\n    let ref = formatReference(item.landingPage);\n    return URI_BASE + '/id/website/' + md5(ref);\n});\n\nURIFactory.register(ItemTypes.IMAGE_PRODUCT, function(item : any, md5 : Function) {\n    if(!item.productId) return null;\n    let ref = formatReference(item.productId);\n    return URI_BASE + '/id/product/' + md5(ref);\n});\n\n\n\nfunction factoryFn(md5Fn) {\n    if( typeof(md5Fn) !== 'function' ) {\n        throw new Error(\"Must specify a MD5 function when using URIFactory\");\n    }\n    return function(object) {\n        return URIFactory.create(object, md5Fn);\n    };\n}\n\n\n\nexport {\n    factoryFn as default,\n    factoryFn as URIFactory\n};\n","\n\nexport default {\n    ALTERNATE_TITLE  : 'alternateTitles',\n    BEGINS           : 'startDate.min',\n    CLASSIFIERS      : 'classifiers',\n    CREATED          : 'created',\n    CREATED_BEFORE   : 'created.max',\n    CREATED_AFTER    : 'created.min',\n    CREATED_BY       : 'createdBy',\n    CREATOR          : 'creator.id',\n    CONTRIBUTED_BY   : 'contributedBy',\n    ENDS             : 'endDate.max',\n    EXTENT           : 'extent',\n    IDENTIFIERS      : 'identifiers',\n    KEYWORDS         : 'keywords',\n    LAST_MODIFIED_BY : 'lastModifiedBy',\n    MODIFIED         : 'modified',\n    MODIFIED_BEFORE  : 'modified.max',\n    MODIFIED_AFTER   : 'modified.min',\n    PUBLISHERS_ID    : 'publisher.id',\n    PUBLISHERS_LABEL : 'publisher.label',\n    PUBLISHERS_URI   : 'publisher.uri',\n    CONTACTS_ID      : 'contacts.id',\n    CONTACTS_LABEL   : 'contacts.label',\n    CONTACTS_URI     : 'contacts.uri',\n    QUERY            : 'q',\n    SCHEMES_ID       : 'scheme.id',\n    SCHEMES_LABEL    : 'scheme.label',\n    SCHEMES_URI      : 'scheme.uri',\n    SIMILAR_TO       : 'similarTo',\n    STATUS           : 'status',\n    SERVICE_TYPES    : 'serviceType.id',\n    THEMES_ID        : 'theme.id',\n    THEMES_LABEL     : 'theme.label',\n    THEMES_URI       : 'theme.uri',\n    TOPICS_ID        : 'topic.id',\n    TOPICS_LABEL     : 'topic.label',\n    TOPICS_URI       : 'topic.uri',\n    TYPES            : 'type',      //TODO change to 'types'\n    URI              : 'uri',\n    USED_BY_ID       : 'usedBy.id',\n    USED_BY_LABEL    : 'usedBy.label',\n    USED_BY_URI      : 'usedBy.uri',\n    VISIBILITY       : 'visibility',\n    RESOURCE_TYPE    : 'resourceType',\n    DATASET          : 'dataset',\n    LANDING_PAGE     : 'landingPage',\n    PURPOSE          : 'purpose',\n\n    //statistics parameters\n    RELIABILITY      : 'reliability',\n    RELIABILITY_MIN  : 'reliability.min',\n    RELIABILITY_MAX  : 'reliability.max',\n    ONLINE           : 'online',\n    COMPLIANT        : 'compliant',\n    SPEED            : 'speed',\n    SPEED_MIN        : 'speed.min',\n    SPEED_MAX        : 'speed.max',\n    LIKES            : 'likes',\n    LIKES_MIN        : 'likes.min',\n    LIKES_MAX        : 'likes.max',\n    VIEWS            : 'views',\n    VIEWS_MIN        : 'views.min',\n    VIEWS_MAX        : 'views.max',\n\n    //type-specific parameters\n    HREF             : 'href',           //service-specific\n    LAYER_TYPE       : 'layerType',     //layer-specific\n    LAYER_NAME       : 'layerName',     //...\n    PARENT_LAYER     : 'parentLayer',   //...\n    SUB_LAYER        : 'subLayer',      //...\n    SERVICE          : 'service',       //...\n    MAP_LAYER        : 'mapLayer',      //map-specific\n    GALLERY_ITEM     : 'galleryItem',   //gallery-specific\n\n    //meta-parameters\n    FACETS           : 'includeFacets',  //TODO change to 'facets'\n    FIELDS           : 'fields',\n    SORT             : 'sort',\n    PAGE             : 'page',\n    PAGE_SIZE        : 'size',\n\n    //recommender service-specific\n    FOR_TYPES        : 'for'\n};\n","\nimport QueryParameters from './parameters';\n\ninterface KVP<U> { [ key : string ] : U }\n\n\nconst SORT_OPTIONS_DEFAULT : { value:string; label:string; }[] = [\n    { value:\"label,asc\",       label: \"Name (A-Z)\"              },\n    { value:\"label,desc\",      label: \"Name (Z-A)\"              },\n    { value:\"type,asc\",        label: \"Type (A-Z)\"              },\n    { value:\"type,desc\",       label: \"Type (Z-A)\"              },\n    { value:\"modified,desc\",   label: \"Most recently modified\"  },\n    { value:\"modified,asc\",    label: \"Least recently modified\" },\n    { value:\"_score,desc\",     label: \"Relevance\"               }\n];\n\n\nclass KGQuery {\n\n    public query : KVP<any>;\n    private defaultQuery : KVP<any>;\n\n    constructor() {\n\n        this.defaultQuery = {\n            page: 0,\n            size: 10,\n            sort: \"modified,desc\"\n        };\n\n        this.query = {\n            page: 0,\n            size: 10,\n            sort: \"modified,desc\"\n        };\n\n    }\n\n\n    getQuery() : KVP<any> {\n        let result : KVP<any> = {};\n        for(let prop in this.query) {\n            let value = this.query[prop];\n            if(value !== null && typeof(value.push) !== 'undefined') {\n                value = value.join(',');\n            }\n            result[prop] = value;\n        }\n        return result;\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    parameter(name : string, value: any) : KGQuery {\n        this.setParameter(name, value);\n        return this;\n    }\n\n    setParameter (name : string, value : any) {\n        if(value === null || value === undefined)\n            delete this.query[name];\n        else\n            this.query[name] = value;\n    }\n\n    getParameter (key : string) : any {\n        return this.query[key];\n    }\n\n    applyParameters (obj : KVP<any> ) {\n        for(var p in obj) {\n            if(obj.hasOwnProperty(p)) {\n                this.setParameter(p, obj[p]);\n            }\n        }\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    q(text : string) : KGQuery {\n        this.setQ(text);\n        return this;\n    }\n\n    /**\n     * @param text - free text query\n     */\n    setQ (text : string) {\n        this.setParameter(QueryParameters.QUERY, text);\n    }\n\n    getQ() : string|null {\n        return this.getParameter(QueryParameters.QUERY);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * @param types - KG classifiers for which concepts should be returned\n     */\n    classifiers(types : string|string[]) : KGQuery {\n        this.setClassifiers(types);\n        return this;\n    }\n\n    /**\n     * @param types - KG classifiers for which concepts should be returned\n     */\n    setClassifiers (types : string|string[]) {\n        if(!types) return;\n        if(typeof(types) === 'string') types = types = [types];\n        this.setParameter(QueryParameters.TYPES, types);\n    }\n\n    /**\n     * @return KG classifiers for which concepts should be returned\n     */\n    getClassifiers () : string[] {\n        return this.getParameter(QueryParameters.TYPES);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * Specify the Item object model type name(s) for which\n     * recommended concepts should be returned. Note: this\n     * query parameter is not the same as the GeoPlatform.Query.types()\n     * query parameter (they map to different HTTP request parameters).\n     * @param objTypes - Item object type names\n     */\n    types(objTypes : string|string[]) : KGQuery {\n        this.setTypes(objTypes);\n        return this;\n    }\n\n    /**\n     * Specify the Item object model type name(s) for which\n     * recommended concepts should be returned. Note: this\n     * query parameter is not the same as the GeoPlatform.Query.setTypes()\n     * query parameter (they map to different HTTP request parameters).\n     * @param objTypes - Item object type names\n     */\n    setTypes (objTypes : string|string[]) {\n        if(!objTypes) return;\n        if(typeof(objTypes) === 'string') objTypes = [objTypes];\n        this.setParameter(QueryParameters.FOR_TYPES, objTypes);\n    }\n\n    /**\n     * Get the Item object model type name(s) for which\n     * recommended concepts should be returned. Note: this\n     * query parameter is not the same as the GeoPlatform.Query.getTypes()\n     * query parameter (they map to different HTTP request parameters).\n     * @return Item object type names\n     */\n    getTypes () : string[] {\n        return this.getParameter(QueryParameters.FOR_TYPES);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * @param page - page of results to fetch\n     */\n    page (page : number) : KGQuery {\n        this.setPage(page);\n        return this;\n    }\n\n    setPage(page : number) {\n        if(isNaN(page) || page*1<0) return;\n        this.query.page = page*1;\n    }\n\n    getPage() : number {\n        return this.query.page;\n    }\n\n    nextPage() : void {\n        this.setPage(this.query.page+1);\n    }\n\n    previousPage() : void {\n        this.setPage(this.query.page-1);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * @param size - page size to request\n     */\n    pageSize (size: number) : KGQuery {\n        this.setPageSize(size);\n        return this;\n    }\n\n    setPageSize (size : number) {\n        if(isNaN(size) || size*1<0) return;\n        this.query.size = size*1;\n    }\n\n    getPageSize() : number {\n        return this.query.size;\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * @param sort - form of <field>,<dir> or just field name\n     * @param order - optional, either 'asc' or 'desc'\n     */\n    sort (sort : string, order ?: string) : KGQuery {\n        this.setSort(sort, order);\n        return this;\n    }\n\n    /**\n     * @param sort - form of <field>,<dir> or just field name\n     * @param order - optional, either 'asc' or 'desc'\n     */\n     setSort(sort : string, order ?:string) {\n         order = order || 'desc';\n         if(sort && sort.indexOf(',')<0)\n            sort = sort + ',' + order;\n         this.query.sort = sort;\n    }\n\n    getSort() : string | null {\n        return this.query.sort;\n    }\n\n    getSortField() : string | null {\n        return this.query.sort.split(',')[0];\n    }\n\n    getSortOrder() : boolean {\n        return this.query.sort.split(',')[1] === 'asc';\n    }\n\n    /**\n     * @return list of key-value pairs of sort options\n     */\n    getSortOptions() : { value: string, label: string; }[] {\n        return SORT_OPTIONS_DEFAULT.slice(0);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     *\n     */\n    clear () {\n        this.query = this.defaultQuery;\n    }\n}\n\nexport default KGQuery;\n","\n\n\nexport default  {\n    PURPOSE             : 'purpose',\n    FUNCTION            : 'function',\n    TOPIC_PRIMARY       : 'primaryTopic',\n    TOPIC_SECONDARY     : 'secondaryTopic',\n    SUBJECT_PRIMARY     : 'primarySubject',\n    SUBJECT_SECONDARY   : 'secondarySubject',\n    COMMUNITY           : 'community',\n    AUDIENCE            : 'audience',\n    PLACE               : 'place',\n    CATEGORY            : 'category'\n};\n","\nimport Parameters from './parameters';\nimport Classifiers from './classifiers';\n\ninterface KVP<U> { [ key : string ] : U }\n\nconst Fields : KVP<string> = {\n    ACCESS_RIGHTS       : 'rights',\n    ALTERNATE_TITLES    : 'alternateTitles',\n    ANNOTATIONS         : 'annotations',\n    CLASSIFIERS         : 'classifiers',\n    CONCEPT_SCHEME      : 'scheme',\n    CONTACTS            : 'contacts',\n    CREATED             : 'created',\n    CREATED_BY          : 'createdBy',\n    DATASETS            : 'datasets',\n    DESCRIPTION         : 'description',\n    DISTRIBUTIONS       : 'distributions',\n    EXTENT              : 'extent',\n    GALLERY_ITEMS       : 'items',\n    HREF                : 'href',\n    IDENTIFIERS         : 'identifiers',\n    KEYWORDS            : 'keywords',\n    LABEL               : 'label',\n    LAST_MODIFIED_BY    : 'lastModifiedBy',\n    LAYERS              : 'layers',\n    LAYER_TYPE          : 'layerType',\n    LAYER_NAME          : 'layerName',\n    LEGEND              : 'legend',\n    MODIFIED            : 'modified',\n    PARENT_LAYER        : 'parentLayer',\n    PUBLISHERS          : 'publishers',\n    RESOURCE_TYPES      : 'resourceTypes',\n    SERVICE_TYPE        : 'serviceType',\n    SERVICES            : 'services',\n    SPATIAL             : 'spatial',\n    STATISTICS          : 'statistics',\n    STATUS              : 'status',\n    SUB_LAYERS          : 'subLayers',\n    TEMPORAL            : 'temporal',\n    THEMES              : 'themes',\n    THUMBNAIL           : 'thumbnail',\n    TOPICS              : 'topics',\n    USED_BY             : 'usedBy',\n    VISIBILITY          : 'visibility',\n    LANDING_PAGE        : 'landingPage'\n};\n\nconst FIELDS_DEFAULT : string[] = [\n    Fields.CREATED, Fields.MODIFIED, Fields.CREATED_BY,\n    Fields.PUBLISHERS, Fields.THEMES, Fields.DESCRIPTION\n];\n\n/* --------------------------------------------------------- */\n\nconst Facets : KVP<string> = {\n    ALTERNATE_TITLES    : 'alternateTitles',\n    CONCEPT_SCHEMES     : 'schemes',\n    CREATED_BY          : 'createdBy',\n    HREF                : 'href',\n    IDENTIFIERS         : \"identifiers\",\n    LAYER_TYPE          : 'layerType',\n    LAYER_NAME          : 'layerName',\n    LIKES               : 'likes',\n    ONLINE              : 'online',\n    PUBLISHERS          : 'publishers',\n    CONTACTS            : 'contacts',\n    RELIABILITY         : 'reliability',\n    SERVICE_TYPES       : 'serviceTypes',\n    SPEED               : 'speed',\n    STATUS              : 'status',\n    THEMES              : 'themes',\n    TOPICS              : 'topics',\n    TYPES               : 'type',   //TODO change to 'types'\n    USED_BY             : 'usedBy',\n    VIEWS               : 'views',\n    VISIBILITY          : 'visibility'\n};\n\nconst FACETS_DEFAULT : string[] = [\n    Facets.TYPES,\n    Facets.PUBLISHERS,\n    Facets.SERVICE_TYPES,\n    Facets.CONCEPT_SCHEMES,\n    Facets.VISIBILITY,\n    Facets.CREATED_BY\n];\n\n\n/*\n    Map facet keys to parameters so clients can set\n    query params using faceted results\n\n    //TODO remove these and their function below\n */\nconst FacetToParam : KVP<string> = {};\nFacetToParam[Facets.TYPES]           = Parameters.TYPES;\nFacetToParam[Facets.THEMES]          = Parameters.THEMES_ID;\nFacetToParam[Facets.TOPICS]          = Parameters.TOPICS_ID;\nFacetToParam[Facets.PUBLISHERS]      = Parameters.PUBLISHERS_ID;\nFacetToParam[Facets.CONTACTS]        = Parameters.CONTACTS_ID;\nFacetToParam[Facets.CONCEPT_SCHEMES] = Parameters.SCHEMES_ID;\nFacetToParam[Facets.USED_BY]         = Parameters.USED_BY_ID;\n\n\n\n/* --------------------------------------------------------- */\n\n\nconst SORT_OPTIONS_DEFAULT : { value: string; label: string; }[] = [\n    { value:\"label,asc\",       label: \"Name (A-Z)\"              },\n    { value:\"label,desc\",      label: \"Name (Z-A)\"              },\n    { value:\"type,asc\",        label: \"Type (A-Z)\"              },\n    { value:\"type,desc\",       label: \"Type (Z-A)\"              },\n    { value:\"modified,desc\",   label: \"Most recently modified\"  },\n    { value:\"modified,asc\",    label: \"Least recently modified\" },\n    { value:\"_score,desc\",     label: \"Relevance\"               }\n];\n\n\nconst BBOX_REGEX = /^\\-?\\d+(\\.\\d*)?,\\-?\\d+(\\.\\d*)?,\\-?\\d+(\\.\\d*)?,\\-?\\d+(\\.\\d*)?$/;\n\n\nfunction toArray(value : any) : any | null {\n    let result = value;\n    //if given a non-array value, wrap in array\n    if(result !== null && typeof(result.push) === 'undefined') result = [result];\n    //if array value is empty, nullify the result\n    if(result !== null && !result.length) result = null;\n    return result;\n}\n\n\n\n/**\n * Query\n *\n * Specify the \"default\" query constraints to use by passing in 'options.defaults = {...}';\n *\n */\nclass Query {\n\n    public query : KVP<any>;\n    private defaultQuery : KVP<any>;\n\n    /**\n     * @param options - set of initial constraints\n     */\n    constructor(options ?: KVP<any>) {\n        this.defaultQuery = { };\n        this.defaultQuery[Parameters.PAGE.toString()] = 0;\n        this.defaultQuery[Parameters.PAGE_SIZE.toString()] = 10;\n        this.defaultQuery[Parameters.SORT.toString()] = \"modified,desc\";\n        this.defaultQuery[Parameters.FIELDS.toString()] = FIELDS_DEFAULT.slice(0);\n        this.defaultQuery[Parameters.FACETS.toString()] = FACETS_DEFAULT.slice(0);\n        if(options && options.defaults) {\n            Object.assign(this.defaultQuery, options.defaults);\n            delete options.defaults;\n        }\n        this.query = JSON.parse(JSON.stringify(this.defaultQuery));\n        if(options) {\n            this.applyParameters(options);\n        }\n    }\n\n\n    /**\n     * @return containing request-ready parameters/values\n     */\n    getQuery() : KVP<any> {\n        let result : KVP<any> = {};\n        for(let prop in this.query) {\n            let value = this.query[prop];\n            if(value !== null && typeof(value.push) !== 'undefined') {\n                value = value.join(',');\n            }\n            result[prop] = value;\n        }\n        return result;\n    }\n\n    /**\n     * @return Query\n     */\n    clone() : Query {\n        let result = new Query();\n        let json = JSON.parse(JSON.stringify(this.query));\n        result.applyParameters(json);\n        return result;\n    }\n\n\n    // -----------------------------------------------------------\n\n    /**\n     * @param name\n     * @param value\n     * @return Query this\n     */\n    parameter(name : string, value : any) : Query {\n        this.setParameter(name, value);\n        return this;\n    }\n\n    /**\n     * @param name\n     * @param value\n     */\n    setParameter (name : string, value: any) : void {\n        if(value === null || value === undefined || //if no value was provide\n            (typeof(value.push) !== 'undefined' && !value.length)) //or empty array\n            delete this.query[name];\n        else\n            this.query[name] = value;\n    }\n\n    /**\n     * @param key - name of parameter\n     * @return value of parameter\n     */\n    getParameter (key : string) : any {\n        return this.query[key];\n    }\n\n    /**\n     * @param obj - set of parameter/values to apply to this query\n     */\n    applyParameters (obj : KVP<any>) : void {\n        for(let p in obj) {\n            if(obj.hasOwnProperty(p)) {\n                this.setParameter(p as string, obj[p] as any);\n            }\n        }\n    }\n\n    /**\n     * @param facet - name of facet to set the value for as a parameter\n     * @param value - value of the facet to use as the parameter's value\n     */\n     //TODO remove this function\n    setFacetParameter (facet: string, value: string) : void {\n        let param : string = FacetToParam[facet];\n        if(!param) {\n            console.log(\"WARN : Query.applyFacetParameter() - \" +\n                \"unable to map facet to known parameter '\" + facet + \"', using \" +\n                \"as direct parameter which may not operate as intended\");\n        }\n        this.setParameter(param||facet, value);\n    }\n\n\n    // -----------------------------------------------------------\n\n    /**\n     * @param text\n     * @return Query this\n     */\n    q(text : string) : Query { this.setQ(text); return this; }\n\n    /** @param text - free text query */\n    setQ (text : string) : void { this.setParameter(Parameters.QUERY, text); }\n    /** @return */\n    getQ() : string { return this.getParameter(Parameters.QUERY) as string; }\n\n\n    // -----------------------------------------------------------\n\n\n    keywords(text : string|string[]) : Query {\n        this.setKeywords(text);\n        return this;\n    }\n\n    /**\n     * @param text - free text query\n     */\n    setKeywords (text : string|string[]) : void {\n        this.setParameter(Parameters.KEYWORDS, toArray(text));\n    }\n\n    getKeywords() : string[] {\n        return this.getParameter(Parameters.KEYWORDS);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    uri (uri : string) : Query {\n        this.setUri(uri);\n        return this;\n    }\n\n    setUri(uri : string) {\n        this.setParameter(Parameters.URI, uri);\n    }\n\n    getUri() : any {\n        return this.getParameter(Parameters.URI);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    types(types : string|string[]) : Query {\n        this.setTypes(types);\n        return this;\n    }\n\n    /**\n     * @param types - name of class(es) to request\n     */\n    setTypes (types : string|string[]) {\n        this.setParameter(Parameters.TYPES, toArray(types));\n    }\n\n    getTypes () : string[] {\n        return this.getParameter(Parameters.TYPES);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    createdBy(user : string) : Query {\n        this.setCreatedBy(user);\n        return this;\n    }\n\n    /** @param user - username */\n    setCreatedBy (user : string) {\n        this.setParameter(Parameters.CREATED_BY, user);\n    }\n\n    /** @return username */\n    getCreatedBy () : any {\n        return this.getParameter(Parameters.CREATED_BY);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    lastModifiedBy(user : string) : Query {\n        this.setLastModifiedBy(user);\n        return this;\n    }\n\n    /** @param user - username */\n    setLastModifiedBy (user: string) {\n        this.setParameter(Parameters.LAST_MODIFIED_BY, user);\n    }\n\n    /** @return username */\n    getLastModifiedBy () : any {\n        return this.getParameter(Parameters.LAST_MODIFIED_BY);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * Specify a Theme or set of Themes to constrain results. By\n     * default, values are assumed to be theme identifiers. If using\n     * theme labels or theme uris, specify the optional second parameter\n     * to be either Parameters.THEMES_LABEL or Parameters.THEMES_URI\n     * respectively.\n     * @param themes - string or array of strings containing theme constraint\n     * @param parameter - optional, to indicate the parameter to use\n     * @return Query\n     */\n    themes(themes: string|string[], parameter?:string) : Query {\n        this.setThemes(themes, parameter);\n        return this;\n    }\n\n\n    /**\n     * Specify a Theme or set of Themes to constrain results. By\n     * default, values are assumed to be theme identifiers. If using\n     * theme labels or theme uris, specify the optional second parameter\n     * to be either Parameters.THEMES_LABEL or Parameters.THEMES_URI\n     * respectively.\n     * @param themes - theme or themes to constrain by\n     */\n    setThemes (themes:string|string[], parameter?:string) {\n\n        //clear existing\n        this.setParameter(Parameters.THEMES_ID, null);\n        this.setParameter(Parameters.THEMES_LABEL, null);\n        this.setParameter(Parameters.THEMES_URI, null);\n\n        let param = parameter || Parameters.THEMES_ID;\n        this.setParameter(param, toArray(themes));\n    }\n\n    getThemes () : string[] {\n        return this.getParameter(Parameters.THEMES_ID) ||\n            this.getParameter(Parameters.THEMES_LABEL) ||\n            this.getParameter(Parameters.THEMES_URI);\n    }\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * Specify a Topic or set of Topics to constrain results. By\n     * default, values are assumed to be theme identifiers. If using\n     * theme labels or theme uris, specify the optional second parameter\n     * to be either Parameters.TOPIC_LABEL or Parameters.TOPIC_URI\n     * respectively.\n     * @param  topics - string or array of strings containing theme constraint\n     * @param  parameter - optional, to indicate the parameter to use\n     * @return Query instance\n     */\n    topics(topics:string|string[], parameter ?: string) : Query {\n        this.setTopics(topics, parameter);\n        return this;\n    }\n\n\n    /**\n     * Specify a Topic or set of Topics to constrain results. By\n     * default, values are assumed to be theme identifiers. If using\n     * theme labels or theme uris, specify the optional second parameter\n     * to be either Parameters.TOPIC_LABEL or Parameters.TOPIC_URI\n     * respectively.\n     * @param topics - theme or topics to constrain by\n     */\n    setTopics (topics:string|string[], parameter ?: string) {\n\n        //clear existing\n        this.setParameter(Parameters.TOPICS_ID, null);\n        this.setParameter(Parameters.TOPICS_LABEL, null);\n        this.setParameter(Parameters.TOPICS_URI, null);\n\n        let param = parameter || Parameters.TOPICS_ID;\n        this.setParameter(param, toArray(topics));\n    }\n\n    getTopics () : string[] {\n        return this.getParameter(Parameters.TOPICS_ID) ||\n            this.getParameter(Parameters.TOPICS_LABEL) ||\n            this.getParameter(Parameters.TOPICS_URI);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * Specify a Publisher or set of Publishers to constrain results. By\n     * default, values are assumed to be identifiers. If using labels or uris,\n     * specify the optional second parameter to be either\n     * Parameters.PUBLISHERS_LABEL or Parameters.PUBLISHERS_URI respectively.\n     * @param parameter - optional, to indicate the parameter to use\n     * @return Query\n     */\n    publishers(publishers:string|string[], parameter?:string) : Query {\n        this.setPublishers(publishers, parameter);\n        return this;\n    }\n\n    /**\n     * Specify a Publisher or set of Publishers to constrain results. By\n     * default, values are assumed to be identifiers. If using labels or uris,\n     * specify the optional second parameter to be either\n     * Parameters.PUBLISHERS_LABEL or Parameters.PUBLISHERS_URI respectively.\n     * @param publishers - publishing orgs to constrain by\n     */\n    setPublishers (publishers:string|string[], parameter?:string) {\n\n        //clear existing\n        this.setParameter(Parameters.PUBLISHERS_ID, null);\n        this.setParameter(Parameters.PUBLISHERS_LABEL, null);\n        this.setParameter(Parameters.PUBLISHERS_URI, null);\n\n        let param = parameter || Parameters.PUBLISHERS_ID;\n        this.setParameter(param, toArray(publishers));\n    }\n\n    getPublishers () : string[] {\n        return this.getParameter(Parameters.PUBLISHERS_ID) ||\n            this.getParameter(Parameters.PUBLISHERS_LABEL) ||\n            this.getParameter(Parameters.PUBLISHERS_URI);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * Specify a Point of Contact or set of Contacts to constrain results. By\n     * default, values are assumed to be identifiers. If using\n     * labels or uris, specify the optional second parameter to be either\n     * Parameters.CONTACTS_LABEL or Parameters.CONTACTS_URI respectively.\n     * @param parameter - optional, to indicate the parameter to use\n     * @return Query\n     */\n    contacts(contacts:string|string[], parameter?:string) : Query {\n        this.setContacts(contacts, parameter);\n        return this;\n    }\n\n    /**\n     * Specify a Contact or set of Contacts to constrain results. By\n     * default, values are assumed to be identifiers. If using\n     * labels or uris, specify the optional second parameter to be either\n     * Parameters.CONTACTS_LABEL or Parameters.CONTACTS_URI respectively.\n     * @param contacts - publishing orgs to constrain by\n     */\n    setContacts (contacts:string|string[], parameter?:string) {\n\n        //clear existing\n        this.setParameter(Parameters.CONTACTS_ID, null);\n        this.setParameter(Parameters.CONTACTS_LABEL, null);\n        this.setParameter(Parameters.CONTACTS_URI, null);\n\n        let param = parameter || Parameters.CONTACTS_ID;\n        this.setParameter(param, toArray(contacts));\n    }\n\n    getContacts () : string[] {\n        return this.getParameter(Parameters.CONTACTS_ID) ||\n            this.getParameter(Parameters.CONTACTS_LABEL) ||\n            this.getParameter(Parameters.CONTACTS_URI);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * Specify the identifier of an Agent (Community, Group, etc) that\n     * uses items you wish to find in search results. By\n     * default, values are assumed to be identifiers. If using\n     * labels or uris, specify the optional second parameter\n     * to be either Parameters.USED_BY_LABEL or Parameters.USED_BY_URI\n     * respectively.\n     * @param parameter - optional, to indicate the parameter to use\n     * @return Query\n     */\n    usedBy(ids:string|string[], parameter?:string) : Query {\n        this.setUsedBy(ids, parameter);\n        return this;\n    }\n\n    /**\n     * Specify the identifier of an Agent (Community, Group, etc) that\n     * uses items you wish to find in search results. By\n     * default, values are assumed to be identifiers. If using\n     * labels or uris, specify the optional second parameter\n     * to be either Parameters.USED_BY_LABEL or Parameters.USED_BY_URI\n     * respectively.\n     * @param ids - publishing orgs to constrain by\n     */\n    setUsedBy (ids:string|string[], parameter?:string) {\n\n        //clear existing\n        this.setParameter(Parameters.USED_BY_ID, null);\n        this.setParameter(Parameters.USED_BY_LABEL, null);\n        this.setParameter(Parameters.USED_BY_URI, null);\n\n        let param = parameter || Parameters.USED_BY_ID;\n        this.setParameter(param, toArray(ids));\n    }\n\n    getUsedBy () : string[] {\n        return this.getParameter(Parameters.USED_BY_ID) ||\n            this.getParameter(Parameters.USED_BY_LABEL) ||\n            this.getParameter(Parameters.USED_BY_URI);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * Specify a Concept Scheme or set of Concept Schemes to constrain results. By\n     * default, values are assumed to be identifiers. If using\n     * labels or uris, specify the optional second parameter\n     * to be either Parameters.SCHEMES_LABEL or Parameters.SCHEMES_URI\n     * respectively.\n     * @param schemes - schemes to constrain by\n     * @param parameter - optional, to indicate the parameter to use\n     * @return Query\n     */\n    schemes(schemes:string|string[], parameter?:string) : Query {\n        this.setSchemes(schemes, parameter);\n        return this;\n    }\n\n    /**\n     * Specify a Concept Scheme or set of Concept Schemes to constrain results. By\n     * default, values are assumed to be theme identifiers. If using\n     * theme labels or theme uris, specify the optional second parameter\n     * to be either Parameters.SCHEMES_LABEL or Parameters.SCHEMES_URI\n     * respectively.\n     * @param schemes - schemes to constrain by\n     * @param parameter - optional, to indicate the parameter to use\n     */\n    setSchemes (schemes:string|string[], parameter?:string) {\n\n        //clear existing\n        this.setParameter(Parameters.SCHEMES_ID, null);\n        this.setParameter(Parameters.SCHEMES_LABEL, null);\n        this.setParameter(Parameters.SCHEMES_URI, null);\n\n        let param = parameter || Parameters.SCHEMES_ID;\n        this.setParameter(param, toArray(schemes));\n    }\n\n    getSchemes() : string[] {\n        return this.getParameter(Parameters.SCHEMES_ID) ||\n            this.getParameter(Parameters.SCHEMES_LABEL) ||\n            this.getParameter(Parameters.SCHEMES_URI);\n    }\n\n\n    // -----------------------------------------------------------\n\n    /**\n     *\n     */\n    serviceTypes(types:string|string[]) : Query {\n        this.setServiceTypes(types);\n        return this;\n    }\n\n    /**\n     * @param types - ids\n     */\n    setServiceTypes (types:string|string[]) {\n        this.setParameter(Parameters.SERVICE_TYPES, toArray(types));\n    }\n\n    getServiceTypes () : string[] {\n        return this.getParameter(Parameters.SERVICE_TYPES);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    visibility(vis:\"public\"|\"private\") : Query {\n        this.setVisibility(vis);\n        return this;\n    }\n\n    /**\n     * @param visibility - one of 'public' or 'private'\n     */\n    setVisibility (visibility : \"public\"|\"private\") {\n        this.setParameter(Parameters.VISIBILITY, visibility);\n    }\n\n    getVisibility () : any {\n        return this.getParameter(Parameters.VISIBILITY);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    status(value : string) : Query {\n        this.setStatus(value);\n        return this;\n    }\n\n    /**\n     * @param status - current status of Item\n     */\n    setStatus (value : string) {\n        this.setParameter(Parameters.STATUS, value);\n    }\n\n    getStatus () : any {\n        return this.getParameter(Parameters.STATUS);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    extent(bbox : any) : Query {\n        this.setExtent(bbox);\n        return this;\n    }\n\n    /**\n     * @param bbox - string form of \"minx,miny,maxx,maxy\", or L.LatLngBounds, or Array\n     */\n    setExtent (bbox : any) {\n        if(bbox) {\n            if(typeof(bbox.toBboxString) !== 'undefined') {\n                //Leaflet Bounds instance\n                bbox = bbox.toBboxString();\n\n            } else if(typeof(bbox.push) !== 'undefined' && bbox.length &&\n                //Nested array (alternate Leaflet representation):\n                // [ [minLat,minLong], [maxLat,maxLong] ]\n                typeof(bbox[0].push) !== 'undefined') {\n                bbox = bbox[0][1]+','+bbox[0][0]+','+bbox[1][1]+','+bbox[1][0];\n\n            } else if(typeof(bbox) === 'string') {\n                if(!BBOX_REGEX.test(bbox)) {\n                    throw new Error(\"Invalid argument: bbox string must be \" +\n                        \"in form of 'minx,miny,maxx,maxy'\");\n                }\n            } else {\n                throw new Error(\"Invalid argument: bbox must be one of \" +\n                    \"Leaflet.Bounds, nested array, or bbox string\");\n            }\n        }\n        this.setParameter(Parameters.EXTENT, bbox);\n    }\n\n    /**\n     * @return bbox string or null if not set\n     */\n    getExtent () : any {\n        return this.getParameter(Parameters.EXTENT);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * Ex.\n     *  const { KGClassifiers, Query } from 'geoplatform.client';\n     *  let purposeId = '...';\n     *  let query = new Query();\n     *  query.classifier( KGClassifiers.PURPOSE, purposeId );\n     *\n     * @param classifier - string name of classifier to use\n     * @param value - id or array of ids of concepts to use\n     * @return Query\n     */\n    classifier(classifier : string, value : string|string[]) : Query {\n        this.setClassifier(classifier, value);\n        return this;\n    }\n\n    /**\n     * Ex.\n     *  const { KGClassifiers, Query } from 'geoplatform.client';\n     *  let purposeId = '...';\n     *  let query = new Query();\n     *  query.setClassifier( KGClassifiers.PURPOSE, purposeId );\n     *\n     * @param classifier - string name of classifier to use\n     * @param value - id or array of ids of concepts to use\n     */\n    setClassifier(classifier : string, value : string|string[]) {\n        let classifiers = this.getParameter(Parameters.CLASSIFIERS) || {};\n        classifiers[classifier] = toArray(value);\n        this.setParameter(Parameters.CLASSIFIERS, classifiers);\n    }\n\n    /**\n     * @param classifier - name of classifier constraint in use\n     * @return array of concept ids\n     */\n    getClassifier(classifier : string) : string[] {\n        let classifiers = this.getParameter(Parameters.CLASSIFIERS) || {};\n        return classifiers[classifier] || [];\n    }\n\n    /**\n     * Ex.\n     *  const { KGClassifiers, Query } from 'geoplatform.client';\n     *  let purposeId = '...',\n     *      functionIds = ['...','...'];\n     *  let query = new Query();\n     *  query.classifiers({\n     *       KGClassifiers.PURPOSE: purposeId,\n     *       KGClassifiers.FUNCTION: functionIds\n     *  });\n     *\n     * @param value - object defining classifiers\n     * @return Query instance\n     */\n    classifiers(value : any) : Query {\n        this.setClassifiers(value);\n        return this;\n    }\n\n    /**\n     * @param value - object defining classifiers\n     */\n    setClassifiers (value : any) {\n        if(!value || typeof(value) !== 'object' || Array.isArray(value)) {\n            this.setParameter(Parameters.CLASSIFIERS, null);\n            return;\n        }\n        const classes = Object.keys(Classifiers).map(k=>Classifiers[k]);\n        let classifiers = this.getParameter(Parameters.CLASSIFIERS) || {};\n        Object.keys(value).forEach( classifier => {\n            if(~classes.indexOf(classifier)) {\n                classifiers[classifier] = toArray(value[classifier]);\n            }\n        });\n        this.setParameter(Parameters.CLASSIFIERS, classifiers);\n    }\n\n    /**\n     * @return classifiers used in the query\n     */\n    getClassifiers () : any {\n        return this.getParameter(Parameters.CLASSIFIERS) || null;\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    modified(date : number|Date, beforeOrAfter : boolean) : Query {\n        this.setModified(date, beforeOrAfter);\n        return this;\n    }\n\n    /**\n     * @param date - date to compare against\n     * @param beforeOrAfter - flag specifying which boundary condition (true = before, false = after) flag specifying whether to trigger update automatically\n     */\n    setModified (date : number|Date, beforeOrAfter:boolean) {\n\n        //if no date was supplied, consider it \"unset\" for both properties\n        if(!date) {\n            this.setParameter(Parameters.MODIFIED_BEFORE, null);\n            this.setParameter(Parameters.MODIFIED_AFTER, null);\n            return;\n        }\n\n        if(!(date instanceof Date))\n            date = new Date(date as number);\n\n        let dir = beforeOrAfter && (beforeOrAfter === true || beforeOrAfter === \"true\");\n        let prop = dir ? Parameters.MODIFIED_BEFORE : Parameters.MODIFIED_AFTER;       //property being set\n        let oppProp = dir ? Parameters.MODIFIED_AFTER : Parameters.MODIFIED_BEFORE;    //unset opposite property\n        let arg = (date && date.getTime) ? date.getTime() : date;\n\n        this.setParameter(oppProp, null);\n        this.setParameter(prop, arg);\n    }\n\n    getModified () : Date {\n        let value = this.getParameter(Parameters.MODIFIED_BEFORE) ||\n            this.getParameter(Parameters.MODIFIED_AFTER);\n        if(value && typeof(value) === 'number') {\n            value = new Date(value);\n        }\n        return value;\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    created(date : number|Date, beforeOrAfter:boolean) : Query {\n        this.setCreated(date, beforeOrAfter);\n        return this;\n    }\n\n    /**\n     * @param date - date to compare against\n     * @param beforeOrAfter - flag specifying which boundary condition (true = before, false = after) flag specifying whether to trigger update automatically\n     */\n    setCreated (date : number|Date, beforeOrAfter:boolean) {\n\n        //if no date was supplied, consider it \"unset\" for both properties\n        if(!date) {\n            this.setParameter(Parameters.CREATED_BEFORE, null);\n            this.setParameter(Parameters.CREATED_AFTER, null);\n            return;\n        }\n\n        if(!(date instanceof Date))\n            date = new Date(date as number);\n\n        let dir = beforeOrAfter && (beforeOrAfter === true || beforeOrAfter === \"true\");\n        let prop = dir ? Parameters.CREATED_BEFORE : Parameters.CREATED_AFTER;       //property being set\n        let oppProp = dir ? Parameters.CREATED_AFTER : Parameters.CREATED_BEFORE;    //unset opposite property\n        let arg = (date && date.getTime) ? date.getTime() : date;\n\n        this.setParameter(oppProp, null);\n        this.setParameter(prop, arg);\n    }\n\n    getCreated () : Date {\n        let value = this.getParameter(Parameters.CREATED_BEFORE) ||\n            this.getParameter(Parameters.CREATED_AFTER);\n        if(value && typeof(value) === 'number') {\n            value = new Date(value);\n        }\n        return value;\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    begins(date : number|Date) : Query {\n        this.setBeginDate(date);\n        return this;\n    }\n\n    setBeginDate (date : number|Date) {\n        if(date && date instanceof Date)\n            date = date.getTime();\n        this.setParameter(Parameters.BEGINS, date);\n    }\n\n    getBeginDate () : Date {\n        let date = this.getParameter(Parameters.BEGINS);\n        if(date) date = new Date(date);\n        return date;\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    ends(date : number|Date) : Query {\n        this.setEndDate(date);\n        return this;\n    }\n\n    setEndDate (date: number|Date) {\n        if(date && date instanceof Date)\n            date = date.getTime();\n        this.setParameter(Parameters.ENDS, date);\n    }\n\n    getEndDate () : Date {\n        let date = this.getParameter(Parameters.ENDS);\n        if(date) date = new Date(date);\n        return date;\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    between(begin : number|Date, end : number|Date) : Query {\n        this.setBetween(begin, end);\n        return this;\n    }\n\n    setBetween(begin : number|Date, end : number|Date) {\n        this.begins(begin);\n        this.ends(end);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    resourceTypes(types: string|string[]) : Query {\n        this.setResourceTypes(types);\n        return this;\n    }\n\n    setResourceTypes(types: string|string[]) {\n        this.setParameter(Parameters.RESOURCE_TYPE, toArray(types));\n    }\n\n    getResourceTypes() : string[] {\n        return this.getParameter(Parameters.RESOURCE_TYPE);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    facets(names : string|string[]) : Query {\n        this.setFacets(names);\n        return this;\n    }\n\n    /*\n     * @param names - names of facets\n     */\n    setFacets (names: string|string[]) {\n        this.setParameter(Parameters.FACETS, toArray(names));\n    }\n\n    getFacets() : string[] {\n        return this.getParameter(Parameters.FACETS);\n    }\n\n    /**\n     * @param name - name of facet to add\n     */\n    addFacet(name: string) {\n        let facets = this.getFacets() || [];\n        facets.push(name);\n        this.setFacets(facets);\n    }\n\n    /**\n     * @param name - name of facet to remove\n     */\n    removeFacet(name: string) {\n        let facets = this.getFacets() || [];\n        let idx = facets.indexOf(name);\n        if(idx>=0) {\n            facets.splice(idx, 1);\n            this.setFacets(facets);\n        }\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    fields(fields: string|string[]) : Query {\n        this.setFields(fields);\n        return this;\n    }\n\n    /**\n     * @param fields - list of field names to request for each search result\n     */\n    setFields (fields: string|string[]) {\n        this.setParameter(Parameters.FIELDS, toArray(fields));\n    }\n\n    getFields() : string[] {\n        return this.getParameter(Parameters.FIELDS);\n    }\n\n    /**\n     * @param field - name of field to remove\n     */\n    addField(field: string) {\n        let fields = this.getFields() || [];\n        fields.push(field);\n        this.setFields(fields);\n    }\n\n    /**\n     * @param field - name of field to remove\n     */\n    removeField(field: string) {\n        let fields = this.getFields() || [];\n        let idx = fields.indexOf(field);\n        if(idx>=0) {\n            fields.splice(idx, 1);\n            this.setFields(fields);\n        }\n    }\n\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * @param page - page of results to fetch\n     */\n    page (page: number) : Query {\n        this.setPage(page);\n        return this;\n    }\n\n    setPage(page: number) {\n        if(isNaN(page) || page*1<0) return;\n        this.setParameter(Parameters.PAGE, page*1);\n    }\n\n    getPage() : number {\n        return this.getParameter(Parameters.PAGE);\n    }\n\n    nextPage() : void {\n        this.setPage(this.getPage()+1);\n    }\n\n    previousPage() : void {\n        this.setPage(this.getPage()-1);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * @param size - page size to request\n     */\n    pageSize (size: number) : Query {\n        this.setPageSize(size);\n        return this;\n    }\n\n    setPageSize (size: number) {\n        if(isNaN(size) || size*1<0) return;\n        this.setParameter(Parameters.PAGE_SIZE, size*1);\n    }\n\n    getPageSize() : number {\n        return this.getParameter(Parameters.PAGE_SIZE);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * @param sort - form of <field>,<dir> or just field name\n     * @param order - optional, either 'asc' or 'desc'\n     */\n    sort (sort: string, order?:string) : Query {\n        this.setSort(sort, order);\n        return this;\n    }\n\n    /**\n     * @param sort - form of <field>,<dir> or just field name\n     * @param order - optional, either 'asc' or 'desc'\n     */\n     setSort(sort: string, order?:string) {\n         order = order || 'desc';\n         if(sort && sort.indexOf(',')<0)\n            sort = sort + ',' + order;\n         this.setParameter(Parameters.SORT, sort);\n    }\n\n    getSort() : string {\n        return this.getParameter(Parameters.SORT);\n    }\n\n    getSortField() : string | null {\n        let value = this.getSort();\n        return value && value.length ? value.split(',')[0] : null;\n    }\n\n    getSortOrder() : string | null {\n        let value = this.getSort();\n        return value && value.length ? value.split(',')[1] : null;\n    }\n\n    /**\n     * @return list of key-value pairs of sort options\n     */\n    getSortOptions() : { value: string; label: string; }[] {\n        return SORT_OPTIONS_DEFAULT.slice(0);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     *\n     */\n    clear () {\n        this.query = JSON.parse(JSON.stringify(this.defaultQuery));\n    }\n}\n\nexport {\n    Query as default,\n    Query,\n    Fields,\n    Facets\n};\n","\nvar Config : { [key:string] : any } = {\n\n    ualUrl: 'https://ual.geoplatform.gov',\n    //appId: '...',\n\n    configure: function(options : any) {\n        Object.assign(this, options);\n    }\n};\n\nexport default Config;\n","\n\nimport * as Q from 'q';\n\n\nclass GPHttpClient {\n\n    protected token : any;\n    protected timeout : number = 5000;\n\n    /**\n     * @param options.timeout\n     * @param options.token - the bearer token or a function to retrieve it\n     */\n    constructor(options ?: { [key:string] : any }) {\n        options = options || {};\n        this.setTimeout(options.timeout||30000);\n        this.setAuthToken(options.token);\n    }\n\n    setTimeout(timeout : number) {\n        this.timeout = timeout;\n    }\n\n    /**\n     * @param arg - specify the bearer token or a function to retrieve it\n     */\n    setAuthToken(arg : string|Function) {\n        if(arg && typeof(arg) === 'string')\n            this.token = function() { return arg; };\n        else if(arg && typeof(arg) === 'function')\n            this.token = arg;\n        //else do nothing\n    }\n\n    createRequestOpts(\n        // @ts-ignore\n        options : { [key:string] : any }\n    ) : any {\n        throw new Error(\"Must implement 'createRequestOpts' in a sub-class\");\n    }\n\n    execute(\n        // @ts-ignore\n        opts : any\n    ) : Q.Promise<any> {\n        return Q.reject(new Error(\"Must overrdie 'execute' in a sub-class\"));\n    }\n\n}\n\nexport default GPHttpClient;\n","\nimport * as Q from 'q';\nimport axios from 'axios';\nimport GPError from '../shared/error';\nimport GPHttpClient from './client';\n\n\nclass XHRHttpClient extends GPHttpClient {\n\n    /**\n     * @param options.timeout\n     * @param options.token - the bearer token or a function to retrieve it\n     */\n    constructor(options ?: { [key:string] : any }) {\n        super(options);\n    }\n\n\n    createRequestOpts(options : { [key:string] : any }) : any {\n\n        let opts : { [key:string] : any } = {\n            method: options.method,\n            url: options.url,\n            timeout: options.timeout || this.timeout\n        };\n\n        if(options.json === true)\n            opts.responseType = 'json';\n\n        if(options.params) {\n            opts.params = options.params;\n        }\n\n        if(options.data) {\n            opts.data = options.data;\n            opts.contentType = 'application/json';\n        }\n\n        //set authorization header if one was provided\n        if(this.token) {\n            let token = this.token();\n            if(token) {\n                opts.headers = opts.headers || {};\n                opts.headers.Authorization = 'Bearer ' + token;\n                opts.withCredentials = true;\n            }\n        }\n\n        //copy over user-supplied options\n        if(options.options) {\n            for(let o in options.options) {\n                if(options.options.hasOwnProperty(o)) {\n                    opts[o] = options.options[o];\n                }\n            }\n        }\n\n        return opts;\n    }\n\n\n    execute(opts : any) : Q.Promise<any> {\n\n        if(typeof(axios) === 'undefined') {\n            throw new Error(\"Axios not found, check that you have included \" +\n                \"it as a dependency of the application or use a different \" +\n                \"HttpClient implementation\")\n        }\n\n        let promise = axios(opts)\n        .then( response => { return response.data; })\n        .catch( error => {\n            let err : GPError = new GPError(error.message);\n            if (error.response) {\n                err = new GPError(error.response.data);\n            }\n            return Q.reject(err);\n        });\n        return Q.resolve(promise);\n    }\n\n}\n\nexport default XHRHttpClient;\n","\nimport * as Q from 'q';\nimport { Item, SearchResults } from '../shared/models';\nimport Query from '../shared/query';\nimport GPHttpClient from '../http/client';\n\n/**\n * ItemService\n * service for working with the GeoPlatform API to\n * retrieve and manipulate items.\n *\n * Ex Searching Items\n *      let params = { q: 'test' };\n *      itemService.search(params).then(response=>{\n *          console.log(response.results.length + \" of \" + response.totalResults);\n *      }).catch(e=>{...});\n *\n * Ex Fetch Item:\n *      itemService.get(itemId).then(item=>{...}).catch(e=>{...});\n *\n * Ex Saving Item:\n *      itemService.save(item).then(item=>{...}).catch(e=>{...});\n *\n * Ex Deleting Item:\n *      itemService.remove(itemId).then(()=>{...}).catch(e=>{...});\n *\n * Ex Patching Item:\n *      itemService.patch(itemId,patch).then(item=>{...}).catch(e=>{...});\n *\n */\nclass ItemService {\n\n    protected apiBase ?: string;\n    protected baseUrl ?: string;\n    protected client : GPHttpClient;\n    protected _timeout : number = 30000;\n    protected logger : any;\n    protected httpMethods : string[] = [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"];\n\n    constructor(url : string, httpClient : GPHttpClient) {\n        this.setUrl(url);\n        this.client = httpClient;\n    }\n\n    setUrl(baseUrl : string) {\n        this.apiBase = baseUrl;\n        this.baseUrl = baseUrl + '/api/items';\n    }\n\n    /**\n     * @param milliseconds - override environment variable timeout\n     */\n    setTimeout(milliseconds : number) {\n        this._timeout = milliseconds;\n    }\n\n    /**\n     * @param milliseconds - override environment variable timeout\n     */\n    timeout(milliseconds : number) : ItemService {\n        this.setTimeout(milliseconds);\n        return this;\n    }\n\n    /**\n     * @param logger - log service\n     */\n    setLogger(logger : any) {\n        this.logger = logger;\n    }\n\n    /**\n     * @param e - error to log (if logger specified)\n     */\n    logError(e : string|Error) {\n        if(this.logger && this.logger.error) {\n            this.logger.error(e);\n        }\n    }\n\n    /**\n     * @param msg - message to log as debug\n     */\n    logDebug(msg : string) {\n        if(this.logger && this.logger.debug) {\n            this.logger.debug(msg);\n        }\n    }\n\n\n\n\n    /**\n     * @param id - identifier of item to fetch\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving Item object or an error\n     */\n    get (id : string, options ?: any) : Q.Promise<Item> {\n\n        let url = this.baseUrl + '/' + id;\n        if(options && options.version) {\n            url += '/versions/' + options.version;\n            // this.logDebug(\"Client.get requesting version: \" + options.version);\n        }\n        return Q.resolve( url )\n        .then( url => {\n            let opts = this.buildRequest({ method:\"GET\", url:url, options:options });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error fetching item ${id}: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ItemService.get() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n    /**\n     * @param itemObj - item to create or update\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving Item object or an error\n     */\n    save (itemObj : Item, options ?: any) : Q.Promise<Item> {\n\n        return Q.resolve( itemObj )\n        .then( item => {\n\n            let method = 'POST',\n                url = this.baseUrl;\n            if(item.id) {\n                method = \"PUT\";\n                url += '/' + item.id;\n            } else {\n                //if item is being created and has no URI already defined\n                // attempt to create one using the API's method for doing so\n                // and then attempt the actual item creation\n                if(!item.uri) {\n                    return this.getUri(item, options)\n                    .then( uri => {\n                        item.uri = uri;\n                        let opts = this.buildRequest({method:method, url:url, data:item, options:options});\n                        return this.execute(opts);\n                    });\n                }\n            }\n\n            let opts = this.buildRequest({method:method, url:url, data:item, options:options});\n            return this.execute(opts);\n\n        })\n        .catch(e => {\n            let err = new Error(`Error saving item: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ItemService.save() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n    /**\n     * @param id - identifier of item to delete\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving true if successful or an error\n     */\n    remove (id : string, options ?: any) : Q.Promise<boolean> {\n\n        return Q.resolve( this.baseUrl + '/' + id )\n        .then( url => {\n            let opts = this.buildRequest({\n                method:\"DELETE\", url: url, options: options\n            });\n            return this.execute(opts);\n        })\n        .then( () => true)\n        .catch(e => {\n            let err = new Error(`Error deleting item ${id}: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ItemService.remove() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n    /**\n     * @param id - identifier of item to patch\n     * @param patch - HTTP-PATCH compliant set of properties to patch\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving Item object or an error\n     */\n    patch (id : string, patch : any, options ?: any) : Q.Promise<Item> {\n\n        return Q.resolve( this.baseUrl + '/' + id )\n        .then( url => {\n            let opts = this.buildRequest({\n                method: \"PATCH\", url: url, data: patch, options: options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error patching item ${id}: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ItemService.patch() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n\n    /**\n     * @param id - identifier of item to clone\n     * @param overrides - KVP of property-value overrides to apply to cloned instance\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving clone of Item or an error\n     */\n    clone (id : string, overrides : any, options ?: any) : Q.Promise<Item> {\n\n        return Q.resolve( this.baseUrl + '/' + id + '/clone' )\n        .then( url => {\n            let opts = this.buildRequest({\n                method: \"POST\", url: url, data: overrides, options: options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error cloning item ${id}: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ItemService.clone() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n    /**\n     * @param arg - either JS object of query parameters or GeoPlatform.Query instance\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving search results\n     */\n    search (arg ?: Query, options ?: any) : Q.Promise<SearchResults> {\n\n        return Q.resolve( arg )\n        .then( params => {\n            let ps = params ? params.getQuery() : {};\n            let opts = this.buildRequest({\n                method:\"GET\", url: this.baseUrl, params: ps, options: options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error searching items: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ItemService.search() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n\n    /**\n     *\n     * @param arg - URL to metadata document or File to upload\n     * @param format - metadata format of specified document\n     * @return Promise resolving GeoPlatform Item\n     */\n    import (arg : any, format : string, options ?: any) : Q.Promise<Item> {\n\n        return Q.resolve( true )\n        .then( () => {\n            if(arg===null || arg === undefined) {\n                throw new Error(\"Must provide a valid URL or File\");\n            }\n            let isFile = typeof(arg) !== 'string';\n            let ro : { [key:string]:any } = {\n                method:\"POST\",\n                url: this.apiBase + '/api/import',\n                processData: true,  //for jQuery\n                formData: true,     //for Node (RequestJS)\n                options: options\n            };\n            if(isFile) {\n                ro.file = arg;\n                ro.data = { format: format };\n            } else {\n                ro.formData = false;    //must be false for data to not be multi-part formdata\n                ro.data = { url: arg, format: format };\n            }\n            if(options && options.overwrite) {\n                ro.data.overwrite = (!!options.overwrite)+'';\n                delete options.overwrite;\n            }\n            let opts = this.buildRequest(ro);\n            return this.execute(opts);\n        })\n        .catch( e => {\n            let err = new Error(`Error importing item: ${e.message}`);\n            Object.assign(err, e);\n            if(e.status === 409 || ~e.message.indexOf('Item already exists'))\n                Object.assign(err, {status: 409});\n            if(e.item)\n                Object.assign(err, { item : e.item });\n            this.logError('ItemService.import() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n\n\n    /**\n     * @param id - identifier of the item to export\n     * @param format - string mime type to export\n     * @return Promise resolving HTTP response object for enabling attachment downloading\n     */\n    export (id : string, format : string, options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( true )\n        .then( () => {\n            let url = this.baseUrl + '/' + id + '/export';\n            let opts = this.buildRequest({\n                method: \"GET\", url: url,\n                params: {format:format},\n                json: false,\n                options: options\n            });\n            return this.execute(opts);\n        })\n        .catch( e => {\n            let msg = e.message;\n            //https://github.com/GeoPlatform/client-api/issues/1\n            if(e.statusCode && e.statusCode===406 || e.statusCode==='406') {\n                msg = `Unsupported export format specified '${format}'`;\n            }\n            let err = new Error(`Error exporting item: ${msg}`);\n            Object.assign(err, e);\n            this.logError('ItemService.export() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n\n    /**\n     * @param object - GP object definition to generate a URI for\n     * @param options - optional request options\n     * @return Promise resolving string URI\n     */\n    getUri (object : any, options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( object )\n        .then( obj => {\n            if(!obj || !obj.type)\n                throw new Error(\"Must provide an object with a type property\");\n            let url = this.apiBase + '/api/utils/uri';\n            options = options || {};\n            options.responseType = 'text';  //to ensure plaintext is expected\n            let opts = this.buildRequest({\n                method: \"POST\", url: url, data: obj, options: options\n            });\n            return this.execute(opts);\n        })\n        .catch( e => {\n            let err = new Error(`Error getting URI for item: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ItemService.getUri() - ' + err.message);\n            return Q.reject(err);\n        });\n\n    }\n\n\n    /**\n     * @param ids - list of identifiers to fetch objects for\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving list of matching items or an error\n     */\n    getMultiple (ids : string[], options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( ids )\n        .then( identifiers => {\n\n            let method = 'POST',\n                url = this.apiBase + '/api/fetch';\n\n            let opts = this.buildRequest({method:method, url:url, data:identifiers, options:options});\n            return this.execute(opts);\n\n        })\n        .catch(e => {\n            let err = new Error(`Error fetching items: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ItemService.getMultiple() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n\n    /**\n     * @param uris - list of URIs to retrieve objects for\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving list containing uri-item association where exists\n     */\n    exists(uris : string[], options ?: any) : Q.Promise<any> {\n        return Q.resolve(uris)\n        .then( uris => {\n            let method = 'POST', url = this.apiBase + '/api/utils/exists';\n            let opts = this.buildRequest({method:method, url:url, data:uris, options:options});\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error resolving items: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ItemService.exists() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n\n    like(item : any, options ?: any) : Q.Promise<any> {\n        return Q.resolve(item.id)\n        .then( id => {\n            let method = 'PUT', url = this.apiBase + '/api/items/' + id + '/likes';\n            let opts = this.buildRequest({method:method, url:url, options:options});\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error liking item ${item.id}: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ItemService.like() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n    view(item : any, options ?: any) : Q.Promise<any> {\n        return Q.resolve(item.id)\n        .then( id => {\n            let method = 'PUT', url = this.apiBase + '/api/items/' + id + '/views';\n            let opts = this.buildRequest({method:method, url:url, options:options});\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error incrementing views for item ${item.id}: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ItemService.like() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n\n    /**\n     * @param id - identifier of item to fetch associations for\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving array of associated items of the item in question\n     */\n    associations (id : string, params : any, options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( id )\n        .then( id => {\n            let url = this.baseUrl + '/' + id + '/associations';\n            let opts = this.buildRequest({\n                method:\"GET\",\n                url:url,\n                params: params || {},\n                options: options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error fetching associations for item ${id}: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ItemService.associations() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n    /**\n     * @param id - identifier of item to fetch version info for\n     * @param params - optional set of query parameters to constrain list of versions\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving array of available versions of the item\n     */\n    versions (id : string, params ?: any, options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( id )\n        .then( id => {\n            let url = this.baseUrl + '/' + id + '/versions';\n            let opts = this.buildRequest({\n                method:\"GET\", url:url, params: params, options:options \n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error fetching versions for item ${id}: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ItemService.versions() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n\n\n    /* ----------------------------------------------------------- */\n\n    /**\n     * @param method - one of \"GET\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"\n     * @param url - destination of xhr request\n     * @param params - object to be sent with request as query parameters\n     * @param data - object to be sent with request as body\n     * @param options - optional object defining request options\n     * @return request options for xhr\n     */\n    buildRequest (options : {[key:string]:any}) : {[key:string]:any} {\n\n        if(this.httpMethods.indexOf(options.method)<0)\n            throw new Error(`Unsupported HTTP method ${options.method}`);\n\n        if(!options.url)\n            throw new Error(`Must specify a URL for HTTP requests`);\n\n        options.timeout = this._timeout || 30000;\n        let opts = this.createRequestOpts(options);\n        return opts;\n    }\n\n    createRequestOpts(options : {[key:string]:any}) : {[key:string]:any} {\n        let request = this.client.createRequestOpts(options);\n        this.logDebug(\"ItemService.createRequestOpts() - \" + JSON.stringify(request));\n        return request;\n    }\n\n    execute(opts : {[key:string]:any} ) : Q.Promise<any> {\n        return this.client.execute(opts)\n        .catch(e => {\n            if(e === null || typeof(e) === 'undefined') {\n                e = new Error(\"ItemService.execute() - Request failed but didn't return an \" +\n                \"error. This is most likely because the request timed out\");\n            }\n            return Q.reject(e);\n        });\n    }\n\n}\n\nexport default ItemService;\n","\nimport ItemService from './item';\nimport GPHttpClient from '../http/client';\n\n/**\n * GeoPlatform Map service\n * service for working with the GeoPlatform API to\n * retrieve and manipulate map objects.\n *\n * @see GeoPlatform.ItemService\n */\n\nclass DatasetService extends ItemService {\n\n    constructor(url : string, httpClient : GPHttpClient) {\n        super(url, httpClient);\n    }\n\n    setUrl(baseUrl : string) {\n        super.setUrl(baseUrl);\n        this.baseUrl = baseUrl + '/api/datasets';\n    }\n\n}\n\nexport default DatasetService;\n","\n\nimport ItemService from './item';\nimport GPHttpClient from '../http/client';\n\n/**\n * GeoPlatform Map service\n * service for working with the GeoPlatform API to\n * retrieve and manipulate map objects.\n *\n * @see GeoPlatform.ItemService\n */\n\nclass MapService extends ItemService {\n\n    constructor(url:string, httpClient:GPHttpClient) {\n        super(url, httpClient);\n    }\n\n    setUrl(baseUrl:string) {\n        super.setUrl(baseUrl);\n        this.baseUrl = baseUrl + '/api/maps';\n    }\n\n\n}\n\nexport default MapService;\n","\n\nimport * as Q from 'q';\nimport ItemService from './item';\nimport GPHttpClient from '../http/client';\n\n/**\n * GeoPlatform Map service\n * service for working with the GeoPlatform API to\n * retrieve and manipulate map objects.\n *\n * @see GeoPlatform.ItemService\n */\n\nclass LayerService extends ItemService {\n\n    constructor(url : string, httpClient : GPHttpClient) {\n        super(url, httpClient);\n    }\n\n    setUrl(baseUrl : string) {\n        super.setUrl(baseUrl);\n        this.baseUrl = baseUrl + '/api/layers';\n    }\n\n    /**\n     * @param id - GeoPlatform Layer identifier\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving style JSON object\n     */\n    style (id : string, options ?: any) : Q.Promise<any> {\n        return Q.resolve( id )\n        .then( (id) => {\n\n            let url = this.baseUrl + '/' + id + '/style';\n            let opts = this.buildRequest({\n                method:\"GET\", url:url, options:options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error fetching style: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('LayerService.style() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n    /**\n     * @param id - GeoPlatform Layer identifier\n     * @param req identifying extent, x, y\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving feature JSON object\n     */\n    describe( id : string, req : any, options ?: any ) : Q.Promise<any> {\n\n        return Q.resolve( req )\n        .then( (req) => {\n\n            if(!req) {\n                throw new Error(\"Must provide describe parameters to use\");\n            }\n\n            let keys = ['bbox', 'height', 'width', 'x', 'y'];\n            let missing = keys.find(key => !req[key]);\n            if(missing) {\n                throw new Error(`Must specify ${missing} in describe req`);\n            }\n\n            let params = {\n                srs         : 'EPSG:4326',\n                bbox        : req.bbox,\n                height      : req.height,\n                width       : req.width,\n                info_format : 'text/xml',\n                x           : req.x,\n                y           : req.y,\n                i           : req.x, //WMS 1.3.0\n                j           : req.y  //WMS 1.3.0\n            };\n\n            let url = this.baseUrl + '/' + id + '/describe';\n            let opts = this.buildRequest({\n                method:\"GET\", url:url, params:params, options:options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error describing layer feature: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('LayerService.describe() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n    /**\n     * @param id - GeoPlatform Layer identifier\n     * @param params describing layer request to validate\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving empty if successful or a message if failed\n     */\n    validate(id : string, params : any, options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( params )\n        .then( params => {\n\n            if(!params) {\n                throw new Error(\"Must provide parameters to use in layer validation\");\n            }\n\n            let url = this.baseUrl + '/' + id + '/validate';\n            let opts = this.buildRequest({\n                method:\"GET\", url:url, params:params, options:options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error validating layer request: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('LayerService.describe() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n}\n\nexport default LayerService;\n","\n\nimport * as Q from 'q';\nimport ItemTypes from '../shared/types';\nimport ItemService from './item';\nimport Query from '../shared/query';\nimport GPHttpClient from '../http/client';\n\n/**\n * GeoPlatform Service service\n * service for working with the GeoPlatform API to\n * retrieve and manipulate service objects.\n *\n * @see ItemService\n */\n\nclass ServiceService extends ItemService {\n\n    constructor(url:string, httpClient:GPHttpClient) {\n        super(url, httpClient);\n    }\n\n    setUrl(baseUrl:string) {\n        super.setUrl(baseUrl);\n        this.baseUrl = baseUrl + '/api/services';\n    }\n\n\n    /**\n     * Fetch metadata from the specified GeoPlatform Service's\n     * web-accessible implementation using either GetCapabilities\n     * or ESRI documentInfo.\n     * @param service - GeoPlatform Service object\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving service metadata\n     */\n    about( service : any, options ?: any ) : Q.Promise<any> {\n\n        return Q.resolve( service )\n        .then( svc => {\n            if(!svc)\n                throw new Error(\"Must provide service to get metadata about\");\n            let opts = this.buildRequest({\n                method:'POST', url:this.baseUrl + '/about', data:svc, options:options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error describing service: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ServiceService.about() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n\n\n    /**\n     * @param options - optional set of request options to apply to request\n     * @return Promise resolving service types\n     */\n    types (options ?: any) : Q.Promise<any> {\n\n        let query = new Query()\n        .types(ItemTypes.STANDARD)\n        .resourceTypes('ServiceType')\n        .pageSize(50)\n        .getQuery();\n\n        return Q.resolve( query )\n        .then( (params) => {\n            let url = this.apiBase + '/api/items';\n            let opts = this.buildRequest({\n                method:'GET', url:url, params:params, options:options\n            });\n            return this.execute(opts);\n        })\n        .then(response => response.results)\n        .catch(e => {\n            let err = new Error(`Error fetching service types: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ServiceService.types() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n\n    /**\n     * @param service - GP Service definition\n     * @param options - optional set of request options to apply to request\n     * @return Promise resolving imported service\n     */\n    import (service : any, options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( service )\n        .then( svc => {\n            let url = this.baseUrl + '/import';\n            let opts = this.buildRequest({\n                method:'POST', url:url, data:svc, options:options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error importing service: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ServiceService.import() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n\n    /**\n     * @param id - identifier of GP service to harvest layers for\n     * @param options - optional set of request options to apply to request\n     * @return Promise resolving service layers\n     */\n    harvest (id : string, options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( id )\n        .then( id => {\n            let url = this.baseUrl + '/' + id + '/harvest';\n            let opts = this.buildRequest({\n                method:'GET', url:url, options:options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error harvesting layers from service: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ServiceService.harvest() - ' + err.message);\n            return Q.reject(err);\n        });\n\n    }\n\n    /**\n     * @param id - identifier of GP service to live test\n     * @param options - optional set of request options to apply to request\n     * @return Promise resolving service statistics\n     */\n    liveTest (id : string, options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( id )\n        .then( id => {\n            let url = this.baseUrl + '/' + id + '/test';\n            let opts = this.buildRequest({\n                method:'GET', url:url, options:options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error testing service: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ServiceService.liveTest() - '  + err.message);\n            return Q.reject(err);\n        });\n    }\n\n    /**\n     * @param id - identifier of GP service to fetch statistics about\n     * @param options - optional set of request options to apply to request\n     * @return Promise resolving service statistics\n     */\n    statistics (id : string, options ?: any) : Q.Promise<any> {\n        return Q.resolve( id )\n        .then( id => {\n            let url = this.baseUrl + '/' + id + '/statistics';\n            let opts = this.buildRequest({\n                method:'GET', url:url, options:options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error getting service statistics: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('ServiceService.statistics() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n}\n\nexport default ServiceService;\n","\nimport * as Q from 'q';\nimport ItemService from './item';\nimport GPHttpClient from '../http/client';\n\n/**\n * GeoPlatform Map service\n * service for working with the GeoPlatform API to\n * retrieve and manipulate map objects.\n *\n * @see GeoPlatform.ItemService\n */\n\nclass GalleryService extends ItemService {\n\n    constructor(url : string, httpClient : GPHttpClient) {\n        super(url, httpClient);\n    }\n\n    setUrl(baseUrl : string) {\n        super.setUrl(baseUrl);\n        this.baseUrl = baseUrl + '/api/galleries';\n    }\n\n    addItem (galleryId : string, itemObj : any, options ?: any) : Q.Promise<any> {\n        return Q.resolve( true )\n        .then( () => {\n            let url = this.baseUrl + '/' + galleryId + '/items';\n            let opts = this.buildRequest({\n                method:'POST', url:url, data: itemObj, options:options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(\"Error adding item: \" + e.message);\n            Object.assign(err, e);\n            this.logError('GalleryService.addItem() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n    removeItem( galleryId : string, itemId : any, options ?: any) : Q.Promise<any> {\n        return Q.resolve( this.baseUrl + '/' + galleryId + '/items/' + itemId )\n        .then( url => {\n            let opts = this.buildRequest({\n                method:'DELETE', url:url, options:options\n            });\n            return this.execute(opts);\n        })\n        .then( () =>true)\n        .catch(e => {\n            let err = new Error(\"Error adding item: \" + e.message);\n            Object.assign(err, e);\n            this.logError('GalleryService.addItem() - '+ err.message);\n            return Q.reject(err);\n        });\n    }\n\n}\n\nexport default GalleryService;\n","\nimport * as Q from 'q';\nimport Config from '../shared/config';\nimport GPHttpClient from '../http/client';\n\nclass UtilsService {\n\n    private baseUrl : string;\n    private client : GPHttpClient;\n    private timeout : number = 30000;\n    private logger : any;\n    private httpMethods : string[] = [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"];\n\n\n    constructor(url : string, httpClient : GPHttpClient) {\n        this.client = httpClient;\n        this.baseUrl = url;\n        this.timeout = Config.timeout || 30000;\n    }\n\n    setUrl(baseUrl : string) {\n        this.baseUrl = baseUrl;\n    }\n\n    /**\n     * @param logger - log service\n     */\n    setLogger(logger : any) {\n        this.logger = logger;\n    }\n\n    /**\n     * @param e - error to log (if logger specified)\n     */\n    logError(e : string|Error) {\n        if(this.logger && this.logger.error) {\n            this.logger.error(e);\n        }\n    }\n\n    /**\n     * @param msg - message to log as debug\n     */\n    logDebug(msg : string) {\n        if(this.logger && this.logger.debug) {\n            this.logger.debug(msg);\n        }\n    }\n\n\n    /**\n     * @param property - optional capa property to specifically request\n     * @param query - optional query parameters to include with request\n     * @param options - optional config to send with http request\n     * @return Promise resolving capabilities object\n     */\n    capabilities (property : string|null, query : any, options ?: any) : Q.Promise<any> {\n\n        let url = this.baseUrl + '/api/capabilities';\n        if(property)\n            url += '/' + property;\n\n        return Q.resolve( url )\n        .then( (url) => {\n            let opts = this.buildRequest({\n                method:\"GET\", url:url, params:query||{}, options:options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`Error getting capabilities: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('UtilsService.capabilities() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n    /**\n     * @param file\n     * @param format\n     * @param options\n     * @return Promise\n     */\n    parseFile (file : any, format : string, options ?: any) : Q.Promise<any> {\n\n        var url = this.baseUrl + '/api/utils/parse';\n\n        return Q.resolve( url )\n        .then( url => {\n\n            let opts = this.buildRequest({\n                method:\"POST\",  url:url,\n                data: { format: format },\n                file: file,\n                formData: true,   //NodeJS (RequestJS)\n                options: options\n            });\n            return this.execute(opts);\n        })\n        .then( response => response )\n        .catch(e => {\n            let err = new Error(`Error parsing file: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('UtilsService.parseFile() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n\n    /**\n     * Geolocate the specified argument to a set of candidate locations.\n     * @param value - text string to geolocate (name or lat,lng)\n     * @param options - optional config to send with http request\n     * @return Promise resolving an array of geocoded results\n     */\n    locate(value : any, options ?: any) : Q.Promise<any> {\n\n        var url = this.baseUrl + '/api/utils/gazetteer';\n        return Q.resolve(url)\n        .then( url => {\n            let opts = this.buildRequest({\n                method: 'GET',\n                url: url,\n                params: { location: value },\n                options: options\n            });\n            return this.execute(opts);\n        })\n        .then(response => response)\n        .catch(e => {\n            let err = new Error(`Error resolving location: ${e.message}`);\n            Object.assign(err, e);\n            this.logError('UtilsService.locate() - ' + err.message);\n            return Q.reject(err);\n        });\n    }\n\n\n\n\n\n\n    /* ----------------------------------------------------------- */\n\n    /**\n     * @param method - one of \"GET\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"\n     * @param url - destination of xhr request\n     * @param params - object to be sent with request as query parameters\n     * @param data - object to be sent with request as body\n     * @param options - optional object defining request options\n     * @return request options for xhr\n     */\n    buildRequest (options : {[key:string]:any}) : {[key:string]:any} {\n\n        if(this.httpMethods.indexOf(options.method)<0)\n            throw new Error(`Unsupported HTTP method ${options.method}`);\n\n        if(!options.url)\n            throw new Error(`Must specify a URL for HTTP requests`);\n\n        options.timeout = this.timeout || Config.timeout || 30000;\n\n        return this.createRequestOpts(options);\n    }\n\n    createRequestOpts(options : {[key:string]:any}) : {[key:string]:any} {\n        return this.client.createRequestOpts(options);\n    }\n\n    execute(opts : {[key:string]:any}) : Q.Promise<any> {\n        return this.client.execute(opts)\n        .catch(( e : Error ) => {\n            if(e === null || typeof(e) === 'undefined') {\n                e = new Error(\"UtilsService.execute() - Request failed but didn't return an \" +\n                \"error. This is most likely because the request timed out\");\n            }\n            return Q.reject(e);\n        });\n    }\n\n}\n\nexport default UtilsService;\n","\n\nimport * as Q from 'q';\nimport ItemTypes from '../shared/types';\nimport Config from '../shared/config';\nimport GPHttpClient from '../http/client';\n\n\nclass AgolQuery {\n\n    private _query : { [key:string]:any };\n\n    constructor() {\n        this._query = {\n            page: 0,\n            size: 10\n        };\n    }\n\n    getQuery() : { [key:string]:any } {\n        let result : { [key:string]:any } = {};\n        for(let prop in this._query) {\n            let value = this._query[prop];\n            if(value !== null && typeof(value.push) !== 'undefined') {\n                value = value.join(',');\n            }\n            result[prop] = value;\n        }\n        return result;\n    }\n\n    // ---------------------------------------\n\n    q(value : string) : AgolQuery { this.setQ(value); return this; }\n    setQ(value : string) { this._query.q = value; }\n    getQ() : string { return this._query.q; }\n\n    // ---------------------------------------\n\n    types(value : string|string[]) : AgolQuery {\n        this.setTypes(value); return this;\n    }\n    setTypes(value : string|string[]) {\n        let val : string;\n        if(value && Array.isArray(value))\n            val = (value as Array<string>).join(',');\n        else val = value as string;\n        this._query.types = val;\n    }\n    getTypes() : string[] { return this._query.types; }\n\n    // ---------------------------------------\n\n    groups(value : string|string[]) : AgolQuery {\n        this.setGroups(value); return this;\n    }\n    setGroups(value : string|string[]) {\n        let val : string;\n        if(value && Array.isArray(value))\n            val = (value as Array<string>).join(',');\n        else val = value as string;\n        this._query.groups = val;\n    }\n    getGroups() : string[] { return this._query.groups; }\n\n    // ---------------------------------------\n\n    orgs(value : string|string[]) : AgolQuery {\n        this.setOrgs(value); return this;\n    }\n    setOrgs(value : string|string[]) {\n        let val : string;\n        if(value && Array.isArray(value))\n            val = (value as Array<string>).join(',');\n        else val = value as string;\n        this._query.orgs = val;\n    }\n    getOrgs() : string[] { return this._query.orgs; }\n\n    // ---------------------------------------\n\n    extent(value : any) : AgolQuery { this.setExtent(value); return this; }\n    setExtent(value : any) { this._query.bbox = value; }\n    getExtent() : any { return this._query.bbox; }\n\n    // ---------------------------------------\n\n    /**\n     * @param sort - form of <field>,<dir> or just field name\n     * @param order - optional, either 'asc' or 'desc'\n     */\n    sort (sort : string, order : string) : AgolQuery {\n        this.setSort(sort, order); return this;\n    }\n    /**\n     * @param sort - form of <field>,<dir> or just field name\n     * @param order - optional, either 'asc' or 'desc'\n     */\n     setSort(sort : string, order : string) {\n         order = order || 'desc';\n         if(sort && sort.indexOf(',')<0)\n            sort = sort + ',' + order;\n         this._query.sort = sort;\n    }\n    getSort() : string { return this._query.sort; }\n    getSortField() : string { return this._query.sort.split(',')[0]; }\n    getSortOrder() : boolean { return this._query.sort.split(',')[1] === 'asc'; }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * @param page - page of results to fetch\n     */\n    page (page : number) : AgolQuery {\n        this.setPage(page);\n        return this;\n    }\n\n    setPage(page : number) {\n        if(isNaN(page) || page*1<0) return;\n        this._query.page = page*1;\n    }\n\n    getPage() : number {\n        return this._query.page;\n    }\n\n    nextPage() {\n        this.setPage(this._query.page+1);\n    }\n\n    previousPage() {\n        this.setPage(this._query.page-1);\n    }\n\n\n    // -----------------------------------------------------------\n\n\n    /**\n     * @param size - page size to request\n     */\n    pageSize (size : number) : AgolQuery {\n        this.setPageSize(size);\n        return this;\n    }\n\n    setPageSize (size : number) {\n        if(isNaN(size) || size*1<0) return;\n        this._query.size = size*1;\n    }\n\n    getPageSize() : number {\n        return this._query.size;\n    }\n\n}\n\n\n\n\nclass AgolService {\n\n\n    // @ts-ignore\n    private baseUrl : string;\n    private client : GPHttpClient;\n    private timeout : number = 30000;\n    private httpMethods : string[] = [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"];\n\n    constructor(url : string, httpClient : GPHttpClient) {\n        this.setUrl(url);\n        this.client = httpClient;\n        this.timeout = 30000;\n    }\n\n    setUrl(baseUrl : string) {\n        this.baseUrl = baseUrl + '/api/agol';\n    }\n\n    // -----------------------------------------------------------------------\n    // AGOL ORGS METHODS\n\n\n    /**\n     * @param id - identifier of AGOL organization to fetch\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving Item object or an error\n     */\n    getOrg (id : string, options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( id )\n        .then( id => {\n            let opts = this.buildRequest({\n                method:\"GET\", url:this.baseUrl + '/orgs/' + id, options:options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`AgolService.getOrg() - Error fetching org ${id}: ${e.message}`);\n            Object.assign(err, e);\n            return Q.reject(err);\n        });\n    }\n\n    /**\n     * @param arg - either JS object of query parameters or Query instance\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving search results\n     */\n    searchOrgs (arg : AgolQuery, options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( arg )\n        .then( params => {\n\n            let ps = params.getQuery();\n            let opts = this.buildRequest({\n                method:\"GET\",\n                url: this.baseUrl + '/orgs',\n                params: ps,\n                options: options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`AgolService.searchOrgs() - Error searching orgs: ${e.message}`);\n            Object.assign(err, e);\n            return Q.reject(err);\n        });\n    }\n\n\n\n\n    // -----------------------------------------------------------------------\n    // AGOL GROUPS METHODS\n\n\n    /**\n     * @param id - identifier of AGOL group to fetch\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving Item object or an error\n     */\n    getGroup (id : string, options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( id )\n        .then( id => {\n            let opts = this.buildRequest({\n                method:\"GET\", url:this.baseUrl + '/groups/' + id, options:options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`AgolService.getGroup() - Error fetching group ${id}: ${e.message}`);\n            Object.assign(err, e);\n            return Q.reject(err);\n        });\n    }\n\n\n    /**\n     * @param arg - either JS object of query parameters or AgolQuery instance\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving search results\n     */\n    searchGroups (arg : AgolQuery, options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( arg )\n        .then( params => {\n\n            let ps = params.getQuery();\n            let opts = this.buildRequest({\n                method:\"GET\",\n                url: this.baseUrl + '/groups',\n                params: ps,\n                options: options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`AgolService.searchGroups() - Error searching groups: ${e.message}`);\n            Object.assign(err, e);\n            return Q.reject(err);\n        });\n    }\n\n\n\n\n    // -----------------------------------------------------------------------\n    // AGOL ITEMS METHODS\n\n    /**\n     * @param id - identifier of AGOL item to fetch\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving Item object or an error\n     */\n    getItem (id : string, options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( id )\n        .then( (id : string) => {\n            let opts = this.buildRequest({\n                method:\"GET\",\n                url:this.baseUrl + '/items/' + id,\n                options:options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`AgolService.getItem() - Error fetching item ${id}: ${e.message}`);\n            Object.assign(err, e);\n            return Q.reject(err);\n        });\n    }\n\n\n    /**\n     * @param arg - either JS object of query parameters or AgolQuery instance\n     * @param options - optional set of request options to apply to xhr request\n     * @return Promise resolving search results\n     */\n    searchItems (arg : AgolQuery, options ?: any) : Q.Promise<any> {\n\n        return Q.resolve( arg )\n        .then( params => {\n\n            let ps = params.getQuery();\n            let opts = this.buildRequest({\n                method:\"GET\",\n                url: this.baseUrl + '/items',\n                params: ps,\n                options: options\n            });\n            return this.execute(opts);\n        })\n        .catch(e => {\n            let err = new Error(`AgolService.searchItems() - Error searching items: ${e.message}`);\n            Object.assign(err, e);\n            return Q.reject(err);\n        });\n    }\n\n\n\n    /* --------------------------- */\n\n    getAgolId (obj : any) : string|null {\n        if(!obj) return null;\n\n        if(!obj.type) return null;\n\n        if(ItemTypes.ORGANIZATION === obj.type || 'Group' === obj.type) {\n            return obj.id;\n        }\n\n        if(!obj.identifiers || !obj.identifiers.length) return null;\n        let ids = obj.identifiers.filter( (id:string) => ~id.indexOf('agol:'));\n        if(!ids.length) return null;\n        return ids[0].replace('agol:','');\n    }\n\n\n\n\n\n    /* ----------------------------------------------------------- */\n\n    /**\n     * @param method - one of \"GET\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"\n     * @param url - destination of xhr request\n     * @param params - object to be sent with request as query parameters\n     * @param data - object to be sent with request as body\n     * @param options - optional object defining request options\n     * @return request options for xhr\n     */\n    buildRequest (options : {[key:string]:any} ) : {[key:string]:any} {\n\n        if(this.httpMethods.indexOf(options.method)<0)\n            throw new Error(`Unsupported HTTP method ${options.method}`);\n\n        if(!options.url)\n            throw new Error(`Must specify a URL for HTTP requests`);\n\n        options.timeout = this.timeout || Config.timeout || 30000 ;\n\n        return this.createRequestOpts(options);\n    }\n\n    createRequestOpts(options : {[key:string]:any}) : {[key:string]:any} {\n        return this.client.createRequestOpts(options);\n    }\n\n    execute(opts : {[key:string]:any}) : Q.Promise<any> {\n        return this.client.execute(opts)\n        .catch(e => {\n            if(e === null || typeof(e) === 'undefined') {\n                e = new Error(\"AGOLService.execute() - Request failed but didn't return an \" +\n                \"error. This is most likely because the request timed out\");\n            }\n            return Q.reject(e);\n        });\n    }\n\n}\n\nexport {\n    AgolService as default,\n    AgolService,\n    AgolQuery\n};\n","\n\nimport ItemTypes from '../shared/types';\n\n\nconst Categories : {[key:string]:string} = {\n    UNKNOWN:         'Unknown Category',\n    DATASET:         'Dataset',\n    SERVICE:         'Service',\n    LAYER:           'Layer',\n    MAP:             'Map',\n    GALLERY:         'Gallery',\n    COMMUNITY:       'Community',\n    CONTACT:         'Contact',\n    ORGANIZATION:    'Organization',\n    CONCEPT:         'Concept',\n    CONCEPT_SCHEME:  'Concept Scheme',\n    APPLICATION:     'Application',\n    TOPIC:           'Topic',\n    WEBSITE:         'WebSite',\n    IMAGE_PRODUCT:   'Image Product',\n    RIGHTS_STATEMENT:'RightsStatement',\n    KNOWLEDGE_GRAPH: 'Knowledge Graph',\n    USER:            'User',\n    COMMUNITY_POST:  'Community Post',   //post within a community portal\n    COMMUNITY_PAGE:  'Community Page',   //page within a community portal\n    APP_PAGE:        'Application Page', //page/view within a client application\n};\n\nconst Events : {[key:string]:string} = {\n    ACCESSED:   'Accessed',  //related item was accessed using API\n    DISPLAYED:  'Displayed', //related item was displayed in a native form (map)\n    VIEWED:     'Viewed',    //related item was viewed in general form (metadata)\n    CREATED:    'Created',\n    EDITED:     'Edited',\n    DELETED:    'Deleted',\n    CLONED:     'Cloned',\n    ADDED:      'Added',    //item was added to another (ie, layer on map)\n    REMOVED:    'Removed',  //item was removed from another (ie, item from gallery)\n    EXPORTED:   'Exported',\n    IMPORTED:   'Imported'\n};\n\n\nfunction getCategory(type : string) : string {\n    let result = Categories.UNKNOWN;\n    if(type) {\n        let cats : string[] = Object.keys(Categories).map((k:string)=>Categories[k]);\n        //if existing category was specified\n        if(~cats.indexOf(type))\n            return type;\n        //if an ItemType with prefix was specified (strip off prefix)\n        else if(~type.indexOf(':')) {\n            let cat = type.split(':')[1];\n            if(~cats.indexOf(cat))\n                return cat;\n        }\n    }\n    return result;\n}\n\n\n\n/**\n *\n */\nclass Event {\n\n    private category : string;\n    private type : string;\n    private item : any = null;\n    private related : any = null;\n\n    constructor(category : string, type : string, item ?: any, related ?: any) {\n        if(!category || ! type) {\n            throw new Error(\"TrackingService Event - Must specific an event \" +\n            \"category and event type when constructing events\");\n        }\n        this.category = category;\n        this.type = type;\n        this.setItem(item);\n        this.setRelated(related);\n    }\n    getCategory() : string { return this.category; }\n    getType() : string { return this.type; }\n    getItem() : any { return this.item; }\n    setItem(item : any) { this.item = item ? (item.id || item) : null; }\n    getRelated() : any { return this.related; }\n    setRelated(related : any) {\n        this.related = related ? (related.id || related) : null;\n    }\n}\n\n\n\n/**\n * @param eventType - type of event being created\n * @param item - GeoPlatform Item instance\n * @return list of event objects\n */\nfunction TrackingEventFactory(eventType : string, item : any) : Event[] {\n    let result : Event[] = [] as Event[];\n    if(eventType && item && item.type) {\n        if(ItemTypes.MAP === item.type) {\n            result.push( new Event(Categories.MAP, eventType, item) );\n            if(Events.DISPLAYED === eventType) {\n\n                item.layers.forEach( (layerState : any) => {\n                    if(layerState.layer) {\n                        let layerEvents = TrackingEventFactory(eventType, layerState.layer)\n                            .filter(e=>e!==null);\n                        if(layerEvents && layerEvents.length) {\n                            result = result.concat(layerEvents);\n                        }\n                    }\n                });\n\n                if(item.baseLayer) {\n                    let baseEvents = TrackingEventFactory(eventType, item.baseLayer)\n                        .filter(e=>e!==null);\n                    if(baseEvents && baseEvents.length)\n                        result = result.concat( baseEvents );\n                }\n            }\n\n        } else if(ItemTypes.LAYER === item.type) {\n            result.push( new Event(Categories.LAYER, eventType, item) );\n            if(Events.DISPLAYED === eventType && item.services && item.services.length) {\n                result.push( new Event(Categories.SERVICE, eventType, item.services[0]) );\n            }\n        } else {\n            let category = getCategory(item.type);\n            result.push( new Event(category, eventType, item) );\n        }\n    }\n    // else {\n    //     if(!event) console.log(\"Missing event\");\n    //     if(!item) console.log(\"Missing item\");\n    //     if(!item.type) console.log(\"Missing item type\");\n    // }\n    return result;\n}\n\n\n\n\n\n/**\n *\n */\nclass DefaultTrackingServiceProvider {\n    constructor() {}\n    logEvent(\n        category : string,\n        event : string,\n        item ?: any,\n        // @ts-ignore\n        related ?: any\n    ) {\n        console.log( \"EVENT (\" + category + \") - \" + event + \" : \" + item);\n    }\n    // logPageView( view, data ) {\n    //     console.log(\"PAGEVIEW \" + view + (data ? \" : \" + JSON.stringify(data) : '') );\n    // }\n    logSearch(params : string, resultCount : string|number) {\n        console.log( \"Query : \" + JSON.stringify(params) + \" found \" + resultCount+ \" matches\");\n    }\n}\n\n\n\n\n\n\n/**\n * TrackingService\n *\n * Service for logging events related to usage of the GeoPlatform and its data\n *\n * Example:\n *\n *   import { TrackingService, EventCategories, EventTypes } from 'geoplatform.client';\n *\n *   let tracker = new TrackingService();\n *   tracker.setProvider( ... );\n *   tracker.event( Event.of(EventCategories.MAP, EventTypes.VIEWED, map) );\n *\n * Multi-event example:\n *\n *   import {\n *      TrackingService, TrackingEventCategories, TrackingEventTypes, TrackingEventFactory\n *   } from 'geoplatform.client';\n *\n *   let tracker = new TrackingService();\n *   tracker.setProvider( ... );\n *\n *   let events = [\n *       TrackingEvent.of( TrackingCategories.MAP, TrackingEventTypes.VIEWED, this.map )\n *       TrackingEvent.of( TrackingCategories.LAYER, TrackingEventTypes.VIEWED, this.map.baseLayer )\n *   ];\n *   tracker.event(events);\n *\n *   //OR use the event factory:\n *   tracker.event( TrackingEventFactory(EventTypes.VIEWED, this.map) );\n */\nclass TrackingService {\n\n    private provider : any = null;\n\n    constructor(options ?: any) {\n        if(options && typeof(options) === 'object')\n            Object.assign(this, options);\n\n        if(!this.provider)\n            this.setProvider(new DefaultTrackingServiceProvider());\n    }\n\n    /**\n     * @param provider -\n     */\n    setProvider(provider : any) {\n        if(provider)\n            this.provider = provider;\n    }\n\n    /**\n     * @param event - event to log\n     * @return TrackingService\n     */\n    event( event : Event ) : TrackingService {\n        this.logEvent( event );\n        return this;\n    }\n\n    /**\n     * @param event - event to log\n     */\n    logEvent( event : Event|Event[]) {\n        if(!this.provider || !this.provider.logEvent || !event) return;\n\n        if(Array.isArray(event)) {\n            let events : Event[] = event as Event[];\n            events.forEach( (evt : Event) => this.logEvent(evt) );\n\n        } else {\n            let evt : Event = event as Event;\n            try {\n                this.provider.logEvent(\n                    evt.getCategory(),\n                    evt.getType(),\n                    evt.getItem(),\n                    evt.getRelated()\n                );\n            } catch(e) {\n                console.log(\n                    \"TrackingService.logEvent() - Error logging event (\" +\n                    evt.getCategory() + \", \" + evt.getType() + \", \" +\n                    evt.getItem() + \") - \" + e.message\n                );\n            }\n        }\n    }\n\n\n    /**\n     * @param view - name of the view being activated\n     * @param data - additional context to supply for the event\n     * @return TrackingService\n     * @deprecated use svc.event( new Event(EventCategories.APP_PAGE, EventTypes.VIEWED, pageId) )\n     */\n    pageView( view : string, data : any) {\n        this.logPageView(view, data);\n        return this;\n    }\n\n    /**\n     * @param view - name of the view being activated\n     * @param data - additional context to supply for the event\n     * @deprecated use svc.logEvent( new Event(EventCategories.APP_PAGE, EventTypes.VIEWED, pageId) )\n     */\n    logPageView(\n        view : string,\n        // @ts-ignore\n        data ?: any\n    ) {\n        this.logEvent( new Event(Categories.APP_PAGE, Events.VIEWED, view) );\n        // if(this.provider && this.provider.logPageView) {\n        //     this.provider.logPageView(view, data);\n        // }\n    }\n\n    /**\n     * @param params\n     * @param resultCount\n     */\n    logSearch (params : any, resultCount : string|number) {\n        this.provider.logSearch(params, resultCount);\n    }\n\n}\n\n\nexport {\n    Event as TrackingEvent,\n    TrackingService,\n    Categories as TrackingCategories,\n    Events as TrackingTypes,\n    TrackingEventFactory\n};\n","\nimport * as Q from 'q';\nimport Config from '../shared/config';\nimport KGQuery from '../shared/kg-query';\nimport GPHttpClient from '../http/client';\n\nclass KGService {\n\n    // @ts-ignore\n    private apiBase : string;\n    // @ts-ignore\n    private baseUrl : string;\n    private client : GPHttpClient;\n    private timeout : number = 30000;\n    private httpMethods : string[] = [\"GET\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"];\n\n    constructor(url : string, httpClient : GPHttpClient) {\n        this.setUrl(url);\n        this.client = httpClient;\n    }\n\n    setUrl(baseUrl : string) {\n        this.apiBase = baseUrl;\n        this.baseUrl = baseUrl + '/api/recommender';\n    }\n\n    /**\n     * @param query - optional query parameters to include with request\n     * @param options - optional config to send with http request\n     * @return Promise resolving recommended concepts as search results\n     */\n    suggest (query : KGQuery, options ?: any) : Q.Promise<any> {\n        let url = this.baseUrl + '/suggest';\n        return this._search(url, query, options)\n        .catch(e => {\n            let err = new Error(`KGService.suggest() - Error suggesting concepts: ${e.message}`);\n            Object.assign(err, e);\n            return Q.reject(err);\n        });\n    }\n\n\n    /**\n     * @param query - optional query parameters to include with request\n     * @param options - optional config to send with http request\n     * @return Promise resolving concept types as search results\n     */\n    types (query : KGQuery, options ?: any) : Q.Promise<any> {\n        let url = this.baseUrl + '/types';\n        return this._search(url, query, options)\n        .catch(e => {\n            let err = new Error(`KGService.types() - Error searching types: ${e.message}`);\n            Object.assign(err, e);\n            return Q.reject(err);\n        });\n    }\n\n\n\n    /**\n     * @param query - optional query parameters to include with request\n     * @param options - optional config to send with http request\n     * @return Promise resolving concept sources as search results\n     */\n    sources (query : KGQuery, options ?: any) : Q.Promise<any> {\n        let url = this.baseUrl + '/sources';\n        return this._search(url, query, options)\n        .catch(e => {\n            let err = new Error(`KGService.sources() - Error searching sources: ${e.message}`);\n            Object.assign(err, e);\n            return Q.reject(err);\n        });\n    }\n\n\n\n\n\n    /* ----------------------------------------------------------- */\n\n\n    /**\n     * internal method used by exposed methods\n     */\n    _search (url : string, query : KGQuery, options ?: any) : Q.Promise<any> {\n        return Q.resolve( true )\n        .then( () => {\n            let q : { [key:string]:any } = query.getQuery();\n            let opts = this.buildRequest({\n                method:\"GET\", url:url, params:q, options:options\n            });\n            return this.execute(opts);\n        });\n    }\n\n\n\n    /**\n     * @param method - one of \"GET\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"\n     * @param url - destination of xhr request\n     * @param params - object to be sent with request as query parameters\n     * @param data - object to be sent with request as body\n     * @param options - optional object defining request options\n     * @return request options for xhr\n     */\n    buildRequest (options : {[key:string]:any}) : {[key:string]:any} {\n\n        if(this.httpMethods.indexOf(options.method)<0)\n            throw new Error(`Unsupported HTTP method ${options.method}`);\n\n        if(!options.url)\n            throw new Error(`Must specify a URL for HTTP requests`);\n\n        options.timeout = this.timeout || Config.timeout || 30000;\n\n        return this.createRequestOpts(options);\n    }\n\n    createRequestOpts(options : {[key:string]:any}) : {[key:string]:any} {\n        return this.client.createRequestOpts(options);\n    }\n\n    execute(opts : {[key:string]:any}) : Q.Promise<any> {\n        return this.client.execute(opts)\n        .catch(e => {\n            if(e === null || typeof(e) === 'undefined') {\n                e = new Error(\"KGService.execute() - Request failed but didn't return an \" +\n                \"error. This is most likely because the request timed out\");\n            }\n            return Q.reject(e);\n        });\n    }\n\n}\n\nexport default KGService;\n","\nfunction apply() {\n    if (typeof Object.assign != 'function') {\n      // Must be writable: true, enumerable: false, configurable: true\n      Object.defineProperty(Object, \"assign\", {\n        value: function assign(target : any, varArgs : any[]) { // .length of function is 2\n\n          if (target == null) { // TypeError if undefined or null\n            throw new TypeError('Cannot convert undefined or null to object');\n          }\n\n          if(varArgs) { }\n          var to = Object(target);\n\n          for (var index = 1; index < arguments.length; index++) {\n            var nextSource = arguments[index];\n\n            if (nextSource != null) { // Skip over if undefined or null\n              for (var nextKey in nextSource) {\n                // Avoid bugs when hasOwnProperty is shadowed\n                if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n                  to[nextKey] = nextSource[nextKey];\n                }\n              }\n            }\n          }\n          return to;\n        },\n        writable: true,\n        configurable: true\n      });\n    }\n}\n\n\nexport default function() {\n    apply();\n};\n","import Polyfills from \"./shared/polyfills\";\nPolyfills();\n\nimport GPError from './shared/error';\nimport { ItemTypes, ItemTypeLabels } from './shared/types';\nimport URIFactory from './shared/uri-factory';\nimport KGQuery from './shared/kg-query';\nimport KGClassifiers from './shared/classifiers';\nimport QueryParameters from './shared/parameters';\nimport {\n    Query,\n    Fields as QueryFields,\n    Facets as QueryFacets\n} from './shared/query';\nimport QueryFactory    from './shared/query-factory';\nimport Config from './shared/config';\n\nimport {\n    Item, Asset, Dataset, Service, Layer, Map, Gallery,\n    Application, Topic, WebSite,\n    Organization, Contact, ConceptScheme, SearchResults, ServiceTypeStandard\n} from \"./shared/models\";\n\nimport GPHttpClient from './http/client';\n// import JQueryHttpClient from './http/jq';\nimport XHRHttpClient from './http/xhr';\n\n\nimport ItemService from './services/item';\nimport DatasetService from './services/dataset';\nimport MapService from './services/map';\nimport LayerService from './services/layer';\nimport ServiceService from './services/service';\nimport GalleryService from './services/gallery';\nimport UtilsService from './services/utils';\nimport { AgolService, AgolQuery } from './services/agol';\n\nimport {\n    TrackingEvent,\n    TrackingService,\n    TrackingCategories,\n    TrackingTypes,\n    TrackingEventFactory\n} from './services/tracking';\n\nimport KGService from './services/kg';\nimport ServiceFactory  from './services/factory';\n\n\n\n\nexport {\n\n    //shared classes\n    GPError,\n    ItemTypes,\n    ItemTypeLabels,\n    QueryParameters,\n    QueryFacets,\n    Query,\n    QueryFactory,\n    QueryFields,\n    KGQuery,\n    KGClassifiers,\n    AgolQuery,\n    URIFactory,\n\n    //model interfaces\n    Item, Asset, Dataset, Service, Layer, Map, Gallery,\n    Application, Topic, WebSite,\n    Organization, Contact, ConceptScheme, SearchResults, ServiceTypeStandard,\n\n    Config,\n\n    GPHttpClient,\n    XHRHttpClient,\n\n\n    ItemService,\n    DatasetService,\n    MapService,\n    LayerService,\n    ServiceService,\n    GalleryService,\n    UtilsService,\n    KGService,\n    ServiceFactory,\n    AgolService,\n\n\n    TrackingEvent,\n    TrackingService,\n    TrackingCategories,\n    TrackingTypes,\n    TrackingEventFactory\n\n};\n","\nimport Query from './query';\n\nexport default function() {\n    return new Query();\n}\n","\nimport GPHttpClient from '../http/client';\nimport ItemTypes from '../shared/types';\nimport ItemService from './item';\nimport LayerService from './layer';\nimport ServiceService from './service';\nimport GalleryService from './gallery';\nimport DatasetService from './dataset';\nimport MapService from './map';\n\n/**\n * @param arg - string type or object with type property\n * @param baseUrl - base endpoint of GeoPlatform API\n * @return ItemService\n */\nconst ServiceFactory = function(arg : any, baseUrl : string, httpClient : GPHttpClient) : any {\n    let type = (typeof(arg) === 'string') ?\n        arg : (arg && arg.type ? arg.type : null);\n    if(!type) throw new Error(\"Must provide a type or object with a type specified\");\n    if(!baseUrl) throw new Error(\"Must provide a base url\");\n    if(!httpClient) throw new Error(\"Must provide an http client to use to make requests\");\n    switch(type) {\n        case ItemTypes.LAYER:   return new LayerService(  baseUrl, httpClient);\n        case ItemTypes.SERVICE: return new ServiceService(baseUrl, httpClient);\n        case ItemTypes.MAP:     return new MapService(    baseUrl, httpClient);\n        case ItemTypes.GALLERY: return new GalleryService(baseUrl, httpClient);\n        case ItemTypes.DATASET: return new DatasetService(baseUrl, httpClient);\n        default:                return new ItemService(   baseUrl, httpClient);\n    }\n};\n\nexport default ServiceFactory;\n"]}