import { Query, ItemService } from "@geoplatform/client";
import ServiceProxy from './base';
const ɵ0 = function (svc, req) {
    let query = new Query(req.query);
    return svc.search(query);
}, ɵ1 = function (svc, req) {
    return svc.get(req.params.id);
}, ɵ2 = function (svc, req) {
    return svc.save(req.body);
}, ɵ3 = function (svc, req) {
    return svc.save(req.body);
}, ɵ4 = function (svc, req) {
    return svc.remove(req.params.id);
}, ɵ5 = function (
// @ts-ignore
result, res) {
    res.status(204).end();
}, ɵ6 = function (svc, req) {
    return svc.patch(req.params.id, req.body);
}, ɵ7 = function (svc, req) { return svc.clone(req.params.id, req.body); }, ɵ8 = function (svc, req) {
    return svc.export(req.params.id, req.query.format);
}, ɵ9 = function (result, res) {
    let mimeType = result.headers['content-type'];
    let disposition = result.headers['content-disposition'];
    res.set("Content-Type", mimeType);
    res.setHeader('Content-disposition', disposition);
    res.send(result.body);
}, ɵ10 = function (svc, req) {
    return svc.getUri(req.body);
}, ɵ11 = function (result, res) {
    res.json({ uri: result });
}, ɵ12 = function (svc, req) {
    return svc.getUri(req.body)
        .then(uri => {
        let fields = ['serviceType', 'services', 'scheme', 'themes', 'publishers', 'keywords'];
        let query = new Query().uri(uri).fields(fields);
        return svc.search(query);
    });
}, ɵ13 = function (svc, req) {
    let input = req.body.url || req.files.file;
    return svc.import(input, req.query.format);
}, ɵ14 = function (svc, req) {
    return svc.associations(req.params.id, req.query);
}, ɵ15 = function (svc, req) {
    return svc.versions(req.params.id, req.query);
}, ɵ16 = function (svc, req) {
    return svc.get(req.params.id, { version: req.params.version });
};
const Routes = [
    {
        key: 'search',
        method: 'get',
        path: 'items',
        auth: false,
        onExecute: ɵ0
    },
    {
        key: 'get',
        method: 'get',
        path: 'items/:id',
        auth: false,
        onExecute: ɵ1
    },
    {
        key: 'create',
        method: 'post',
        path: 'items',
        auth: true,
        onExecute: ɵ2
    },
    {
        key: 'update',
        method: 'put',
        path: 'items/:id',
        auth: true,
        onExecute: ɵ3
    },
    {
        key: 'delete',
        method: 'delete',
        path: 'items/:id',
        auth: true,
        onExecute: ɵ4,
        onResponse: ɵ5
    },
    {
        key: 'patch',
        method: 'patch',
        path: 'items/:id',
        auth: true,
        onExecute: ɵ6
    },
    {
        key: 'clone',
        method: 'post',
        path: 'items/:id/clone',
        auth: true,
        onExecute: ɵ7
    },
    {
        key: 'export',
        method: 'get',
        path: 'items/:id/export',
        auth: false,
        onExecute: ɵ8,
        onResponse: ɵ9
    },
    {
        key: 'uri',
        method: 'post',
        path: 'items/uri',
        auth: false,
        onExecute: ɵ10,
        onResponse: ɵ11
    },
    {
        key: 'exists',
        method: 'post',
        path: 'items/exists',
        auth: false,
        onExecute: ɵ12
    },
    {
        key: 'import',
        method: 'post',
        path: 'items/import',
        auth: true,
        onExecute: ɵ13
    },
    {
        key: 'associations',
        method: 'get',
        path: 'items/:id/associations',
        auth: false,
        onExecute: ɵ14
    },
    {
        key: 'versions',
        method: 'get',
        path: 'items/:id/versions',
        auth: false,
        onExecute: ɵ15
    },
    {
        key: 'getVersion',
        method: 'get',
        path: 'items/:id/versions/:version',
        auth: false,
        onExecute: ɵ16
    }
    // TODO findMultiple
];
/**
 *
 */
function bindRoutes(router, options) {
    //bind common endpoints
    options.pathBaseDefault = "items";
    options.serviceClass = ItemService;
    ServiceProxy.bindRoutes(router, Routes, options);
}
/**
 * ItemServiceProxy
 *
 * see examples/node/item-proxy for an in-depth example
 */
function ItemServiceProxy(options) {
    if (typeof (options) === 'undefined') {
        options = {};
    }
    ;
    let router = options.router;
    if (!options.router) {
        let express = require('express');
        if (!express) {
            throw new Error("ItemServiceProxy() - Must provide" +
                "'options.router' or include express as a dependency");
        }
        router = express.Router();
    }
    if (!router)
        throw new Error("ItemServiceProxy() - " +
            "Unable to create proxy route, missing router");
    bindRoutes(router, options);
    return router;
}
export default ItemServiceProxy;
export { ɵ0, ɵ1, ɵ2, ɵ3, ɵ4, ɵ5, ɵ6, ɵ7, ɵ8, ɵ9, ɵ10, ɵ11, ɵ12, ɵ13, ɵ14, ɵ15, ɵ16 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXRlbS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BnZW9wbGF0Zm9ybS9jbGllbnQvbm9kZS8iLCJzb3VyY2VzIjpbInNlcnZpY2VzL3Byb3hpZXMvaXRlbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3pELE9BQU8sWUFBWSxNQUFNLFFBQVEsQ0FBQztXQVFmLFVBQVMsR0FBaUIsRUFBRSxHQUFTO0lBQzVDLElBQUksS0FBSyxHQUFHLElBQUksS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNqQyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDN0IsQ0FBQyxPQU9VLFVBQVMsR0FBaUIsRUFBRSxHQUFTO0lBQzVDLE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ2xDLENBQUMsT0FPVSxVQUFTLEdBQWlCLEVBQUUsR0FBUztJQUM1QyxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzlCLENBQUMsT0FPVSxVQUFTLEdBQWlCLEVBQUUsR0FBUztJQUM1QyxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzlCLENBQUMsT0FPVSxVQUFTLEdBQWlCLEVBQUUsR0FBUztJQUM1QyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUNyQyxDQUFDLE9BQ1c7QUFDUixhQUFhO0FBQ2IsTUFBWSxFQUNaLEdBQVM7SUFDVCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBQzFCLENBQUMsT0FPVSxVQUFTLEdBQWlCLEVBQUUsR0FBUztJQUM1QyxPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzlDLENBQUMsT0FPVSxVQUFTLEdBQUcsRUFBRSxHQUFHLElBQUksT0FBTyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FPakUsVUFBUyxHQUFpQixFQUFFLEdBQVM7SUFDNUMsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7QUFBQyxDQUFDLE9BQzdDLFVBQVMsTUFBWSxFQUFFLEdBQVM7SUFDeEMsSUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUM5QyxJQUFJLFdBQVcsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLHFCQUFxQixDQUFDLENBQUM7SUFDeEQsR0FBRyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDbEMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxxQkFBcUIsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUNsRCxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUMxQixDQUFDLFFBT1UsVUFBUyxHQUFpQixFQUFFLEdBQVM7SUFDNUMsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNoQyxDQUFDLFFBQ1csVUFBUyxNQUFZLEVBQUUsR0FBUztJQUN4QyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDOUIsQ0FBQyxRQU9VLFVBQVMsR0FBaUIsRUFBRSxHQUFTO0lBQzVDLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDO1NBQzFCLElBQUksQ0FBRSxHQUFHLENBQUMsRUFBRTtRQUNULElBQUksTUFBTSxHQUFHLENBQUMsYUFBYSxFQUFDLFVBQVUsRUFBQyxRQUFRLEVBQUMsUUFBUSxFQUFDLFlBQVksRUFBQyxVQUFVLENBQUMsQ0FBQztRQUNsRixJQUFJLEtBQUssR0FBVyxJQUFJLEtBQUssRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEQsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdCLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxRQU9VLFVBQVMsR0FBaUIsRUFBRSxHQUFTO0lBQzVDLElBQUksS0FBSyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO0lBQzNDLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMvQyxDQUFDLFFBT1UsVUFBUyxHQUFpQixFQUFFLEdBQVM7SUFDNUMsT0FBTyxHQUFHLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUFDLENBQUMsUUFPN0MsVUFBUyxHQUFpQixFQUFFLEdBQVM7SUFDNUMsT0FBTyxHQUFHLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUFDLENBQUMsUUFPekMsVUFBUyxHQUFpQixFQUFFLEdBQVM7SUFDNUMsT0FBTyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztBQUNuRSxDQUFDO0FBL0lULE1BQU0sTUFBTSxHQUFHO0lBQ1g7UUFDSSxHQUFHLEVBQUUsUUFBUTtRQUNiLE1BQU0sRUFBRSxLQUFLO1FBQ2IsSUFBSSxFQUFFLE9BQU87UUFDYixJQUFJLEVBQUUsS0FBSztRQUNYLFNBQVMsSUFHUjtLQUNKO0lBQ0Q7UUFDSSxHQUFHLEVBQUUsS0FBSztRQUNWLE1BQU0sRUFBRSxLQUFLO1FBQ2IsSUFBSSxFQUFFLFdBQVc7UUFDakIsSUFBSSxFQUFFLEtBQUs7UUFDWCxTQUFTLElBRVI7S0FDSjtJQUNEO1FBQ0ksR0FBRyxFQUFFLFFBQVE7UUFDYixNQUFNLEVBQUUsTUFBTTtRQUNkLElBQUksRUFBRSxPQUFPO1FBQ2IsSUFBSSxFQUFFLElBQUk7UUFDVixTQUFTLElBRVI7S0FDSjtJQUNEO1FBQ0ksR0FBRyxFQUFFLFFBQVE7UUFDYixNQUFNLEVBQUUsS0FBSztRQUNiLElBQUksRUFBRSxXQUFXO1FBQ2pCLElBQUksRUFBRSxJQUFJO1FBQ1YsU0FBUyxJQUVSO0tBQ0o7SUFDRDtRQUNJLEdBQUcsRUFBRSxRQUFRO1FBQ2IsTUFBTSxFQUFFLFFBQVE7UUFDaEIsSUFBSSxFQUFFLFdBQVc7UUFDakIsSUFBSSxFQUFFLElBQUk7UUFDVixTQUFTLElBRVI7UUFDRCxVQUFVLElBS1Q7S0FDSjtJQUNEO1FBQ0ksR0FBRyxFQUFFLE9BQU87UUFDWixNQUFNLEVBQUUsT0FBTztRQUNmLElBQUksRUFBRSxXQUFXO1FBQ2pCLElBQUksRUFBRSxJQUFJO1FBQ1YsU0FBUyxJQUVSO0tBQ0o7SUFDRDtRQUNJLEdBQUcsRUFBRSxPQUFPO1FBQ1osTUFBTSxFQUFFLE1BQU07UUFDZCxJQUFJLEVBQUUsaUJBQWlCO1FBQ3ZCLElBQUksRUFBRSxJQUFJO1FBQ1YsU0FBUyxJQUFtRTtLQUMvRTtJQUNEO1FBQ0ksR0FBRyxFQUFFLFFBQVE7UUFDYixNQUFNLEVBQUUsS0FBSztRQUNiLElBQUksRUFBRSxrQkFBa0I7UUFDeEIsSUFBSSxFQUFFLEtBQUs7UUFDWCxTQUFTLElBQ2dEO1FBQ3pELFVBQVUsSUFNVDtLQUNKO0lBQ0Q7UUFDSSxHQUFHLEVBQUUsS0FBSztRQUNWLE1BQU0sRUFBRSxNQUFNO1FBQ2QsSUFBSSxFQUFFLFdBQVc7UUFDakIsSUFBSSxFQUFFLEtBQUs7UUFDWCxTQUFTLEtBRVI7UUFDRCxVQUFVLEtBRVQ7S0FDSjtJQUNEO1FBQ0ksR0FBRyxFQUFFLFFBQVE7UUFDYixNQUFNLEVBQUUsTUFBTTtRQUNkLElBQUksRUFBRSxjQUFjO1FBQ3BCLElBQUksRUFBRSxLQUFLO1FBQ1gsU0FBUyxLQU9SO0tBQ0o7SUFDRDtRQUNJLEdBQUcsRUFBRSxRQUFRO1FBQ2IsTUFBTSxFQUFFLE1BQU07UUFDZCxJQUFJLEVBQUUsY0FBYztRQUNwQixJQUFJLEVBQUUsSUFBSTtRQUNWLFNBQVMsS0FHUjtLQUNKO0lBQ0Q7UUFDSSxHQUFHLEVBQUUsY0FBYztRQUNuQixNQUFNLEVBQUUsS0FBSztRQUNiLElBQUksRUFBRSx3QkFBd0I7UUFDOUIsSUFBSSxFQUFFLEtBQUs7UUFDWCxTQUFTLEtBQytDO0tBQzNEO0lBQ0Q7UUFDSSxHQUFHLEVBQUUsVUFBVTtRQUNmLE1BQU0sRUFBRSxLQUFLO1FBQ2IsSUFBSSxFQUFFLG9CQUFvQjtRQUMxQixJQUFJLEVBQUUsS0FBSztRQUNYLFNBQVMsS0FDMkM7S0FDdkQ7SUFDRDtRQUNJLEdBQUcsRUFBRSxZQUFZO1FBQ2pCLE1BQU0sRUFBRSxLQUFLO1FBQ2IsSUFBSSxFQUFFLDZCQUE2QjtRQUNuQyxJQUFJLEVBQUUsS0FBSztRQUNYLFNBQVMsS0FFUjtLQUNKO0lBRUQsb0JBQW9CO0NBQ3ZCLENBQUM7QUFFRjs7R0FFRztBQUNILFNBQVMsVUFBVSxDQUFDLE1BQVksRUFBRSxPQUFjO0lBQzVDLHVCQUF1QjtJQUN2QixPQUFPLENBQUMsZUFBZSxHQUFHLE9BQU8sQ0FBQztJQUNsQyxPQUFPLENBQUMsWUFBWSxHQUFHLFdBQVcsQ0FBQztJQUNuQyxZQUFZLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDckQsQ0FBQztBQUtEOzs7O0dBSUc7QUFDSCxTQUFTLGdCQUFnQixDQUFFLE9BQWM7SUFFckMsSUFBRyxPQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssV0FBVyxFQUFFO1FBQ2hDLE9BQU8sR0FBRyxFQUFFLENBQUM7S0FDaEI7SUFBQSxDQUFDO0lBRUYsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQztJQUM1QixJQUFHLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRTtRQUNoQixJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDakMsSUFBRyxDQUFDLE9BQU8sRUFBRTtZQUNULE1BQU0sSUFBSSxLQUFLLENBQUMsbUNBQW1DO2dCQUMvQyxxREFBcUQsQ0FBQyxDQUFDO1NBQzlEO1FBQ0QsTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztLQUM3QjtJQUVELElBQUcsQ0FBQyxNQUFNO1FBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUI7WUFDL0MsOENBQThDLENBQUMsQ0FBQztJQUVwRCxVQUFVLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBRTVCLE9BQU8sTUFBTSxDQUFDO0FBQ2xCLENBQUM7QUFFRCxlQUFlLGdCQUFnQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgeyBRdWVyeSwgSXRlbVNlcnZpY2UgfSBmcm9tIFwiQGdlb3BsYXRmb3JtL2NsaWVudFwiO1xuaW1wb3J0IFNlcnZpY2VQcm94eSBmcm9tICcuL2Jhc2UnO1xuXG5jb25zdCBSb3V0ZXMgPSBbXG4gICAge1xuICAgICAgICBrZXk6ICdzZWFyY2gnLFxuICAgICAgICBtZXRob2Q6ICdnZXQnLFxuICAgICAgICBwYXRoOiAnaXRlbXMnLFxuICAgICAgICBhdXRoOiBmYWxzZSxcbiAgICAgICAgb25FeGVjdXRlOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICBsZXQgcXVlcnkgPSBuZXcgUXVlcnkocmVxLnF1ZXJ5KTtcbiAgICAgICAgICAgIHJldHVybiBzdmMuc2VhcmNoKHF1ZXJ5KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBrZXk6ICdnZXQnLFxuICAgICAgICBtZXRob2Q6ICdnZXQnLFxuICAgICAgICBwYXRoOiAnaXRlbXMvOmlkJyxcbiAgICAgICAgYXV0aDogZmFsc2UsXG4gICAgICAgIG9uRXhlY3V0ZTogZnVuY3Rpb24oc3ZjIDogSXRlbVNlcnZpY2UsIHJlcSA6IGFueSkge1xuICAgICAgICAgICAgcmV0dXJuIHN2Yy5nZXQocmVxLnBhcmFtcy5pZCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5OiAnY3JlYXRlJyxcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIHBhdGg6ICdpdGVtcycsXG4gICAgICAgIGF1dGg6IHRydWUsXG4gICAgICAgIG9uRXhlY3V0ZTogZnVuY3Rpb24oc3ZjIDogSXRlbVNlcnZpY2UsIHJlcSA6IGFueSkge1xuICAgICAgICAgICAgcmV0dXJuIHN2Yy5zYXZlKHJlcS5ib2R5KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBrZXk6ICd1cGRhdGUnLFxuICAgICAgICBtZXRob2Q6ICdwdXQnLFxuICAgICAgICBwYXRoOiAnaXRlbXMvOmlkJyxcbiAgICAgICAgYXV0aDogdHJ1ZSxcbiAgICAgICAgb25FeGVjdXRlOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLnNhdmUocmVxLmJvZHkpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleTogJ2RlbGV0ZScsXG4gICAgICAgIG1ldGhvZDogJ2RlbGV0ZScsXG4gICAgICAgIHBhdGg6ICdpdGVtcy86aWQnLFxuICAgICAgICBhdXRoOiB0cnVlLFxuICAgICAgICBvbkV4ZWN1dGU6IGZ1bmN0aW9uKHN2YyA6IEl0ZW1TZXJ2aWNlLCByZXEgOiBhbnkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdmMucmVtb3ZlKHJlcS5wYXJhbXMuaWQpO1xuICAgICAgICB9LFxuICAgICAgICBvblJlc3BvbnNlOiBmdW5jdGlvbihcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHJlc3VsdCA6IGFueSxcbiAgICAgICAgICAgIHJlcyA6IGFueSkge1xuICAgICAgICAgICAgcmVzLnN0YXR1cygyMDQpLmVuZCgpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleTogJ3BhdGNoJyxcbiAgICAgICAgbWV0aG9kOiAncGF0Y2gnLFxuICAgICAgICBwYXRoOiAnaXRlbXMvOmlkJyxcbiAgICAgICAgYXV0aDogdHJ1ZSxcbiAgICAgICAgb25FeGVjdXRlOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLnBhdGNoKHJlcS5wYXJhbXMuaWQsIHJlcS5ib2R5KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBrZXk6ICdjbG9uZScsXG4gICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICBwYXRoOiAnaXRlbXMvOmlkL2Nsb25lJyxcbiAgICAgICAgYXV0aDogdHJ1ZSxcbiAgICAgICAgb25FeGVjdXRlOiBmdW5jdGlvbihzdmMsIHJlcSkgeyByZXR1cm4gc3ZjLmNsb25lKHJlcS5wYXJhbXMuaWQsIHJlcS5ib2R5KTsgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBrZXk6ICdleHBvcnQnLFxuICAgICAgICBtZXRob2Q6ICdnZXQnLFxuICAgICAgICBwYXRoOiAnaXRlbXMvOmlkL2V4cG9ydCcsXG4gICAgICAgIGF1dGg6IGZhbHNlLFxuICAgICAgICBvbkV4ZWN1dGU6IGZ1bmN0aW9uKHN2YyA6IEl0ZW1TZXJ2aWNlLCByZXEgOiBhbnkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdmMuZXhwb3J0KHJlcS5wYXJhbXMuaWQsIHJlcS5xdWVyeS5mb3JtYXQpOyB9LFxuICAgICAgICBvblJlc3BvbnNlOiBmdW5jdGlvbihyZXN1bHQgOiBhbnksIHJlcyA6IGFueSkge1xuICAgICAgICAgICAgbGV0IG1pbWVUeXBlID0gcmVzdWx0LmhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddO1xuICAgICAgICAgICAgbGV0IGRpc3Bvc2l0aW9uID0gcmVzdWx0LmhlYWRlcnNbJ2NvbnRlbnQtZGlzcG9zaXRpb24nXTtcbiAgICAgICAgICAgIHJlcy5zZXQoXCJDb250ZW50LVR5cGVcIiwgbWltZVR5cGUpO1xuICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1kaXNwb3NpdGlvbicsIGRpc3Bvc2l0aW9uKTtcbiAgICAgICAgICAgIHJlcy5zZW5kKHJlc3VsdC5ib2R5KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBrZXk6ICd1cmknLFxuICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgcGF0aDogJ2l0ZW1zL3VyaScsXG4gICAgICAgIGF1dGg6IGZhbHNlLFxuICAgICAgICBvbkV4ZWN1dGU6IGZ1bmN0aW9uKHN2YyA6IEl0ZW1TZXJ2aWNlLCByZXEgOiBhbnkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdmMuZ2V0VXJpKHJlcS5ib2R5KTtcbiAgICAgICAgfSxcbiAgICAgICAgb25SZXNwb25zZTogZnVuY3Rpb24ocmVzdWx0IDogYW55LCByZXMgOiBhbnkpIHtcbiAgICAgICAgICAgIHJlcy5qc29uKHsgdXJpOiByZXN1bHQgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5OiAnZXhpc3RzJyxcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIHBhdGg6ICdpdGVtcy9leGlzdHMnLFxuICAgICAgICBhdXRoOiBmYWxzZSxcbiAgICAgICAgb25FeGVjdXRlOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLmdldFVyaShyZXEuYm9keSlcbiAgICAgICAgICAgIC50aGVuKCB1cmkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBmaWVsZHMgPSBbJ3NlcnZpY2VUeXBlJywnc2VydmljZXMnLCdzY2hlbWUnLCd0aGVtZXMnLCdwdWJsaXNoZXJzJywna2V5d29yZHMnXTtcbiAgICAgICAgICAgICAgICBsZXQgcXVlcnkgOiBRdWVyeSA9IG5ldyBRdWVyeSgpLnVyaSh1cmkpLmZpZWxkcyhmaWVsZHMpO1xuICAgICAgICAgICAgICAgIHJldHVybiBzdmMuc2VhcmNoKHF1ZXJ5KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleTogJ2ltcG9ydCcsXG4gICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICBwYXRoOiAnaXRlbXMvaW1wb3J0JyxcbiAgICAgICAgYXV0aDogdHJ1ZSxcbiAgICAgICAgb25FeGVjdXRlOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICBsZXQgaW5wdXQgPSByZXEuYm9keS51cmwgfHwgcmVxLmZpbGVzLmZpbGU7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLmltcG9ydChpbnB1dCwgcmVxLnF1ZXJ5LmZvcm1hdCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAga2V5OiAnYXNzb2NpYXRpb25zJyxcbiAgICAgICAgbWV0aG9kOiAnZ2V0JyxcbiAgICAgICAgcGF0aDogJ2l0ZW1zLzppZC9hc3NvY2lhdGlvbnMnLFxuICAgICAgICBhdXRoOiBmYWxzZSxcbiAgICAgICAgb25FeGVjdXRlOiBmdW5jdGlvbihzdmMgOiBJdGVtU2VydmljZSwgcmVxIDogYW55KSB7XG4gICAgICAgICAgICByZXR1cm4gc3ZjLmFzc29jaWF0aW9ucyhyZXEucGFyYW1zLmlkLCByZXEucXVlcnkpOyB9XG4gICAgfSxcbiAgICB7XG4gICAgICAgIGtleTogJ3ZlcnNpb25zJyxcbiAgICAgICAgbWV0aG9kOiAnZ2V0JyxcbiAgICAgICAgcGF0aDogJ2l0ZW1zLzppZC92ZXJzaW9ucycsXG4gICAgICAgIGF1dGg6IGZhbHNlLFxuICAgICAgICBvbkV4ZWN1dGU6IGZ1bmN0aW9uKHN2YyA6IEl0ZW1TZXJ2aWNlLCByZXEgOiBhbnkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdmMudmVyc2lvbnMocmVxLnBhcmFtcy5pZCwgcmVxLnF1ZXJ5KTsgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBrZXk6ICdnZXRWZXJzaW9uJyxcbiAgICAgICAgbWV0aG9kOiAnZ2V0JyxcbiAgICAgICAgcGF0aDogJ2l0ZW1zLzppZC92ZXJzaW9ucy86dmVyc2lvbicsXG4gICAgICAgIGF1dGg6IGZhbHNlLFxuICAgICAgICBvbkV4ZWN1dGU6IGZ1bmN0aW9uKHN2YyA6IEl0ZW1TZXJ2aWNlLCByZXEgOiBhbnkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdmMuZ2V0KHJlcS5wYXJhbXMuaWQsIHsgdmVyc2lvbjogcmVxLnBhcmFtcy52ZXJzaW9uIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gVE9ETyBmaW5kTXVsdGlwbGVcbl07XG5cbi8qKlxuICpcbiAqL1xuZnVuY3Rpb24gYmluZFJvdXRlcyhyb3V0ZXIgOiBhbnksIG9wdGlvbnMgPzogYW55KSB7XG4gICAgLy9iaW5kIGNvbW1vbiBlbmRwb2ludHNcbiAgICBvcHRpb25zLnBhdGhCYXNlRGVmYXVsdCA9IFwiaXRlbXNcIjtcbiAgICBvcHRpb25zLnNlcnZpY2VDbGFzcyA9IEl0ZW1TZXJ2aWNlO1xuICAgIFNlcnZpY2VQcm94eS5iaW5kUm91dGVzKHJvdXRlciwgUm91dGVzLCBvcHRpb25zKTtcbn1cblxuXG5cblxuLyoqXG4gKiBJdGVtU2VydmljZVByb3h5XG4gKlxuICogc2VlIGV4YW1wbGVzL25vZGUvaXRlbS1wcm94eSBmb3IgYW4gaW4tZGVwdGggZXhhbXBsZVxuICovXG5mdW5jdGlvbiBJdGVtU2VydmljZVByb3h5KCBvcHRpb25zID86IGFueSApIHtcblxuICAgIGlmKHR5cGVvZihvcHRpb25zKSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgb3B0aW9ucyA9IHt9O1xuICAgIH07XG5cbiAgICBsZXQgcm91dGVyID0gb3B0aW9ucy5yb3V0ZXI7XG4gICAgaWYoIW9wdGlvbnMucm91dGVyKSB7XG4gICAgICAgIGxldCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuICAgICAgICBpZighZXhwcmVzcykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSXRlbVNlcnZpY2VQcm94eSgpIC0gTXVzdCBwcm92aWRlXCIgK1xuICAgICAgICAgICAgICAgIFwiJ29wdGlvbnMucm91dGVyJyBvciBpbmNsdWRlIGV4cHJlc3MgYXMgYSBkZXBlbmRlbmN5XCIpO1xuICAgICAgICB9XG4gICAgICAgIHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG4gICAgfVxuXG4gICAgaWYoIXJvdXRlcikgdGhyb3cgbmV3IEVycm9yKFwiSXRlbVNlcnZpY2VQcm94eSgpIC0gXCIgK1xuICAgICAgICBcIlVuYWJsZSB0byBjcmVhdGUgcHJveHkgcm91dGUsIG1pc3Npbmcgcm91dGVyXCIpO1xuXG4gICAgYmluZFJvdXRlcyhyb3V0ZXIsIG9wdGlvbnMpO1xuXG4gICAgcmV0dXJuIHJvdXRlcjtcbn1cblxuZXhwb3J0IGRlZmF1bHQgSXRlbVNlcnZpY2VQcm94eTtcbiJdfQ==